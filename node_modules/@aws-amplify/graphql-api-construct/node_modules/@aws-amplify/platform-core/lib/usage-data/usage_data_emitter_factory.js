"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UsageDataEmitterFactory = void 0;
const local_configuration_controller_factory_js_1 = require("../config/local_configuration_controller_factory.js");
const noop_usage_data_emitter_js_1 = require("./noop_usage_data_emitter.js");
const usage_data_emitter_js_1 = require("./usage_data_emitter.js");
const constants_js_1 = require("./constants.js");
/**
 * Creates UsageDataEmitter for a given library version
 */
class UsageDataEmitterFactory {
    /**
     * Creates UsageDataEmitter for a given library version, usage data tracking preferences
     */
    getInstance = async (libraryVersion, dependencies) => {
        const configController = local_configuration_controller_factory_js_1.configControllerFactory.getInstance('usage_data_preferences.json');
        const usageDataTrackingDisabledLocalFile = (await configController.get(constants_js_1.USAGE_DATA_TRACKING_ENABLED)) ===
            false;
        if (process.env.AMPLIFY_DISABLE_TELEMETRY ||
            usageDataTrackingDisabledLocalFile) {
            return new noop_usage_data_emitter_js_1.NoOpUsageDataEmitter();
        }
        return new usage_data_emitter_js_1.DefaultUsageDataEmitter(libraryVersion, dependencies);
    };
}
exports.UsageDataEmitterFactory = UsageDataEmitterFactory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNhZ2VfZGF0YV9lbWl0dGVyX2ZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXNhZ2UtZGF0YS91c2FnZV9kYXRhX2VtaXR0ZXJfZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxtSEFBOEY7QUFDOUYsNkVBQW9FO0FBQ3BFLG1FQUFrRTtBQUNsRSxpREFBNkQ7QUFlN0Q7O0dBRUc7QUFDSCxNQUFhLHVCQUF1QjtJQUNsQzs7T0FFRztJQUNILFdBQVcsR0FBRyxLQUFLLEVBQ2pCLGNBQXNCLEVBQ3RCLFlBQWdDLEVBQ0wsRUFBRTtRQUM3QixNQUFNLGdCQUFnQixHQUFHLG1FQUF1QixDQUFDLFdBQVcsQ0FDMUQsNkJBQTZCLENBQzlCLENBQUM7UUFFRixNQUFNLGtDQUFrQyxHQUN0QyxDQUFDLE1BQU0sZ0JBQWdCLENBQUMsR0FBRyxDQUFVLDBDQUEyQixDQUFDLENBQUM7WUFDbEUsS0FBSyxDQUFDO1FBRVIsSUFDRSxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QjtZQUNyQyxrQ0FBa0MsRUFDbEM7WUFDQSxPQUFPLElBQUksaURBQW9CLEVBQUUsQ0FBQztTQUNuQztRQUNELE9BQU8sSUFBSSwrQ0FBdUIsQ0FBQyxjQUFjLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDbkUsQ0FBQyxDQUFDO0NBQ0g7QUF4QkQsMERBd0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29uZmlnQ29udHJvbGxlckZhY3RvcnkgfSBmcm9tICcuLi9jb25maWcvbG9jYWxfY29uZmlndXJhdGlvbl9jb250cm9sbGVyX2ZhY3RvcnkuanMnO1xuaW1wb3J0IHsgTm9PcFVzYWdlRGF0YUVtaXR0ZXIgfSBmcm9tICcuL25vb3BfdXNhZ2VfZGF0YV9lbWl0dGVyLmpzJztcbmltcG9ydCB7IERlZmF1bHRVc2FnZURhdGFFbWl0dGVyIH0gZnJvbSAnLi91c2FnZV9kYXRhX2VtaXR0ZXIuanMnO1xuaW1wb3J0IHsgVVNBR0VfREFUQV9UUkFDS0lOR19FTkFCTEVEIH0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgQW1wbGlmeUVycm9yIH0gZnJvbSAnLi4vaW5kZXguanMnO1xuaW1wb3J0IHsgRGVwZW5kZW5jeSB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbHVnaW4tdHlwZXMnO1xuXG5leHBvcnQgdHlwZSBVc2FnZURhdGFFbWl0dGVyID0ge1xuICBlbWl0U3VjY2VzczogKFxuICAgIG1ldHJpY3M/OiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+LFxuICAgIGRpbWVuc2lvbnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+LFxuICApID0+IFByb21pc2U8dm9pZD47XG4gIGVtaXRGYWlsdXJlOiAoXG4gICAgZXJyb3I6IEFtcGxpZnlFcnJvcixcbiAgICBkaW1lbnNpb25zPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPixcbiAgKSA9PiBQcm9taXNlPHZvaWQ+O1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIFVzYWdlRGF0YUVtaXR0ZXIgZm9yIGEgZ2l2ZW4gbGlicmFyeSB2ZXJzaW9uXG4gKi9cbmV4cG9ydCBjbGFzcyBVc2FnZURhdGFFbWl0dGVyRmFjdG9yeSB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIFVzYWdlRGF0YUVtaXR0ZXIgZm9yIGEgZ2l2ZW4gbGlicmFyeSB2ZXJzaW9uLCB1c2FnZSBkYXRhIHRyYWNraW5nIHByZWZlcmVuY2VzXG4gICAqL1xuICBnZXRJbnN0YW5jZSA9IGFzeW5jIChcbiAgICBsaWJyYXJ5VmVyc2lvbjogc3RyaW5nLFxuICAgIGRlcGVuZGVuY2llcz86IEFycmF5PERlcGVuZGVuY3k+LFxuICApOiBQcm9taXNlPFVzYWdlRGF0YUVtaXR0ZXI+ID0+IHtcbiAgICBjb25zdCBjb25maWdDb250cm9sbGVyID0gY29uZmlnQ29udHJvbGxlckZhY3RvcnkuZ2V0SW5zdGFuY2UoXG4gICAgICAndXNhZ2VfZGF0YV9wcmVmZXJlbmNlcy5qc29uJyxcbiAgICApO1xuXG4gICAgY29uc3QgdXNhZ2VEYXRhVHJhY2tpbmdEaXNhYmxlZExvY2FsRmlsZSA9XG4gICAgICAoYXdhaXQgY29uZmlnQ29udHJvbGxlci5nZXQ8Ym9vbGVhbj4oVVNBR0VfREFUQV9UUkFDS0lOR19FTkFCTEVEKSkgPT09XG4gICAgICBmYWxzZTtcblxuICAgIGlmIChcbiAgICAgIHByb2Nlc3MuZW52LkFNUExJRllfRElTQUJMRV9URUxFTUVUUlkgfHxcbiAgICAgIHVzYWdlRGF0YVRyYWNraW5nRGlzYWJsZWRMb2NhbEZpbGVcbiAgICApIHtcbiAgICAgIHJldHVybiBuZXcgTm9PcFVzYWdlRGF0YUVtaXR0ZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBEZWZhdWx0VXNhZ2VEYXRhRW1pdHRlcihsaWJyYXJ5VmVyc2lvbiwgZGVwZW5kZW5jaWVzKTtcbiAgfTtcbn1cbiJdfQ==