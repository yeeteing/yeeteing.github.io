"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.BackendLocator = void 0;
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
const errors_1 = require("./errors");
/**
 * Find the backend definition file in the customer app that represents a CDK app.
 */
class BackendLocator {
    rootDir;
    relativePath = path_1.default.join('amplify', 'backend');
    // Give preference to JS if that exists over TS in case customers have their own compilation process.
    supportedFileExtensions = ['.js', '.mjs', '.cjs', '.ts'];
    /**
     * Constructor for BackendLocator
     */
    constructor(rootDir = process.cwd()) {
        this.rootDir = rootDir;
    }
    locate = () => {
        for (const fileExtension of this.supportedFileExtensions) {
            if (fs_1.default.existsSync(path_1.default.resolve(this.rootDir, this.relativePath + fileExtension))) {
                return this.relativePath + fileExtension;
            }
        }
        throw new errors_1.AmplifyUserError('FileConventionError', {
            message: `Amplify Backend not found in ${this.rootDir}.`,
            resolution: 'Amplify Backend must be defined in amplify/backend.(ts|js|cjs|mjs)',
        });
    };
}
exports.BackendLocator = BackendLocator;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2VuZF9lbnRyeV9wb2ludF9sb2NhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2JhY2tlbmRfZW50cnlfcG9pbnRfbG9jYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSw0Q0FBb0I7QUFDcEIsZ0RBQXdCO0FBQ3hCLHFDQUE0QztBQUU1Qzs7R0FFRztBQUNILE1BQWEsY0FBYztJQVFJO0lBUHJCLFlBQVksR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUV2RCxxR0FBcUc7SUFDN0YsdUJBQXVCLEdBQUcsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNqRTs7T0FFRztJQUNILFlBQTZCLFVBQWtCLE9BQU8sQ0FBQyxHQUFHLEVBQUU7UUFBL0IsWUFBTyxHQUFQLE9BQU8sQ0FBd0I7SUFBRyxDQUFDO0lBRWhFLE1BQU0sR0FBRyxHQUFHLEVBQUU7UUFDWixLQUFLLE1BQU0sYUFBYSxJQUFJLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO1lBQ3pELElBQ0UsWUFBRSxDQUFDLFVBQVUsQ0FDWCxjQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFlBQVksR0FBRyxhQUFhLENBQUMsQ0FDOUQsRUFDRCxDQUFDO2dCQUNELE9BQU8sSUFBSSxDQUFDLFlBQVksR0FBRyxhQUFhLENBQUM7WUFDM0MsQ0FBQztRQUNILENBQUM7UUFFRCxNQUFNLElBQUkseUJBQWdCLENBQUMscUJBQXFCLEVBQUU7WUFDaEQsT0FBTyxFQUFFLGdDQUFnQyxJQUFJLENBQUMsT0FBTyxHQUFHO1lBQ3hELFVBQVUsRUFDUixvRUFBb0U7U0FDdkUsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDO0NBQ0g7QUEzQkQsd0NBMkJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgQW1wbGlmeVVzZXJFcnJvciB9IGZyb20gJy4vZXJyb3JzJztcblxuLyoqXG4gKiBGaW5kIHRoZSBiYWNrZW5kIGRlZmluaXRpb24gZmlsZSBpbiB0aGUgY3VzdG9tZXIgYXBwIHRoYXQgcmVwcmVzZW50cyBhIENESyBhcHAuXG4gKi9cbmV4cG9ydCBjbGFzcyBCYWNrZW5kTG9jYXRvciB7XG4gIHByaXZhdGUgcmVsYXRpdmVQYXRoID0gcGF0aC5qb2luKCdhbXBsaWZ5JywgJ2JhY2tlbmQnKTtcblxuICAvLyBHaXZlIHByZWZlcmVuY2UgdG8gSlMgaWYgdGhhdCBleGlzdHMgb3ZlciBUUyBpbiBjYXNlIGN1c3RvbWVycyBoYXZlIHRoZWlyIG93biBjb21waWxhdGlvbiBwcm9jZXNzLlxuICBwcml2YXRlIHN1cHBvcnRlZEZpbGVFeHRlbnNpb25zID0gWycuanMnLCAnLm1qcycsICcuY2pzJywgJy50cyddO1xuICAvKipcbiAgICogQ29uc3RydWN0b3IgZm9yIEJhY2tlbmRMb2NhdG9yXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHJvb3REaXI6IHN0cmluZyA9IHByb2Nlc3MuY3dkKCkpIHt9XG5cbiAgbG9jYXRlID0gKCkgPT4ge1xuICAgIGZvciAoY29uc3QgZmlsZUV4dGVuc2lvbiBvZiB0aGlzLnN1cHBvcnRlZEZpbGVFeHRlbnNpb25zKSB7XG4gICAgICBpZiAoXG4gICAgICAgIGZzLmV4aXN0c1N5bmMoXG4gICAgICAgICAgcGF0aC5yZXNvbHZlKHRoaXMucm9vdERpciwgdGhpcy5yZWxhdGl2ZVBhdGggKyBmaWxlRXh0ZW5zaW9uKSxcbiAgICAgICAgKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbGF0aXZlUGF0aCArIGZpbGVFeHRlbnNpb247XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEFtcGxpZnlVc2VyRXJyb3IoJ0ZpbGVDb252ZW50aW9uRXJyb3InLCB7XG4gICAgICBtZXNzYWdlOiBgQW1wbGlmeSBCYWNrZW5kIG5vdCBmb3VuZCBpbiAke3RoaXMucm9vdERpcn0uYCxcbiAgICAgIHJlc29sdXRpb246XG4gICAgICAgICdBbXBsaWZ5IEJhY2tlbmQgbXVzdCBiZSBkZWZpbmVkIGluIGFtcGxpZnkvYmFja2VuZC4odHN8anN8Y2pzfG1qcyknLFxuICAgIH0pO1xuICB9O1xufVxuIl19