import * as os from 'node:os';
import { blue, bold, cyan, dim, green, grey, magenta, red, underline, yellow, } from 'kleur/colors';
import { AmplifyError, AmplifyFault } from '@aws-amplify/platform-core';
import { getPackageManagerRunnerName } from '../package-manager-controller/get_package_manager_name.js';
/**
 * Formats various inputs into single string.
 */
export class Format {
    packageManagerRunnerName;
    /**
     * Initialize with a package manager runner name. Defaults to attempting to load a value derived from environment variables.
     */
    constructor(packageManagerRunnerName = getPackageManagerRunnerName()) {
        this.packageManagerRunnerName = packageManagerRunnerName;
    }
    normalizeAmpxCommand = (command) => {
        if (command.length === 0) {
            throw new AmplifyFault('InvalidFormatFault', {
                message: 'The command must be non-empty',
            });
        }
        return this.cyan(`${this.packageManagerRunnerName} ampx ${command}`);
    };
    error = (error) => {
        if (error instanceof Error) {
            let message = `${this.red(this.bold(`[${error.name}]`))} ${error.message}`;
            if (typeof error?.cause === 'object' && !!error.cause) {
                message = `${message}${os.EOL}${format.indent(`âˆŸ Caused by: ${this.error(error.cause)}`)}`;
            }
            if (AmplifyError.isAmplifyError(error) && error.resolution) {
                message =
                    message +
                        os.EOL +
                        `${format.success('Resolution')}: ${error.resolution}`;
            }
            if (AmplifyError.isAmplifyError(error) && error.details) {
                message = message + os.EOL + `Details: ${error.details}`;
            }
            return message;
        }
        else if (typeof error === 'string') {
            return this.red(error);
        }
        try {
            return this.red(JSON.stringify(error, null, 2));
        }
        catch (e) {
            return this.red('Unknown error') + os.EOL + this.error(e);
        }
    };
    note = (message) => this.grey(message);
    command = (command) => this.cyan(command);
    highlight = (command) => this.cyan(command);
    success = (message) => this.green(message);
    sectionHeader = (header) => this.bold(this.blue(header));
    bold = (message) => this.applyOnAllLines(bold, message);
    dim = (message) => this.applyOnAllLines(dim, message);
    link = (link) => underline(this.blue(link));
    list = (lines) => lines.map((line) => ` - ${line}`).join(os.EOL);
    indent = (message) => {
        if (message === '') {
            throw new Error('Message cannot be empty');
        }
        const spaces = '  '; // Two spaces for indentation
        return this.applyOnAllLines((line) => `${spaces}${line}`, message);
    };
    record = (record) => Object.entries(record)
        .map(([key, value]) => `${key}: ${String(value)}`)
        .join(os.EOL);
    color = (message, colorName) => this.applyOnAllLines(colors[colorName], message);
    applyOnAllLines = (mapFunction, message) => {
        return message && message.split(os.EOL).map(mapFunction).join(os.EOL);
    };
    // Primary colors
    cyan = (command) => this.applyOnAllLines(cyan, command);
    blue = (command) => this.applyOnAllLines(blue, command);
    red = (message) => this.applyOnAllLines(red, message);
    green = (message) => this.applyOnAllLines(green, message);
    grey = (message) => this.applyOnAllLines(grey, message);
}
// Map to connect colorName to kleur color
const colors = {
    Green: green,
    Yellow: yellow,
    Blue: blue,
    Magenta: magenta,
    Cyan: cyan,
    Red: red,
};
export const colorNames = [
    'Green',
    'Yellow',
    'Blue',
    'Magenta',
    'Cyan',
    'Red',
];
export const format = new Format();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybWF0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2Zvcm1hdC9mb3JtYXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDOUIsT0FBTyxFQUVMLElBQUksRUFDSixJQUFJLEVBQ0osSUFBSSxFQUNKLEdBQUcsRUFDSCxLQUFLLEVBQ0wsSUFBSSxFQUNKLE9BQU8sRUFDUCxHQUFHLEVBQ0gsU0FBUyxFQUNULE1BQU0sR0FDUCxNQUFNLGNBQWMsQ0FBQztBQUN0QixPQUFPLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3hFLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLDJEQUEyRCxDQUFDO0FBRXhHOztHQUVHO0FBQ0gsTUFBTSxPQUFPLE1BQU07SUFLRTtJQUpuQjs7T0FFRztJQUNILFlBQ21CLDJCQUEyQiwyQkFBMkIsRUFBRTtRQUF4RCw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQWdDO0lBQ3hFLENBQUM7SUFFSixvQkFBb0IsR0FBRyxDQUFDLE9BQWUsRUFBRSxFQUFFO1FBQ3pDLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUN6QixNQUFNLElBQUksWUFBWSxDQUFDLG9CQUFvQixFQUFFO2dCQUMzQyxPQUFPLEVBQUUsK0JBQStCO2FBQ3pDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFDRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsd0JBQXdCLFNBQVMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUN2RSxDQUFDLENBQUM7SUFFRixLQUFLLEdBQUcsQ0FBQyxLQUErQixFQUFVLEVBQUU7UUFDbEQsSUFBSSxLQUFLLFlBQVksS0FBSyxFQUFFLENBQUM7WUFDM0IsSUFBSSxPQUFPLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMs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QWUsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDaEUsSUFBSSxHQUFHLENBQUMsT0FBZSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNoRSxHQUFHLEdBQUcsQ0FBQyxPQUFlLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzlELEtBQUssR0FBRyxDQUFDLE9BQWUsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDbEUsSUFBSSxHQUFHLENBQUMsT0FBZSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztDQUN6RTtBQUVELDBDQUEwQztBQUMxQyxNQUFNLE1BQU0sR0FBZ0M7SUFDMUMsS0FBSyxFQUFFLEtBQUs7SUFDWixNQUFNLEVBQUUsTUFBTTtJQUNkLElBQUksRUFBRSxJQUFJO0lBQ1YsT0FBTyxFQUFFLE9BQU87SUFDaEIsSUFBSSxFQUFFLElBQUk7SUFDVixHQUFHLEVBQUUsR0FBRztDQUNULENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUc7SUFDeEIsT0FBTztJQUNQLFFBQVE7SUFDUixNQUFNO0lBQ04sU0FBUztJQUNULE1BQU07SUFDTixLQUFLO0NBQ0csQ0FBQztBQUlYLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgb3MgZnJvbSAnbm9kZTpvcyc7XG5pbXBvcnQge1xuICBDb2xvcml6ZSxcbiAgYmx1ZSxcbiAgYm9sZCxcbiAgY3lhbixcbiAgZGltLFxuICBncmVlbixcbiAgZ3JleSxcbiAgbWFnZW50YSxcbiAgcmVkLFxuICB1bmRlcmxpbmUsXG4gIHllbGxvdyxcbn0gZnJvbSAna2xldXIvY29sb3JzJztcbmltcG9ydCB7IEFtcGxpZnlFcnJvciwgQW1wbGlmeUZhdWx0IH0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsYXRmb3JtLWNvcmUnO1xuaW1wb3J0IHsgZ2V0UGFja2FnZU1hbmFnZXJSdW5uZXJOYW1lIH0gZnJvbSAnLi4vcGFja2FnZS1tYW5hZ2VyLWNvbnRyb2xsZXIvZ2V0X3BhY2thZ2VfbWFuYWdlcl9uYW1lLmpzJztcblxuLyoqXG4gKiBGb3JtYXRzIHZhcmlvdXMgaW5wdXRzIGludG8gc2luZ2xlIHN0cmluZy5cbiAqL1xuZXhwb3J0IGNsYXNzIEZvcm1hdCB7XG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHdpdGggYSBwYWNrYWdlIG1hbmFnZXIgcnVubmVyIG5hbWUuIERlZmF1bHRzIHRvIGF0dGVtcHRpbmcgdG8gbG9hZCBhIHZhbHVlIGRlcml2ZWQgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHBhY2thZ2VNYW5hZ2VyUnVubmVyTmFtZSA9IGdldFBhY2thZ2VNYW5hZ2VyUnVubmVyTmFtZSgpLFxuICApIHt9XG5cbiAgbm9ybWFsaXplQW1weENvbW1hbmQgPSAoY29tbWFuZDogc3RyaW5nKSA9PiB7XG4gICAgaWYgKGNvbW1hbmQubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgQW1wbGlmeUZhdWx0KCdJbnZhbGlkRm9ybWF0RmF1bHQnLCB7XG4gICAgICAgIG1lc3NhZ2U6ICdUaGUgY29tbWFuZCBtdXN0IGJlIG5vbi1lbXB0eScsXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY3lhbihgJHt0aGlzLnBhY2thZ2VNYW5hZ2VyUnVubmVyTmFtZX0gYW1weCAke2NvbW1hbmR9YCk7XG4gIH07XG5cbiAgZXJyb3IgPSAoZXJyb3I6IHN0cmluZyB8IEVycm9yIHwgdW5rbm93bik6IHN0cmluZyA9PiB7XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgIGxldCBtZXNzYWdlID0gYCR7dGhpcy5yZWQodGhpcy5ib2xkKGBbJHtlcnJvci5uYW1lfV1gKSl9ICR7XG4gICAgICAgIGVycm9yLm1lc3NhZ2VcbiAgICAgIH1gO1xuXG4gICAgICBpZiAodHlwZW9mIGVycm9yPy5jYXVzZSA9PT0gJ29iamVjdCcgJiYgISFlcnJvci5jYXVzZSkge1xuICAgICAgICBtZXNzYWdlID0gYCR7bWVzc2FnZX0ke29zLkVPTH0ke2Zvcm1hdC5pbmRlbnQoYOKInyBDYXVzZWQgYnk6ICR7dGhpcy5lcnJvcihlcnJvci5jYXVzZSl9YCl9YDtcbiAgICAgIH1cblxuICAgICAgaWYgKEFtcGxpZnlFcnJvci5pc0FtcGxpZnlFcnJvcihlcnJvcikgJiYgZXJyb3IucmVzb2x1dGlvbikge1xuICAgICAgICBtZXNzYWdlID1cbiAgICAgICAgICBtZXNzYWdlICtcbiAgICAgICAgICBvcy5FT0wgK1xuICAgICAgICAgIGAke2Zvcm1hdC5zdWNjZXNzKCdSZXNvbHV0aW9uJyl9OiAke2Vycm9yLnJlc29sdXRpb259YDtcbiAgICAgIH1cblxuICAgICAgaWYgKEFtcGxpZnlFcnJvci5pc0FtcGxpZnlFcnJvcihlcnJvcikgJiYgZXJyb3IuZGV0YWlscykge1xuICAgICAgICBtZXNzYWdlID0gbWVzc2FnZSArIG9zLkVPTCArIGBEZXRhaWxzOiAke2Vycm9yLmRldGFpbHN9YDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZXJyb3IgPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gdGhpcy5yZWQoZXJyb3IpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHRoaXMucmVkKEpTT04uc3RyaW5naWZ5KGVycm9yLCBudWxsLCAyKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIHRoaXMucmVkKCdVbmtub3duIGVycm9yJykgKyBvcy5FT0wgKyB0aGlzLmVycm9yKGUpO1xuICAgIH1cbiAgfTtcblxuICBub3RlID0gKG1lc3NhZ2U6IHN0cmluZykgPT4gdGhpcy5ncmV5KG1lc3NhZ2UpO1xuXG4gIGNvbW1hbmQgPSAoY29tbWFuZDogc3RyaW5nKSA9PiB0aGlzLmN5YW4oY29tbWFuZCk7XG5cbiAgaGlnaGxpZ2h0ID0gKGNvbW1hbmQ6IHN0cmluZykgPT4gdGhpcy5jeWFuKGNvbW1hbmQpO1xuXG4gIHN1Y2Nlc3MgPSAobWVzc2FnZTogc3RyaW5nKSA9PiB0aGlzLmdyZWVuKG1lc3NhZ2UpO1xuXG4gIHNlY3Rpb25IZWFkZXIgPSAoaGVhZGVyOiBzdHJpbmcpID0+IHRoaXMuYm9sZCh0aGlzLmJsdWUoaGVhZGVyKSk7XG5cbiAgYm9sZCA9IChtZXNzYWdlOiBzdHJpbmcpID0+IHRoaXMuYXBwbHlPbkFsbExpbmVzKGJvbGQsIG1lc3NhZ2UpO1xuXG4gIGRpbSA9IChtZXNzYWdlOiBzdHJpbmcpID0+IHRoaXMuYXBwbHlPbkFsbExpbmVzKGRpbSwgbWVzc2FnZSk7XG5cbiAgbGluayA9IChsaW5rOiBzdHJpbmcpID0+IHVuZGVybGluZSh0aGlzLmJsdWUobGluaykpO1xuXG4gIGxpc3QgPSAobGluZXM6IHN0cmluZ1tdKSA9PlxuICAgIGxpbmVzLm1hcCgobGluZTogc3RyaW5nKSA9PiBgIC0gJHtsaW5lfWApLmpvaW4ob3MuRU9MKTtcblxuICBpbmRlbnQgPSAobWVzc2FnZTogc3RyaW5nKSA9PiB7XG4gICAgaWYgKG1lc3NhZ2UgPT09ICcnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ01lc3NhZ2UgY2Fubm90IGJlIGVtcHR5Jyk7XG4gICAgfVxuICAgIGNvbnN0IHNwYWNlcyA9ICcgICc7IC8vIFR3byBzcGFjZXMgZm9yIGluZGVudGF0aW9uXG4gICAgcmV0dXJuIHRoaXMuYXBwbHlPbkFsbExpbmVzKChsaW5lOiBzdHJpbmcpID0+IGAke3NwYWNlc30ke2xpbmV9YCwgbWVzc2FnZSk7XG4gIH07XG5cbiAgcmVjb3JkID0gKHJlY29yZDogUmVjb3JkPHN0cmluZywgc3RyaW5nIHwgbnVtYmVyIHwgRGF0ZT4pID0+XG4gICAgT2JqZWN0LmVudHJpZXMocmVjb3JkKVxuICAgICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiBgJHtrZXl9OiAke1N0cmluZyh2YWx1ZSl9YClcbiAgICAgIC5qb2luKG9zLkVPTCk7XG5cbiAgY29sb3IgPSAobWVzc2FnZTogc3RyaW5nLCBjb2xvck5hbWU6IENvbG9yTmFtZSkgPT5cbiAgICB0aGlzLmFwcGx5T25BbGxMaW5lcyhjb2xvcnNbY29sb3JOYW1lXSwgbWVzc2FnZSk7XG5cbiAgcHJpdmF0ZSBhcHBseU9uQWxsTGluZXMgPSAoXG4gICAgbWFwRnVuY3Rpb246IChsaW5lOiBzdHJpbmcpID0+IHN0cmluZyxcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICk6IHN0cmluZyA9PiB7XG4gICAgcmV0dXJuIG1lc3NhZ2UgJiYgbWVzc2FnZS5zcGxpdChvcy5FT0wpLm1hcChtYXBGdW5jdGlvbikuam9pbihvcy5FT0wpO1xuICB9O1xuXG4gIC8vIFByaW1hcnkgY29sb3JzXG4gIHByaXZhdGUgY3lhbiA9IChjb21tYW5kOiBzdHJpbmcpID0+IHRoaXMuYXBwbHlPbkFsbExpbmVzKGN5YW4sIGNvbW1hbmQpO1xuICBwcml2YXRlIGJsdWUgPSAoY29tbWFuZDogc3RyaW5nKSA9PiB0aGlzLmFwcGx5T25BbGxMaW5lcyhibHVlLCBjb21tYW5kKTtcbiAgcHJpdmF0ZSByZWQgPSAobWVzc2FnZTogc3RyaW5nKSA9PiB0aGlzLmFwcGx5T25BbGxMaW5lcyhyZWQsIG1lc3NhZ2UpO1xuICBwcml2YXRlIGdyZWVuID0gKG1lc3NhZ2U6IHN0cmluZykgPT4gdGhpcy5hcHBseU9uQWxsTGluZXMoZ3JlZW4sIG1lc3NhZ2UpO1xuICBwcml2YXRlIGdyZXkgPSAobWVzc2FnZTogc3RyaW5nKSA9PiB0aGlzLmFwcGx5T25BbGxMaW5lcyhncmV5LCBtZXNzYWdlKTtcbn1cblxuLy8gTWFwIHRvIGNvbm5lY3QgY29sb3JOYW1lIHRvIGtsZXVyIGNvbG9yXG5jb25zdCBjb2xvcnM6IFJlY29yZDxDb2xvck5hbWUsIENvbG9yaXplPiA9IHtcbiAgR3JlZW46IGdyZWVuLFxuICBZZWxsb3c6IHllbGxvdyxcbiAgQmx1ZTogYmx1ZSxcbiAgTWFnZW50YTogbWFnZW50YSxcbiAgQ3lhbjogY3lhbixcbiAgUmVkOiByZWQsXG59O1xuXG5leHBvcnQgY29uc3QgY29sb3JOYW1lcyA9IFtcbiAgJ0dyZWVuJyxcbiAgJ1llbGxvdycsXG4gICdCbHVlJyxcbiAgJ01hZ2VudGEnLFxuICAnQ3lhbicsXG4gICdSZWQnLFxuXSBhcyBjb25zdDtcblxuZXhwb3J0IHR5cGUgQ29sb3JOYW1lID0gKHR5cGVvZiBjb2xvck5hbWVzKVtudW1iZXJdO1xuXG5leHBvcnQgY29uc3QgZm9ybWF0ID0gbmV3IEZvcm1hdCgpO1xuIl19