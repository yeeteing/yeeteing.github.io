"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UsageDataEmitterFactory = void 0;
const local_configuration_controller_factory_js_1 = require("../config/local_configuration_controller_factory.js");
const noop_usage_data_emitter_js_1 = require("./noop_usage_data_emitter.js");
const usage_data_emitter_js_1 = require("./usage_data_emitter.js");
const constants_js_1 = require("./constants.js");
/**
 * Creates UsageDataEmitter for a given library version
 */
class UsageDataEmitterFactory {
    /**
     * Creates UsageDataEmitter for a given library version, usage data tracking preferences
     */
    getInstance = async (libraryVersion, dependencies) => {
        const configController = local_configuration_controller_factory_js_1.configControllerFactory.getInstance('usage_data_preferences.json');
        const usageDataTrackingDisabledLocalFile = (await configController.get(constants_js_1.USAGE_DATA_TRACKING_ENABLED)) ===
            false;
        if (process.env.AMPLIFY_DISABLE_TELEMETRY ||
            usageDataTrackingDisabledLocalFile) {
            return new noop_usage_data_emitter_js_1.NoOpUsageDataEmitter();
        }
        return new usage_data_emitter_js_1.DefaultUsageDataEmitter(libraryVersion, dependencies);
    };
}
exports.UsageDataEmitterFactory = UsageDataEmitterFactory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNhZ2VfZGF0YV9lbWl0dGVyX2ZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXNhZ2UtZGF0YS91c2FnZV9kYXRhX2VtaXR0ZXJfZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxtSEFBOEY7QUFDOUYsNkVBQW9FO0FBQ3BFLG1FQUFrRTtBQUNsRSxpREFBNkQ7QUFlN0Q7O0dBRUc7QUFDSCxNQUFhLHVCQUF1QjtJQUNsQzs7T0FFRztJQUNILFdBQVcsR0FBRyxLQUFLLEVBQ2pCLGNBQXNCLEVBQ3RCLFlBQWdDLEVBQ0wsRUFBRTtRQUM3QixNQUFNLGdCQUFnQixHQUFHLG1FQUF1QixDQUFDLFdBQVcsQ0FDMUQsNkJBQTZCLENBQzlCLENBQUM7UUFFRixNQUFNLGtDQUFrQyxHQUN0QyxDQUFDLE1BQU0sZ0JBQWdCLENBQUMsR0FBRyxDQUFVLDBDQUEyQixDQUFDLENBQUM7WUFDbEUsS0FBSyxDQUFDO1FBRVIsSUFDRSxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QjtZQUNyQyxrQ0FBa0MsRUFDbEMsQ0FBQztZQUNELE9BQU8sSUFBSSxpREFBb0IsRUFBRSxDQUFDO1FBQ3BDLENBQUM7UUFDRCxPQUFPLElBQUksK0NBQXVCLENBQUMsY0FBYyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ25FLENBQUMsQ0FBQztDQUNIO0FBeEJELDBEQXdCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvbmZpZ0NvbnRyb2xsZXJGYWN0b3J5IH0gZnJvbSAnLi4vY29uZmlnL2xvY2FsX2NvbmZpZ3VyYXRpb25fY29udHJvbGxlcl9mYWN0b3J5LmpzJztcbmltcG9ydCB7IE5vT3BVc2FnZURhdGFFbWl0dGVyIH0gZnJvbSAnLi9ub29wX3VzYWdlX2RhdGFfZW1pdHRlci5qcyc7XG5pbXBvcnQgeyBEZWZhdWx0VXNhZ2VEYXRhRW1pdHRlciB9IGZyb20gJy4vdXNhZ2VfZGF0YV9lbWl0dGVyLmpzJztcbmltcG9ydCB7IFVTQUdFX0RBVEFfVFJBQ0tJTkdfRU5BQkxFRCB9IGZyb20gJy4vY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IEFtcGxpZnlFcnJvciB9IGZyb20gJy4uL2luZGV4LmpzJztcbmltcG9ydCB7IERlcGVuZGVuY3kgfSBmcm9tICdAYXdzLWFtcGxpZnkvcGx1Z2luLXR5cGVzJztcblxuZXhwb3J0IHR5cGUgVXNhZ2VEYXRhRW1pdHRlciA9IHtcbiAgZW1pdFN1Y2Nlc3M6IChcbiAgICBtZXRyaWNzPzogUmVjb3JkPHN0cmluZywgbnVtYmVyPixcbiAgICBkaW1lbnNpb25zPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPixcbiAgKSA9PiBQcm9taXNlPHZvaWQ+O1xuICBlbWl0RmFpbHVyZTogKFxuICAgIGVycm9yOiBBbXBsaWZ5RXJyb3IsXG4gICAgZGltZW5zaW9ucz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz4sXG4gICkgPT4gUHJvbWlzZTx2b2lkPjtcbn07XG5cbi8qKlxuICogQ3JlYXRlcyBVc2FnZURhdGFFbWl0dGVyIGZvciBhIGdpdmVuIGxpYnJhcnkgdmVyc2lvblxuICovXG5leHBvcnQgY2xhc3MgVXNhZ2VEYXRhRW1pdHRlckZhY3Rvcnkge1xuICAvKipcbiAgICogQ3JlYXRlcyBVc2FnZURhdGFFbWl0dGVyIGZvciBhIGdpdmVuIGxpYnJhcnkgdmVyc2lvbiwgdXNhZ2UgZGF0YSB0cmFja2luZyBwcmVmZXJlbmNlc1xuICAgKi9cbiAgZ2V0SW5zdGFuY2UgPSBhc3luYyAoXG4gICAgbGlicmFyeVZlcnNpb246IHN0cmluZyxcbiAgICBkZXBlbmRlbmNpZXM/OiBBcnJheTxEZXBlbmRlbmN5PixcbiAgKTogUHJvbWlzZTxVc2FnZURhdGFFbWl0dGVyPiA9PiB7XG4gICAgY29uc3QgY29uZmlnQ29udHJvbGxlciA9IGNvbmZpZ0NvbnRyb2xsZXJGYWN0b3J5LmdldEluc3RhbmNlKFxuICAgICAgJ3VzYWdlX2RhdGFfcHJlZmVyZW5jZXMuanNvbicsXG4gICAgKTtcblxuICAgIGNvbnN0IHVzYWdlRGF0YVRyYWNraW5nRGlzYWJsZWRMb2NhbEZpbGUgPVxuICAgICAgKGF3YWl0IGNvbmZpZ0NvbnRyb2xsZXIuZ2V0PGJvb2xlYW4+KFVTQUdFX0RBVEFfVFJBQ0tJTkdfRU5BQkxFRCkpID09PVxuICAgICAgZmFsc2U7XG5cbiAgICBpZiAoXG4gICAgICBwcm9jZXNzLmVudi5BTVBMSUZZX0RJU0FCTEVfVEVMRU1FVFJZIHx8XG4gICAgICB1c2FnZURhdGFUcmFja2luZ0Rpc2FibGVkTG9jYWxGaWxlXG4gICAgKSB7XG4gICAgICByZXR1cm4gbmV3IE5vT3BVc2FnZURhdGFFbWl0dGVyKCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgRGVmYXVsdFVzYWdlRGF0YUVtaXR0ZXIobGlicmFyeVZlcnNpb24sIGRlcGVuZGVuY2llcyk7XG4gIH07XG59XG4iXX0=