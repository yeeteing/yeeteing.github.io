"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getLocalProjectId = void 0;
const uuid_1 = require("uuid");
const os_1 = require("os");
const local_configuration_controller_factory_1 = require("../config/local_configuration_controller_factory");
const path_1 = __importDefault(require("path"));
// eslint-disable-next-line spellcheck/spell-checker
const AMPLIFY_CLI_UUID_NAMESPACE = 'e6831f35-ca7a-4889-a7bf-541c81d58d40'; // A random v4 UUID
/**
 * Generates a consistent project Uuid
 */
const getLocalProjectId = async (namespace = AMPLIFY_CLI_UUID_NAMESPACE) => {
    const localProjectIdPath = process.cwd().replace((0, os_1.homedir)() + path_1.default.sep, '') + '.projectId';
    const configController = local_configuration_controller_factory_1.configControllerFactory.getInstance('usage_data_preferences.json');
    const cachedProjectId = await configController.get(localProjectIdPath);
    if (cachedProjectId) {
        return cachedProjectId;
    }
    const projectId = (0, uuid_1.v5)(Date.now().toString(), namespace);
    await configController.set(localProjectIdPath, projectId);
    return projectId;
};
exports.getLocalProjectId = getLocalProjectId;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0X2xvY2FsX3Byb2plY3RfaWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGVsZW1ldHJ5L2dldF9sb2NhbF9wcm9qZWN0X2lkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLCtCQUFvQztBQUNwQywyQkFBNkI7QUFDN0IsNkdBQTJGO0FBQzNGLGdEQUF3QjtBQUV4QixvREFBb0Q7QUFDcEQsTUFBTSwwQkFBMEIsR0FBRyxzQ0FBc0MsQ0FBQyxDQUFDLG1CQUFtQjtBQUM5Rjs7R0FFRztBQUNJLE1BQU0saUJBQWlCLEdBQUcsS0FBSyxFQUNwQyxZQUFvQiwwQkFBMEIsRUFDOUMsRUFBRTtJQUNGLE1BQU0sa0JBQWtCLEdBQ3RCLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxZQUFPLEdBQUUsR0FBRyxjQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLFlBQVksQ0FBQztJQUNqRSxNQUFNLGdCQUFnQixHQUFHLGdFQUF1QixDQUFDLFdBQVcsQ0FDMUQsNkJBQTZCLENBQzlCLENBQUM7SUFFRixNQUFNLGVBQWUsR0FDbkIsTUFBTSxnQkFBZ0IsQ0FBQyxHQUFHLENBQVMsa0JBQWtCLENBQUMsQ0FBQztJQUV6RCxJQUFJLGVBQWUsRUFBRSxDQUFDO1FBQ3BCLE9BQU8sZUFBZSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxNQUFNLFNBQVMsR0FBRyxJQUFBLFNBQU0sRUFBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsUUFBUSxFQUFFLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDM0QsTUFBTSxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFFMUQsT0FBTyxTQUFTLENBQUM7QUFDbkIsQ0FBQyxDQUFDO0FBcEJXLFFBQUEsaUJBQWlCLHFCQW9CNUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB2NSBhcyB1dWlkVjUgfSBmcm9tICd1dWlkJztcbmltcG9ydCB7IGhvbWVkaXIgfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBjb25maWdDb250cm9sbGVyRmFjdG9yeSB9IGZyb20gJy4uL2NvbmZpZy9sb2NhbF9jb25maWd1cmF0aW9uX2NvbnRyb2xsZXJfZmFjdG9yeSc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHNwZWxsY2hlY2svc3BlbGwtY2hlY2tlclxuY29uc3QgQU1QTElGWV9DTElfVVVJRF9OQU1FU1BBQ0UgPSAnZTY4MzFmMzUtY2E3YS00ODg5LWE3YmYtNTQxYzgxZDU4ZDQwJzsgLy8gQSByYW5kb20gdjQgVVVJRFxuLyoqXG4gKiBHZW5lcmF0ZXMgYSBjb25zaXN0ZW50IHByb2plY3QgVXVpZFxuICovXG5leHBvcnQgY29uc3QgZ2V0TG9jYWxQcm9qZWN0SWQgPSBhc3luYyAoXG4gIG5hbWVzcGFjZTogc3RyaW5nID0gQU1QTElGWV9DTElfVVVJRF9OQU1FU1BBQ0UsXG4pID0+IHtcbiAgY29uc3QgbG9jYWxQcm9qZWN0SWRQYXRoID1cbiAgICBwcm9jZXNzLmN3ZCgpLnJlcGxhY2UoaG9tZWRpcigpICsgcGF0aC5zZXAsICcnKSArICcucHJvamVjdElkJztcbiAgY29uc3QgY29uZmlnQ29udHJvbGxlciA9IGNvbmZpZ0NvbnRyb2xsZXJGYWN0b3J5LmdldEluc3RhbmNlKFxuICAgICd1c2FnZV9kYXRhX3ByZWZlcmVuY2VzLmpzb24nLFxuICApO1xuXG4gIGNvbnN0IGNhY2hlZFByb2plY3RJZCA9XG4gICAgYXdhaXQgY29uZmlnQ29udHJvbGxlci5nZXQ8c3RyaW5nPihsb2NhbFByb2plY3RJZFBhdGgpO1xuXG4gIGlmIChjYWNoZWRQcm9qZWN0SWQpIHtcbiAgICByZXR1cm4gY2FjaGVkUHJvamVjdElkO1xuICB9XG5cbiAgY29uc3QgcHJvamVjdElkID0gdXVpZFY1KERhdGUubm93KCkudG9TdHJpbmcoKSwgbmFtZXNwYWNlKTtcbiAgYXdhaXQgY29uZmlnQ29udHJvbGxlci5zZXQobG9jYWxQcm9qZWN0SWRQYXRoLCBwcm9qZWN0SWQpO1xuXG4gIHJldHVybiBwcm9qZWN0SWQ7XG59O1xuIl19