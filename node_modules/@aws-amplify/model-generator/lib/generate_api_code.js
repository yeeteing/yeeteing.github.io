import { createGraphqlModelsGenerator } from './create_graphql_models_generator.js';
import { createGraphqlTypesGenerator } from './create_graphql_types_generator.js';
import { createGraphqlDocumentGenerator } from './create_graphql_document_generator.js';
import { getOutputFileName } from '@aws-amplify/graphql-types-generator';
import path from 'path';
export var GenerateApiCodeFormat;
(function (GenerateApiCodeFormat) {
    GenerateApiCodeFormat["MODELGEN"] = "modelgen";
    GenerateApiCodeFormat["GRAPHQL_CODEGEN"] = "graphql-codegen";
    GenerateApiCodeFormat["INTROSPECTION"] = "introspection";
})(GenerateApiCodeFormat || (GenerateApiCodeFormat = {}));
export var GenerateApiCodeModelTarget;
(function (GenerateApiCodeModelTarget) {
    GenerateApiCodeModelTarget["JAVA"] = "java";
    GenerateApiCodeModelTarget["SWIFT"] = "swift";
    GenerateApiCodeModelTarget["JAVASCRIPT"] = "javascript";
    GenerateApiCodeModelTarget["TYPESCRIPT"] = "typescript";
    GenerateApiCodeModelTarget["DART"] = "dart";
})(GenerateApiCodeModelTarget || (GenerateApiCodeModelTarget = {}));
export var GenerateApiCodeStatementTarget;
(function (GenerateApiCodeStatementTarget) {
    GenerateApiCodeStatementTarget["JAVASCRIPT"] = "javascript";
    GenerateApiCodeStatementTarget["GRAPHQL"] = "graphql";
    GenerateApiCodeStatementTarget["FLOW"] = "flow";
    GenerateApiCodeStatementTarget["TYPESCRIPT"] = "typescript";
    GenerateApiCodeStatementTarget["ANGULAR"] = "angular";
})(GenerateApiCodeStatementTarget || (GenerateApiCodeStatementTarget = {}));
export var GenerateApiCodeTypeTarget;
(function (GenerateApiCodeTypeTarget) {
    GenerateApiCodeTypeTarget["JSON"] = "json";
    GenerateApiCodeTypeTarget["SWIFT"] = "swift";
    GenerateApiCodeTypeTarget["TYPESCRIPT"] = "typescript";
    GenerateApiCodeTypeTarget["FLOW"] = "flow";
    GenerateApiCodeTypeTarget["SCALA"] = "scala";
    GenerateApiCodeTypeTarget["FLOW_MODERN"] = "flow-modern";
    GenerateApiCodeTypeTarget["ANGULAR"] = "angular";
})(GenerateApiCodeTypeTarget || (GenerateApiCodeTypeTarget = {}));
/**
 * Generate api code using Api Code Generator with default generators.
 */
export const generateApiCode = async (props) => {
    const backendIdentifier = props;
    return new ApiCodeGenerator(createGraphqlDocumentGenerator({
        backendIdentifier,
        awsClientProvider: props.awsClientProvider,
    }), createGraphqlTypesGenerator({
        backendIdentifier,
        awsClientProvider: props.awsClientProvider,
    }), createGraphqlModelsGenerator({
        backendIdentifier,
        awsClientProvider: props.awsClientProvider,
    })).generate(props);
};
/**
 * Generator for Api Code resources.
 */
export class ApiCodeGenerator {
    graphqlDocumentGenerator;
    graphqlTypesGenerator;
    graphqlModelsGenerator;
    /**
     * Construct generator, passing in nested generators.
     * @param graphqlDocumentGenerator the graphql document generator
     * @param graphqlTypesGenerator the type generator
     * @param graphqlModelsGenerator the model object generator
     */
    constructor(graphqlDocumentGenerator, graphqlTypesGenerator, graphqlModelsGenerator) {
        this.graphqlDocumentGenerator = graphqlDocumentGenerator;
        this.graphqlTypesGenerator = graphqlTypesGenerator;
        this.graphqlModelsGenerator = graphqlModelsGenerator;
    }
    /**
     * Execute the generation.
     * @param props the required generate options.
     * @returns a promise with the generation results
     */
    generate(props) {
        switch (props.format) {
            case 'graphql-codegen': {
                return this.generateGraphqlCodegenApiCode(props);
            }
            case 'modelgen': {
                return this.generateModelgenApiCode(props);
            }
            case 'introspection': {
                return this.generateIntrospectionApiCode();
            }
            default:
                // eslint-disable-next-line @aws-amplify/amplify-backend-rules/prefer-amplify-errors
                throw new Error(`${props.format} is not a supported format.`);
        }
    }
    /**
     * Execute document, and optionally type generation with relevant targets, wiring through types into statements if possible.
     */
    async generateGraphqlCodegenApiCode(props) {
        const generateModelsParams = {
            targetFormat: props.statementTarget,
            maxDepth: props.maxDepth,
            typenameIntrospection: props.typeNameIntrospection,
        };
        if (props.statementTarget === GenerateApiCodeStatementTarget.TYPESCRIPT &&
            props.typeTarget === GenerateApiCodeTypeTarget.TYPESCRIPT) {
            // Cast to unknown to string since the original input to this is typed as a required string, but expects an optional
            // value, and we want to rely on that behavior.
            const typeOutputFilepath = getOutputFileName(null, props.typeTarget);
            const fileName = path.parse(typeOutputFilepath).name;
            // This is an node import path, so we don't want to use path.join, since that'll produce invalid paths on windows platforms
            // Hard-coding since this method explicitly writes to the same directory if types are enabled.
            generateModelsParams.relativeTypesPath = `./${fileName}`;
        }
        const documents = await this.graphqlDocumentGenerator.generateModels(generateModelsParams);
        if (props.typeTarget) {
            const types = await this.graphqlTypesGenerator.generateTypes({
                target: props.typeTarget,
                multipleSwiftFiles: props.multipleSwiftFiles,
                maxDepth: props.maxDepth,
                typenameIntrospection: props.typeNameIntrospection,
            });
            return {
                writeToDirectory: async (directoryPath) => {
                    const filesWritten = [];
                    const { filesWritten: documentsFilesWritten } = await documents.writeToDirectory(directoryPath);
                    const { filesWritten: typesFilesWritten } = await types.writeToDirectory(directoryPath);
                    filesWritten.push(...documentsFilesWritten, ...typesFilesWritten);
                    return {
                        filesWritten,
                    };
                },
                getResults: async () => ({
                    ...(await documents.getResults()),
                    ...(await types.getResults()),
                }),
            };
        }
        return documents;
    }
    /**
     * Execute model generation with model target.
     */
    async generateModelgenApiCode(props) {
        return this.graphqlModelsGenerator.generateModels({
            target: props.modelTarget,
            generateIndexRules: props.generateIndexRules,
            emitAuthProvider: props.emitAuthProvider,
            useExperimentalPipelinedTransformer: props.useExperimentalPipelinedTransformer,
            transformerVersion: props.transformerVersion,
            respectPrimaryKeyAttributesOnConnectionField: props.respectPrimaryKeyAttributesOnConnectionField,
            generateModelsForLazyLoadAndCustomSelectionSet: props.generateModelsForLazyLoadAndCustomSelectionSet,
            addTimestampFields: props.addTimestampFields,
            handleListNullabilityTransparently: props.handleListNullabilityTransparently,
        });
    }
    /**
     * Execute model generation with introspection target.
     */
    async generateIntrospectionApiCode() {
        return this.graphqlModelsGenerator.generateModels({
            target: 'introspection',
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVfYXBpX2NvZGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZ2VuZXJhdGVfYXBpX2NvZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBUUEsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDcEYsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDbEYsT0FBTyxFQUFFLDhCQUE4QixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDeEYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDekUsT0FBTyxJQUFJLE1BQU0sTUFBTSxDQUFDO0FBT3hCLE1BQU0sQ0FBTixJQUFZLHFCQUlYO0FBSkQsV0FBWSxxQkFBcUI7SUFDL0IsOENBQXFCLENBQUE7SUFDckIsNERBQW1DLENBQUE7SUFDbkMsd0RBQStCLENBQUE7QUFDakMsQ0FBQyxFQUpXLHFCQUFxQixLQUFyQixxQkFBcUIsUUFJaEM7QUFFRCxNQUFNLENBQU4sSUFBWSwwQkFNWDtBQU5ELFdBQVksMEJBQTBCO0lBQ3BDLDJDQUFhLENBQUE7SUFDYiw2Q0FBZSxDQUFBO0lBQ2YsdURBQXlCLENBQUE7SUFDekIsdURBQXlCLENBQUE7SUFDekIsMkNBQWEsQ0FBQTtBQUNmLENBQUMsRUFOVywwQkFBMEIsS0FBMUIsMEJBQTBCLFFBTXJDO0FBRUQsTUFBTSxDQUFOLElBQVksOEJBTVg7QUFORCxXQUFZLDhCQUE4QjtJQUN4QywyREFBeUIsQ0FBQTtJQUN6QixxREFBbUIsQ0FBQTtJQUNuQiwrQ0FBYSxDQUFBO0lBQ2IsMkRBQXlCLENBQUE7SUFDekIscURBQW1CLENBQUE7QUFDckIsQ0FBQyxFQU5XLDhCQUE4QixLQUE5Qiw4QkFBOEIsUUFNekM7QUFFRCxNQUFNLENBQU4sSUFBWSx5QkFRWDtBQVJELFdBQVkseUJBQXlCO0lBQ25DLDBDQUFhLENBQUE7SUFDYiw0Q0FBZSxDQUFBO0lBQ2Ysc0RB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RSxLQUFLLENBQUMsV0FBVztZQUN6QixrQkFBa0IsRUFBRSxLQUFLLENBQUMsa0JBQWtCO1lBQzVDLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxnQkFBZ0I7WUFDeEMsbUNBQW1DLEVBQ2pDLEtBQUssQ0FBQyxtQ0FBbUM7WUFDM0Msa0JBQWtCLEVBQUUsS0FBSyxDQUFDLGtCQUFrQjtZQUM1Qyw0Q0FBNEMsRUFDMUMsS0FBSyxDQUFDLDRDQUE0QztZQUNwRCw4Q0FBOEMsRUFDNUMsS0FBSyxDQUFDLDhDQUE4QztZQUN0RCxrQkFBa0IsRUFBRSxLQUFLLENBQUMsa0JBQWtCO1lBQzVDLGtDQUFrQyxFQUNoQyxLQUFLLENBQUMsa0NBQWtDO1NBQzNDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNLLEtBQUssQ0FBQyw0QkFBNEI7UUFDeEMsT0FBTyxJQUFJLENBQUMsc0JBQXNCLENBQUMsY0FBYyxDQUFDO1lBQ2hELE1BQU0sRUFBRSxlQUFlO1NBQ3hCLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIERvY3VtZW50R2VuZXJhdGlvblBhcmFtZXRlcnMsXG4gIEdlbmVyYXRlR3JhcGhxbENvZGVnZW5Ub0ZpbGVSZXN1bHQsXG4gIEdlbmVyYXRpb25SZXN1bHQsXG4gIEdyYXBocWxEb2N1bWVudEdlbmVyYXRvcixcbiAgR3JhcGhxbE1vZGVsc0dlbmVyYXRvcixcbiAgR3JhcGhxbFR5cGVzR2VuZXJhdG9yLFxufSBmcm9tICcuL21vZGVsX2dlbmVyYXRvci5qcyc7XG5pbXBvcnQgeyBjcmVhdGVHcmFwaHFsTW9kZWxzR2VuZXJhdG9yIH0gZnJvbSAnLi9jcmVhdGVfZ3JhcGhxbF9tb2RlbHNfZ2VuZXJhdG9yLmpzJztcbmltcG9ydCB7IGNyZWF0ZUdyYXBocWxUeXBlc0dlbmVyYXRvciB9IGZyb20gJy4vY3JlYXRlX2dyYXBocWxfdHlwZXNfZ2VuZXJhdG9yLmpzJztcbmltcG9ydCB7IGNyZWF0ZUdyYXBocWxEb2N1bWVudEdlbmVyYXRvciB9IGZyb20gJy4vY3JlYXRlX2dyYXBocWxfZG9jdW1lbnRfZ2VuZXJhdG9yLmpzJztcbmltcG9ydCB7IGdldE91dHB1dEZpbGVOYW1lIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L2dyYXBocWwtdHlwZXMtZ2VuZXJhdG9yJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRGVwbG95ZWRCYWNrZW5kSWRlbnRpZmllciB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9kZXBsb3llZC1iYWNrZW5kLWNsaWVudCc7XG5pbXBvcnQgeyBBV1NDbGllbnRQcm92aWRlciB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbHVnaW4tdHlwZXMnO1xuaW1wb3J0IHsgQW1wbGlmeUNsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1hbXBsaWZ5JztcbmltcG9ydCB7IENsb3VkRm9ybWF0aW9uQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWNsb3VkZm9ybWF0aW9uJztcbmltcG9ydCB7IFMzQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LXMzJztcblxuZXhwb3J0IGVudW0gR2VuZXJhdGVBcGlDb2RlRm9ybWF0IHtcbiAgTU9ERUxHRU4gPSAnbW9kZWxnZW4nLFxuICBHUkFQSFFMX0NPREVHRU4gPSAnZ3JhcGhxbC1jb2RlZ2VuJyxcbiAgSU5UUk9TUEVDVElPTiA9ICdpbnRyb3NwZWN0aW9uJyxcbn1cblxuZXhwb3J0IGVudW0gR2VuZXJhdGVBcGlDb2RlTW9kZWxUYXJnZXQge1xuICBKQVZBID0gJ2phdmEnLFxuICBTV0lGVCA9ICdzd2lmdCcsXG4gIEpBVkFTQ1JJUFQgPSAnamF2YXNjcmlwdCcsXG4gIFRZUEVTQ1JJUFQgPSAndHlwZXNjcmlwdCcsXG4gIERBUlQgPSAnZGFydCcsXG59XG5cbmV4cG9ydCBlbnVtIEdlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldCB7XG4gIEpBVkFTQ1JJUFQgPSAnamF2YXNjcmlwdCcsXG4gIEdSQVBIUUwgPSAnZ3JhcGhxbCcsXG4gIEZMT1cgPSAnZmxvdycsXG4gIFRZUEVTQ1JJUFQgPSAndHlwZXNjcmlwdCcsXG4gIEFOR1VMQVIgPSAnYW5ndWxhcicsXG59XG5cbmV4cG9ydCBlbnVtIEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQge1xuICBKU09OID0gJ2pzb24nLFxuICBTV0lGVCA9ICdzd2lmdCcsXG4gIFRZUEVTQ1JJUFQgPSAndHlwZXNjcmlwdCcsXG4gIEZMT1cgPSAnZmxvdycsXG4gIFNDQUxBID0gJ3NjYWxhJyxcbiAgRkxPV19NT0RFUk4gPSAnZmxvdy1tb2Rlcm4nLFxuICBBTkdVTEFSID0gJ2FuZ3VsYXInLFxufVxuXG5leHBvcnQgdHlwZSBHZW5lcmF0ZU1vZGVsc09wdGlvbnMgPSB7XG4gIGZvcm1hdDogR2VuZXJhdGVBcGlDb2RlRm9ybWF0Lk1PREVMR0VOO1xuICBtb2RlbFRhcmdldDogR2VuZXJhdGVBcGlDb2RlTW9kZWxUYXJnZXQ7XG4gIGdlbmVyYXRlSW5kZXhSdWxlcz86IGJvb2xlYW47XG4gIGVtaXRBdXRoUHJvdmlkZXI/OiBib29sZWFuO1xuICB1c2VFeHBlcmltZW50YWxQaXBlbGluZWRUcmFuc2Zvcm1lcj86IGJvb2xlYW47XG4gIHRyYW5zZm9ybWVyVmVyc2lvbj86IG51bWJlcjtcbiAgcmVzcGVjdFByaW1hcnlLZXlBdHRyaWJ1dGVzT25Db25uZWN0aW9uRmllbGQ/OiBib29sZWFuO1xuICBnZW5lcmF0ZU1vZGVsc0ZvckxhenlMb2FkQW5kQ3VzdG9tU2VsZWN0aW9uU2V0PzogYm9vbGVhbjtcbiAgYWRkVGltZXN0YW1wRmllbGRzPzogYm9vbGVhbjtcbiAgaGFuZGxlTGlzdE51bGxhYmlsaXR5VHJhbnNwYXJlbnRseT86IGJvb2xlYW47XG59O1xuXG5leHBvcnQgdHlwZSBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuT3B0aW9ucyA9IHtcbiAgZm9ybWF0OiBHZW5lcmF0ZUFwaUNvZGVGb3JtYXQuR1JBUEhRTF9DT0RFR0VOO1xuICBzdGF0ZW1lbnRUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldDtcbiAgbWF4RGVwdGg/OiBudW1iZXI7XG4gIHR5cGVOYW1lSW50cm9zcGVjdGlvbj86IGJvb2xlYW47XG4gIHR5cGVUYXJnZXQ/OiBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0O1xuICBtdWx0aXBsZVN3aWZ0RmlsZXM/OiBib29sZWFuO1xufTtcblxuZXhwb3J0IHR5cGUgR2VuZXJhdGVJbnRyb3NwZWN0aW9uT3B0aW9ucyA9IHtcbiAgZm9ybWF0OiBHZW5lcmF0ZUFwaUNvZGVGb3JtYXQuSU5UUk9TUEVDVElPTjtcbn07XG5cbmV4cG9ydCB0eXBlIEdlbmVyYXRlT3B0aW9ucyA9XG4gIHwgR2VuZXJhdGVHcmFwaHFsQ29kZWdlbk9wdGlvbnNcbiAgfCBHZW5lcmF0ZU1vZGVsc09wdGlvbnNcbiAgfCBHZW5lcmF0ZUludHJvc3BlY3Rpb25PcHRpb25zO1xuXG5leHBvcnQgdHlwZSBHZW5lcmF0ZUFwaUNvZGVQcm9wcyA9IEdlbmVyYXRlT3B0aW9ucyAmXG4gIERlcGxveWVkQmFja2VuZElkZW50aWZpZXIgJiB7XG4gICAgYXdzQ2xpZW50UHJvdmlkZXI6IEFXU0NsaWVudFByb3ZpZGVyPHtcbiAgICAgIGdldEFtcGxpZnlDbGllbnQ6IEFtcGxpZnlDbGllbnQ7XG4gICAgICBnZXRDbG91ZEZvcm1hdGlvbkNsaWVudDogQ2xvdWRGb3JtYXRpb25DbGllbnQ7XG4gICAgICBnZXRTM0NsaWVudDogUzNDbGllbnQ7XG4gICAgfT47XG4gIH07XG5cbi8qKlxuICogR2VuZXJhdGUgYXBpIGNvZGUgdXNpbmcgQXBpIENvZGUgR2VuZXJhdG9yIHdpdGggZGVmYXVsdCBnZW5lcmF0b3JzLlxuICovXG5leHBvcnQgY29uc3QgZ2VuZXJhdGVBcGlDb2RlID0gYXN5bmMgKFxuICBwcm9wczogR2VuZXJhdGVBcGlDb2RlUHJvcHMsXG4pOiBQcm9taXNlPEdlbmVyYXRpb25SZXN1bHQ+ID0+IHtcbiAgY29uc3QgYmFja2VuZElkZW50aWZpZXIgPSBwcm9wcztcbiAgcmV0dXJuIG5ldyBBcGlDb2RlR2VuZXJhdG9yKFxuICAgIGNyZWF0ZUdyYXBocWxEb2N1bWVudEdlbmVyYXRvcih7XG4gICAgICBiYWNrZW5kSWRlbnRpZmllcixcbiAgICAgIGF3c0NsaWVudFByb3ZpZGVyOiBwcm9wcy5hd3NDbGllbnRQcm92aWRlcixcbiAgICB9KSxcbiAgICBjcmVhdGVHcmFwaHFsVHlwZXNHZW5lcmF0b3Ioe1xuICAgICAgYmFja2VuZElkZW50aWZpZXIsXG4gICAgICBhd3NDbGllbnRQcm92aWRlcjogcHJvcHMuYXdzQ2xpZW50UHJvdmlkZXIsXG4gICAgfSksXG4gICAgY3JlYXRlR3JhcGhxbE1vZGVsc0dlbmVyYXRvcih7XG4gICAgICBiYWNrZW5kSWRlbnRpZmllcixcbiAgICAgIGF3c0NsaWVudFByb3ZpZGVyOiBwcm9wcy5hd3NDbGllbnRQcm92aWRlcixcbiAgICB9KSxcbiAgKS5nZW5lcmF0ZShwcm9wcyk7XG59O1xuXG4vKipcbiAqIEdlbmVyYXRvciBmb3IgQXBpIENvZGUgcmVzb3VyY2VzLlxuICovXG5leHBvcnQgY2xhc3MgQXBpQ29kZUdlbmVyYXRvciB7XG4gIC8qKlxuICAgKiBDb25zdHJ1Y3QgZ2VuZXJhdG9yLCBwYXNzaW5nIGluIG5lc3RlZCBnZW5lcmF0b3JzLlxuICAgKiBAcGFyYW0gZ3JhcGhxbERvY3VtZW50R2VuZXJhdG9yIHRoZSBncmFwaHFsIGRvY3VtZW50IGdlbmVyYXRvclxuICAgKiBAcGFyYW0gZ3JhcGhxbFR5cGVzR2VuZXJhdG9yIHRoZSB0eXBlIGdlbmVyYXRvclxuICAgKiBAcGFyYW0gZ3JhcGhxbE1vZGVsc0dlbmVyYXRvciB0aGUgbW9kZWwgb2JqZWN0IGdlbmVyYXRvclxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBncmFwaHFsRG9jdW1lbnRHZW5lcmF0b3I6IEdyYXBocWxEb2N1bWVudEdlbmVyYXRvcixcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdyYXBocWxUeXBlc0dlbmVyYXRvcjogR3JhcGhxbFR5cGVzR2VuZXJhdG9yLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZ3JhcGhxbE1vZGVsc0dlbmVyYXRvcjogR3JhcGhxbE1vZGVsc0dlbmVyYXRvcixcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIHRoZSBnZW5lcmF0aW9uLlxuICAgKiBAcGFyYW0gcHJvcHMgdGhlIHJlcXVpcmVkIGdlbmVyYXRlIG9wdGlvbnMuXG4gICAqIEByZXR1cm5zIGEgcHJvbWlzZSB3aXRoIHRoZSBnZW5lcmF0aW9uIHJlc3VsdHNcbiAgICovXG4gIGdlbmVyYXRlKHByb3BzOiBHZW5lcmF0ZU9wdGlvbnMpOiBQcm9taXNlPEdlbmVyYXRpb25SZXN1bHQ+IHtcbiAgICBzd2l0Y2ggKHByb3BzLmZvcm1hdCkge1xuICAgICAgY2FzZSAnZ3JhcGhxbC1jb2RlZ2VuJzoge1xuICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUdyYXBocWxDb2RlZ2VuQXBpQ29kZShwcm9wcyk7XG4gICAgICB9XG4gICAgICBjYXNlICdtb2RlbGdlbic6IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVNb2RlbGdlbkFwaUNvZGUocHJvcHMpO1xuICAgICAgfVxuICAgICAgY2FzZSAnaW50cm9zcGVjdGlvbic6IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVJbnRyb3NwZWN0aW9uQXBpQ29kZSgpO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhd3MtYW1wbGlmeS9hbXBsaWZ5LWJhY2tlbmQtcnVsZXMvcHJlZmVyLWFtcGxpZnktZXJyb3JzXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgJHtcbiAgICAgICAgICAgIChwcm9wcyBhcyBHZW5lcmF0ZUFwaUNvZGVQcm9wcykuZm9ybWF0IGFzIHN0cmluZ1xuICAgICAgICAgIH0gaXMgbm90IGEgc3VwcG9ydGVkIGZvcm1hdC5gLFxuICAgICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGRvY3VtZW50LCBhbmQgb3B0aW9uYWxseSB0eXBlIGdlbmVyYXRpb24gd2l0aCByZWxldmFudCB0YXJnZXRzLCB3aXJpbmcgdGhyb3VnaCB0eXBlcyBpbnRvIHN0YXRlbWVudHMgaWYgcG9zc2libGUuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlR3JhcGhxbENvZGVnZW5BcGlDb2RlKFxuICAgIHByb3BzOiBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuT3B0aW9ucyxcbiAgKTogUHJvbWlzZTxHZW5lcmF0aW9uUmVzdWx0PiB7XG4gICAgY29uc3QgZ2VuZXJhdGVNb2RlbHNQYXJhbXM6IERvY3VtZW50R2VuZXJhdGlvblBhcmFtZXRlcnMgPSB7XG4gICAgICB0YXJnZXRGb3JtYXQ6IHByb3BzLnN0YXRlbWVudFRhcmdldCxcbiAgICAgIG1heERlcHRoOiBwcm9wcy5tYXhEZXB0aCxcbiAgICAgIHR5cGVuYW1lSW50cm9zcGVjdGlvbjogcHJvcHMudHlwZU5hbWVJbnRyb3NwZWN0aW9uLFxuICAgIH07XG4gICAgaWYgKFxuICAgICAgcHJvcHMuc3RhdGVtZW50VGFyZ2V0ID09PSBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQuVFlQRVNDUklQVCAmJlxuICAgICAgcHJvcHMudHlwZVRhcmdldCA9PT0gR2VuZXJhdGVBcGlDb2RlVHlwZVRhcmdldC5UWVBFU0NSSVBUXG4gICAgKSB7XG4gICAgICAvLyBDYXN0IHRvIHVua25vd24gdG8gc3RyaW5nIHNpbmNlIHRoZSBvcmlnaW5hbCBpbnB1dCB0byB0aGlzIGlzIHR5cGVkIGFzIGEgcmVxdWlyZWQgc3RyaW5nLCBidXQgZXhwZWN0cyBhbiBvcHRpb25hbFxuICAgICAgLy8gdmFsdWUsIGFuZCB3ZSB3YW50IHRvIHJlbHkgb24gdGhhdCBiZWhhdmlvci5cbiAgICAgIGNvbnN0IHR5cGVPdXRwdXRGaWxlcGF0aCA9IGdldE91dHB1dEZpbGVOYW1lKFxuICAgICAgICBudWxsIGFzIHVua25vd24gYXMgc3RyaW5nLFxuICAgICAgICBwcm9wcy50eXBlVGFyZ2V0LFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGZpbGVOYW1lID0gcGF0aC5wYXJzZSh0eXBlT3V0cHV0RmlsZXBhdGgpLm5hbWU7XG4gICAgICAvLyBUaGlzIGlzIGFuIG5vZGUgaW1wb3J0IHBhdGgsIHNvIHdlIGRvbid0IHdhbnQgdG8gdXNlIHBhdGguam9pbiwgc2luY2UgdGhhdCdsbCBwcm9kdWNlIGludmFsaWQgcGF0aHMgb24gd2luZG93cyBwbGF0Zm9ybXNcbiAgICAgIC8vIEhhcmQtY29kaW5nIHNpbmNlIHRoaXMgbWV0aG9kIGV4cGxpY2l0bHkgd3JpdGVzIHRvIHRoZSBzYW1lIGRpcmVjdG9yeSBpZiB0eXBlcyBhcmUgZW5hYmxlZC5cbiAgICAgIGdlbmVyYXRlTW9kZWxzUGFyYW1zLnJlbGF0aXZlVHlwZXNQYXRoID0gYC4vJHtmaWxlTmFtZX1gO1xuICAgIH1cbiAgICBjb25zdCBkb2N1bWVudHMgPVxuICAgICAgYXdhaXQgdGhpcy5ncmFwaHFsRG9jdW1lbnRHZW5lcmF0b3IuZ2VuZXJhdGVNb2RlbHMoZ2VuZXJhdGVNb2RlbHNQYXJhbXMpO1xuXG4gICAgaWYgKHByb3BzLnR5cGVUYXJnZXQpIHtcbiAgICAgIGNvbnN0IHR5cGVzID0gYXdhaXQgdGhpcy5ncmFwaHFsVHlwZXNHZW5lcmF0b3IuZ2VuZXJhdGVUeXBlcyh7XG4gICAgICAgIHRhcmdldDogcHJvcHMudHlwZVRhcmdldCxcbiAgICAgICAgbXVsdGlwbGVTd2lmdEZpbGVzOiBwcm9wcy5tdWx0aXBsZVN3aWZ0RmlsZXMsXG4gICAgICAgIG1heERlcHRoOiBwcm9wcy5tYXhEZXB0aCxcbiAgICAgICAgdHlwZW5hbWVJbnRyb3NwZWN0aW9uOiBwcm9wcy50eXBlTmFtZUludHJvc3BlY3Rpb24sXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd3JpdGVUb0RpcmVjdG9yeTogYXN5bmMgKFxuICAgICAgICAgIGRpcmVjdG9yeVBhdGg6IHN0cmluZyxcbiAgICAgICAgKTogUHJvbWlzZTxHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuVG9GaWxlUmVzdWx0PiA9PiB7XG4gICAgICAgICAgY29uc3QgZmlsZXNXcml0dGVuOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgIGNvbnN0IHsgZmlsZXNXcml0dGVuOiBkb2N1bWVudHNGaWxlc1dyaXR0ZW4gfSA9XG4gICAgICAgICAgICBhd2FpdCBkb2N1bWVudHMud3JpdGVUb0RpcmVjdG9yeShkaXJlY3RvcnlQYXRoKTtcbiAgICAgICAgICBjb25zdCB7IGZpbGVzV3JpdHRlbjogdHlwZXNGaWxlc1dyaXR0ZW4gfSA9XG4gICAgICAgICAgICBhd2FpdCB0eXBlcy53cml0ZVRvRGlyZWN0b3J5KGRpcmVjdG9yeVBhdGgpO1xuICAgICAgICAgIGZpbGVzV3JpdHRlbi5wdXNoKC4uLmRvY3VtZW50c0ZpbGVzV3JpdHRlbiwgLi4udHlwZXNGaWxlc1dyaXR0ZW4pO1xuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpbGVzV3JpdHRlbixcbiAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICBnZXRSZXN1bHRzOiBhc3luYyAoKSA9PiAoe1xuICAgICAgICAgIC4uLihhd2FpdCBkb2N1bWVudHMuZ2V0UmVzdWx0cygpKSxcbiAgICAgICAgICAuLi4oYXdhaXQgdHlwZXMuZ2V0UmVzdWx0cygpKSxcbiAgICAgICAgfSksXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBkb2N1bWVudHM7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBtb2RlbCBnZW5lcmF0aW9uIHdpdGggbW9kZWwgdGFyZ2V0LlxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZU1vZGVsZ2VuQXBpQ29kZShcbiAgICBwcm9wczogR2VuZXJhdGVNb2RlbHNPcHRpb25zLFxuICApOiBQcm9taXNlPEdlbmVyYXRpb25SZXN1bHQ+IHtcbiAgICByZXR1cm4gdGhpcy5ncmFwaHFsTW9kZWxzR2VuZXJhdG9yLmdlbmVyYXRlTW9kZWxzKHtcbiAgICAgIHRhcmdldDogcHJvcHMubW9kZWxUYXJnZXQsXG4gICAgICBnZW5lcmF0ZUluZGV4UnVsZXM6IHByb3BzLmdlbmVyYXRlSW5kZXhSdWxlcyxcbiAgICAgIGVtaXRBdXRoUHJvdmlkZXI6IHByb3BzLmVtaXRBdXRoUHJvdmlkZXIsXG4gICAgICB1c2VFeHBlcmltZW50YWxQaXBlbGluZWRUcmFuc2Zvcm1lcjpcbiAgICAgICAgcHJvcHMudXNlRXhwZXJpbWVudGFsUGlwZWxpbmVkVHJhbnNmb3JtZXIsXG4gICAgICB0cmFuc2Zvcm1lclZlcnNpb246IHByb3BzLnRyYW5zZm9ybWVyVmVyc2lvbixcbiAgICAgIHJlc3BlY3RQcmltYXJ5S2V5QXR0cmlidXRlc09uQ29ubmVjdGlvbkZpZWxkOlxuICAgICAgICBwcm9wcy5yZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZCxcbiAgICAgIGdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQ6XG4gICAgICAgIHByb3BzLmdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQsXG4gICAgICBhZGRUaW1lc3RhbXBGaWVsZHM6IHByb3BzLmFkZFRpbWVzdGFtcEZpZWxkcyxcbiAgICAgIGhhbmRsZUxpc3ROdWxsYWJpbGl0eVRyYW5zcGFyZW50bHk6XG4gICAgICAgIHByb3BzLmhhbmRsZUxpc3ROdWxsYWJpbGl0eVRyYW5zcGFyZW50bHksXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBtb2RlbCBnZW5lcmF0aW9uIHdpdGggaW50cm9zcGVjdGlvbiB0YXJnZXQuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlSW50cm9zcGVjdGlvbkFwaUNvZGUoKTogUHJvbWlzZTxHZW5lcmF0aW9uUmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMuZ3JhcGhxbE1vZGVsc0dlbmVyYXRvci5nZW5lcmF0ZU1vZGVscyh7XG4gICAgICB0YXJnZXQ6ICdpbnRyb3NwZWN0aW9uJyxcbiAgICB9KTtcbiAgfVxufVxuIl19