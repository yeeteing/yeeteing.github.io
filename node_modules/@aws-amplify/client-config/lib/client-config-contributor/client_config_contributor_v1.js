import { authOutputKey, customOutputKey, graphqlOutputKey, storageOutputKey, } from '@aws-amplify/backend-output-schemas';
import { ClientConfigVersionOption, } from '../client-config-types/client_config.js';
// All categories client config contributors are included here to mildly enforce them using
// the same schema (version and other types)
/**
 * Translator for the version number of ClientConfig of V1.4
 */
export class VersionContributor {
    contribute = () => {
        return { version: ClientConfigVersionOption.V1_4 };
    };
}
/**
 * Translator for the version number of ClientConfig of V1.3
 */
// eslint-disable-next-line @typescript-eslint/naming-convention
export class VersionContributorV1_3 {
    /**
     * Return the version of the schema types that this contributor uses
     */
    contribute = () => {
        return { version: ClientConfigVersionOption.V1_3 };
    };
}
/**
 * Translator for the version number of ClientConfig of V1.2
 */
// eslint-disable-next-line @typescript-eslint/naming-convention
export class VersionContributorV1_2 {
    /**
     * Return the version of the schema types that this contributor uses
     */
    contribute = () => {
        return { version: ClientConfigVersionOption.V1_2 };
    };
}
/**
 * Translator for the version number of ClientConfig of V1.1
 */
// eslint-disable-next-line @typescript-eslint/naming-convention
export class VersionContributorV1_1 {
    /**
     * Return the version of the schema types that this contributor uses
     */
    contribute = () => {
        return { version: ClientConfigVersionOption.V1_1 };
    };
}
/**
 * Translator for the version number of ClientConfig of V1.0
 */
export class VersionContributorV1 {
    /**
     * Return the version of the schema types that this contributor uses
     */
    contribute = () => {
        return { version: ClientConfigVersionOption.V1 };
    };
}
/**
 * Translator for the Auth portion of ClientConfig in V1.3
 */
export class AuthClientConfigContributor {
    /**
     * Given some BackendOutput, contribute the Auth portion of the ClientConfig
     */
    contribute = ({ [authOutputKey]: authOutput, }) => {
        if (authOutput === undefined) {
            return {};
        }
        const parseAndAssignObject = (obj, key, value) => {
            if (value == null) {
                return;
            }
            obj[key] = JSON.parse(value);
        };
        const authClientConfig = {};
        authClientConfig.auth = {
            user_pool_id: authOutput.payload.userPoolId,
            aws_region: authOutput.payload.authRegion,
            user_pool_client_id: authOutput.payload.webClientId,
        };
        if (authOutput.payload.identityPoolId) {
            authClientConfig.auth.identity_pool_id =
                authOutput.payload.identityPoolId;
        }
        parseAndAssignObject(authClientConfig.auth, 'mfa_methods', authOutput.payload.mfaTypes);
        parseAndAssignObject(authClientConfig.auth, 'standard_required_attributes', authOutput.payload.signupAttributes);
        parseAndAssignObject(authClientConfig.auth, 'username_attributes', authOutput.payload.usernameAttributes);
        parseAndAssignObject(authClientConfig.auth, 'user_verification_types', authOutput.payload.verificationMechanisms);
        parseAndAssignObject(authClientConfig.auth, 'groups', authOutput.payload.groups);
        if (authOutput.payload.mfaConfiguration) {
            switch (authOutput.payload.mfaConfiguration) {
                case 'OFF': {
                    authClientConfig.auth.mfa_configuration = 'NONE';
                    break;
                }
                case 'OPTIONAL': {
                    authClientConfig.auth.mfa_configuration = 'OPTIONAL';
                    break;
                }
                case 'ON': {
                    authClientConfig.auth.mfa_configuration = 'REQUIRED';
                }
            }
        }
        if (authOutput.payload.passwordPolicyMinLength ||
            authOutput.payload.passwordPolicyRequirements) {
            authClientConfig.auth.password_policy = {
                min_length: 8, // This is the default that is matching what construct defines.
                // Values below are set to false instead of being undefined as libraries expect defined values.
                // They are overridden below with construct outputs (default or not) if applicable.
                require_lowercase: false,
                require_numbers: false,
                require_symbols: false,
                require_uppercase: false,
            };
            if (authOutput.payload.passwordPolicyMinLength) {
                authClientConfig.auth.password_policy.min_length = Number.parseInt(authOutput.payload.passwordPolicyMinLength);
            }
            if (authOutput.payload.passwordPolicyRequirements) {
                const requirements = JSON.parse(authOutput.payload.passwordPolicyRequirements);
                for (const requirement of requirements) {
                    switch (requirement) {
                        case 'REQUIRES_NUMBERS':
                            authClientConfig.auth.password_policy.require_numbers = true;
                            break;
                        case 'REQUIRES_LOWERCASE':
                            authClientConfig.auth.password_policy.require_lowercase = true;
                            break;
                        case 'REQUIRES_UPPERCASE':
                            authClientConfig.auth.password_policy.require_uppercase = true;
                            break;
                        case 'REQUIRES_SYMBOLS':
                            authClientConfig.auth.password_policy.require_symbols = true;
                            break;
                    }
                }
            }
        }
        // OAuth settings are present if both oauthRedirectSignIn and oauthRedirectSignOut are.
        if (authOutput.payload.oauthRedirectSignIn &&
            authOutput.payload.oauthRedirectSignOut) {
            let socialProviders = authOutput.payload.socialProviders
                ? JSON.parse(authOutput.payload.socialProviders)
                : [];
            if (Array.isArray(socialProviders)) {
                socialProviders = socialProviders.filter(this.isValidIdentityProvider);
            }
            authClientConfig.auth.oauth = {
                identity_providers: socialProviders,
                redirect_sign_in_uri: authOutput.payload.oauthRedirectSignIn.split(','),
                redirect_sign_out_uri: authOutput.payload.oauthRedirectSignOut.split(','),
                response_type: authOutput.payload.oauthResponseType,
                scopes: authOutput.payload.oauthScope
                    ? JSON.parse(authOutput.payload.oauthScope)
                    : [],
                domain: authOutput.payload.oauthCognitoDomain ?? '',
            };
        }
        if (authOutput.payload.allowUnauthenticatedIdentities) {
            authClientConfig.auth.unauthenticated_identities_enabled =
                authOutput.payload.allowUnauthenticatedIdentities === 'true';
        }
        return authClientConfig;
    };
    // Define a type guard function to check if a value is a valid IdentityProvider
    isValidIdentityProvider = (identityProvider) => {
        return [
            'GOOGLE',
            'FACEBOOK',
            'LOGIN_WITH_AMAZON',
            'SIGN_IN_WITH_APPLE',
        ].includes(identityProvider);
    };
}
/**
 * Translator for the Auth portion of ClientConfig in V1.2
 */
// eslint-disable-next-line @typescript-eslint/naming-convention
export class AuthClientConfigContributorV1_1 {
    /**
     * Given some BackendOutput, contribute the Auth portion of the ClientConfig
     */
    contribute = ({ [authOutputKey]: authOutput, }) => {
        if (authOutput === undefined) {
            return {};
        }
        const parseAndAssignObject = (obj, key, value) => {
            if (value == null) {
                return;
            }
            obj[key] = JSON.parse(value);
        };
        const authClientConfig = {};
        authClientConfig.auth = {
            user_pool_id: authOutput.payload.userPoolId,
            aws_region: authOutput.payload.authRegion,
            user_pool_client_id: authOutput.payload.webClientId,
        };
        if (authOutput.payload.identityPoolId) {
            authClientConfig.auth.identity_pool_id =
                authOutput.payload.identityPoolId;
        }
        parseAndAssignObject(authClientConfig.auth, 'mfa_methods', authOutput.payload.mfaTypes);
        parseAndAssignObject(authClientConfig.auth, 'standard_required_attributes', authOutput.payload.signupAttributes);
        parseAndAssignObject(authClientConfig.auth, 'username_attributes', authOutput.payload.usernameAttributes);
        parseAndAssignObject(authClientConfig.auth, 'user_verification_types', authOutput.payload.verificationMechanisms);
        if (authOutput.payload.mfaConfiguration) {
            switch (authOutput.payload.mfaConfiguration) {
                case 'OFF': {
                    authClientConfig.auth.mfa_configuration = 'NONE';
                    break;
                }
                case 'OPTIONAL': {
                    authClientConfig.auth.mfa_configuration = 'OPTIONAL';
                    break;
                }
                case 'ON': {
                    authClientConfig.auth.mfa_configuration = 'REQUIRED';
                }
            }
        }
        if (authOutput.payload.passwordPolicyMinLength ||
            authOutput.payload.passwordPolicyRequirements) {
            authClientConfig.auth.password_policy = {
                min_length: 8, // This is the default that is matching what construct defines.
                // Values below are set to false instead of being undefined as libraries expect defined values.
                // They are overridden below with construct outputs (default or not) if applicable.
                require_lowercase: false,
                require_numbers: false,
                require_symbols: false,
                require_uppercase: false,
            };
            if (authOutput.payload.passwordPolicyMinLength) {
                authClientConfig.auth.password_policy.min_length = Number.parseInt(authOutput.payload.passwordPolicyMinLength);
            }
            if (authOutput.payload.passwordPolicyRequirements) {
                const requirements = JSON.parse(authOutput.payload.passwordPolicyRequirements);
                for (const requirement of requirements) {
                    switch (requirement) {
                        case 'REQUIRES_NUMBERS':
                            authClientConfig.auth.password_policy.require_numbers = true;
                            break;
                        case 'REQUIRES_LOWERCASE':
                            authClientConfig.auth.password_policy.require_lowercase = true;
                            break;
                        case 'REQUIRES_UPPERCASE':
                            authClientConfig.auth.password_policy.require_uppercase = true;
                            break;
                        case 'REQUIRES_SYMBOLS':
                            authClientConfig.auth.password_policy.require_symbols = true;
                            break;
                    }
                }
            }
        }
        // OAuth settings are present if both oauthRedirectSignIn and oauthRedirectSignOut are.
        if (authOutput.payload.oauthRedirectSignIn &&
            authOutput.payload.oauthRedirectSignOut) {
            let socialProviders = authOutput.payload.socialProviders
                ? JSON.parse(authOutput.payload.socialProviders)
                : [];
            if (Array.isArray(socialProviders)) {
                socialProviders = socialProviders.filter(this.isValidIdentityProvider);
            }
            authClientConfig.auth.oauth = {
                identity_providers: socialProviders,
                redirect_sign_in_uri: authOutput.payload.oauthRedirectSignIn.split(','),
                redirect_sign_out_uri: authOutput.payload.oauthRedirectSignOut.split(','),
                response_type: authOutput.payload.oauthResponseType,
                scopes: authOutput.payload.oauthScope
                    ? JSON.parse(authOutput.payload.oauthScope)
                    : [],
                domain: authOutput.payload.oauthCognitoDomain ?? '',
            };
        }
        if (authOutput.payload.allowUnauthenticatedIdentities) {
            authClientConfig.auth.unauthenticated_identities_enabled =
                authOutput.payload.allowUnauthenticatedIdentities === 'true';
        }
        return authClientConfig;
    };
    // Define a type guard function to check if a value is a valid IdentityProvider
    isValidIdentityProvider = (identityProvider) => {
        return [
            'GOOGLE',
            'FACEBOOK',
            'LOGIN_WITH_AMAZON',
            'SIGN_IN_WITH_APPLE',
        ].includes(identityProvider);
    };
}
/**
 * Translator for the Data portion of ClientConfig
 */
export class DataClientConfigContributor {
    modelIntrospectionSchemaAdapter;
    /**
     * Constructor
     * @param modelIntrospectionSchemaAdapter the adapter to provide the model introspection schema from s3 uri
     */
    constructor(modelIntrospectionSchemaAdapter) {
        this.modelIntrospectionSchemaAdapter = modelIntrospectionSchemaAdapter;
    }
    /**
     * Given some BackendOutput, contribute the Graphql API portion of the client config
     */
    contribute = async ({ [graphqlOutputKey]: graphqlOutput, }) => {
        if (graphqlOutput === undefined) {
            return {};
        }
        const config = {};
        config.data = {
            url: graphqlOutput.payload.awsAppsyncApiEndpoint,
            aws_region: graphqlOutput.payload.awsAppsyncRegion,
            api_key: graphqlOutput.payload.awsAppsyncApiKey,
            default_authorization_type: graphqlOutput.payload.awsAppsyncAuthenticationType,
            authorization_types: graphqlOutput.payload.awsAppsyncAdditionalAuthenticationTypes?.split(','),
        };
        const modelIntrospection = await this.modelIntrospectionSchemaAdapter.getModelIntrospectionSchemaFromS3Uri(graphqlOutput.payload.amplifyApiModelSchemaS3Uri);
        if (modelIntrospection) {
            config.data.model_introspection = modelIntrospection;
        }
        return config;
    };
}
/**
 * Translator for the Storage portion of ClientConfig in V1.2
 */
// eslint-disable-next-line @typescript-eslint/naming-convention
export class StorageClientConfigContributor {
    /**
     * Given some BackendOutput, contribute the Storage portion of the client config
     */
    contribute = ({ [storageOutputKey]: storageOutput, }) => {
        if (storageOutput === undefined) {
            return {};
        }
        const config = {};
        const bucketsStringArray = JSON.parse(storageOutput.payload.buckets ?? '[]');
        config.storage = {
            aws_region: storageOutput.payload.storageRegion,
            bucket_name: storageOutput.payload.bucketName,
            buckets: bucketsStringArray
                .map((b) => JSON.parse(b))
                .map(({ name, bucketName, storageRegion, paths, }) => ({
                name,
                bucket_name: bucketName,
                aws_region: storageRegion,
                paths,
            })),
        };
        return config;
    };
}
/**
 * Translator for the Storage portion of ClientConfig in V1.1
 */
// eslint-disable-next-line @typescript-eslint/naming-convention
export class StorageClientConfigContributorV1_1 {
    /**
     * Given some BackendOutput, contribute the Storage portion of the client config
     */
    contribute = ({ [storageOutputKey]: storageOutput, }) => {
        if (storageOutput === undefined) {
            return {};
        }
        const config = {};
        const bucketsStringArray = JSON.parse(storageOutput.payload.buckets ?? '[]');
        config.storage = {
            aws_region: storageOutput.payload.storageRegion,
            bucket_name: storageOutput.payload.bucketName,
            buckets: bucketsStringArray
                .map((b) => JSON.parse(b))
                .map(({ name, bucketName, storageRegion, }) => ({
                name,
                bucket_name: bucketName,
                aws_region: storageRegion,
            })),
        };
        return config;
    };
}
/**
 * Translator for the Storage portion of ClientConfig in V1
 */
export class StorageClientConfigContributorV1 {
    /**
     * Given some BackendOutput, contribute the Storage portion of the client config
     */
    contribute = ({ [storageOutputKey]: storageOutput, }) => {
        if (storageOutput === undefined) {
            return {};
        }
        const config = {};
        config.storage = {
            aws_region: storageOutput.payload.storageRegion,
            bucket_name: storageOutput.payload.bucketName,
        };
        return config;
    };
}
/**
 * Translator for the Custom portion of ClientConfig
 */
export class CustomClientConfigContributor {
    /**
     * Given some BackendOutput, contribute the Custom portion of the ClientConfig
     */
    contribute = ({ [customOutputKey]: customOutput, }) => {
        if (customOutput === undefined) {
            return {};
        }
        return JSON.parse(customOutput.payload.customOutputs);
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpZW50X2NvbmZpZ19jb250cmlidXRvcl92MS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGllbnQtY29uZmlnLWNvbnRyaWJ1dG9yL2NsaWVudF9jb25maWdfY29udHJpYnV0b3JfdjEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUVMLGFBQWEsRUFDYixlQUFlLEVBQ2YsZ0JBQWdCLEVBQ2hCLGdCQUFnQixHQUNqQixNQUFNLHFDQUFxQyxDQUFDO0FBQzdDLE9BQU8sRUFFTCx5QkFBeUIsR0FLMUIsTUFBTSx5Q0FBeUMsQ0FBQztBQUtqRCwyRkFBMkY7QUFDM0YsNENBQTRDO0FBRTVDOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGtCQUFrQjtJQUM3QixVQUFVLEdBQUcsR0FBaUIsRUFBRTtRQUM5QixPQUFPLEVBQUUsT0FBTyxFQUFFLHlCQUF5QixDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3JELENBQUMsQ0FBQztDQUNIO0FBRUQ7O0dBRUc7QUFDSCxnRUFBZ0U7QUFDaEUsTUFBTSxPQUFPLHNCQUFzQjtJQUNqQzs7T0FFRztJQUNILFVBQVUsR0FBRyxHQUFpQixFQUFFO1FBQzlCLE9BQU8sRUFBRSxPQUFPLEVBQUUseUJBQXlCLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDckQsQ0FBQyxDQUFDO0NBQ0g7QUFFRDs7R0FFRztBQUNILGdFQUFnRTtBQUNoRSxNQUFNLE9BQU8sc0JBQXNCO0lBQ2pDOztPQUVHO0lBQ0gsVUFBVSxHQUFHLEdBQWlCLEVBQUU7UUFDOUIsT0FBTyxFQUFFLE9BQU8sRUFBRSx5QkFBeUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNyRCxDQUFDLENBQUM7Q0FDSDtBQUVEOztHQUVHO0FBQ0gsZ0VBQWdFO0FBQ2hFLE1BQU0sT0FBTyxzQkFBc0I7SUFDakM7O09BRUc7SUFDSCxVQUFVLEdBQUcsR0FBaUIsRUFBRTtRQUM5QixPQUFPLEVBQUUsT0FBTyxFQUFFLHlCQUF5QixDQUFDLElB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Q0FBQztJQUNoQixDQUFDLENBQUM7Q0FDSDtBQUVEOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGdDQUFnQztJQUczQzs7T0FFRztJQUNILFVBQVUsR0FBRyxDQUFDLEVBQ1osQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLGFBQWEsR0FDWixFQUFpRCxFQUFFO1FBQ3hFLElBQUksYUFBYSxLQUFLLFNBQVMsRUFBRSxDQUFDO1lBQ2hDLE9BQU8sRUFBRSxDQUFDO1FBQ1osQ0FBQztRQUNELE1BQU0sTUFBTSxHQUEwRCxFQUFFLENBQUM7UUFFekUsTUFBTSxDQUFDLE9BQU8sR0FBRztZQUNmLFVBQVUsRUFBRSxhQUFhLENBQUMsT0FBTyxDQUFDLGFBQWE7WUFDL0MsV0FBVyxFQUFFLGFBQWEsQ0FBQyxPQUFPLENBQUMsVUFBVTtTQUM5QyxDQUFDO1FBRUYsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQyxDQUFDO0NBQ0g7QUFFRDs7R0FFRztBQUNILE1BQU0sT0FBTyw2QkFBNkI7SUFDeEM7O09BRUc7SUFDSCxVQUFVLEdBQUcsQ0FBQyxFQUNaLENBQUMsZUFBZSxDQUFDLEVBQUUsWUFBWSxHQUNWLEVBQXlCLEVBQUU7UUFDaEQsSUFBSSxZQUFZLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDL0IsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDeEQsQ0FBQyxDQUFDO0NBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDbGllbnRDb25maWdDb250cmlidXRvciB9IGZyb20gJy4uL2NsaWVudC1jb25maWctdHlwZXMvY2xpZW50X2NvbmZpZ19jb250cmlidXRvci5qcyc7XG5pbXBvcnQge1xuICBVbmlmaWVkQmFja2VuZE91dHB1dCxcbiAgYXV0aE91dHB1dEtleSxcbiAgY3VzdG9tT3V0cHV0S2V5LFxuICBncmFwaHFsT3V0cHV0S2V5LFxuICBzdG9yYWdlT3V0cHV0S2V5LFxufSBmcm9tICdAYXdzLWFtcGxpZnkvYmFja2VuZC1vdXRwdXQtc2NoZW1hcyc7XG5pbXBvcnQge1xuICBDbGllbnRDb25maWcsXG4gIENsaWVudENvbmZpZ1ZlcnNpb25PcHRpb24sXG4gIGNsaWVudENvbmZpZ1R5cGVzVjEsXG4gIGNsaWVudENvbmZpZ1R5cGVzVjFfMSxcbiAgY2xpZW50Q29uZmlnVHlwZXNWMV8yLFxuICBjbGllbnRDb25maWdUeXBlc1YxXzMsXG59IGZyb20gJy4uL2NsaWVudC1jb25maWctdHlwZXMvY2xpZW50X2NvbmZpZy5qcyc7XG5pbXBvcnQgeyBNb2RlbEludHJvc3BlY3Rpb25TY2hlbWFBZGFwdGVyIH0gZnJvbSAnLi4vbW9kZWxfaW50cm9zcGVjdGlvbl9zY2hlbWFfYWRhcHRlci5qcyc7XG5pbXBvcnQgeyBBd3NBcHBzeW5jQXV0aG9yaXphdGlvblR5cGUgfSBmcm9tICcuLi9jbGllbnQtY29uZmlnLXNjaGVtYS9jbGllbnRfY29uZmlnX3YxLjEuanMnO1xuaW1wb3J0IHsgQW1wbGlmeVN0b3JhZ2VBY2Nlc3NSdWxlIH0gZnJvbSAnLi4vY2xpZW50LWNvbmZpZy1zY2hlbWEvY2xpZW50X2NvbmZpZ192MS4yLmpzJztcblxuLy8gQWxsIGNhdGVnb3JpZXMgY2xpZW50IGNvbmZpZyBjb250cmlidXRvcnMgYXJlIGluY2x1ZGVkIGhlcmUgdG8gbWlsZGx5IGVuZm9yY2UgdGhlbSB1c2luZ1xuLy8gdGhlIHNhbWUgc2NoZW1hICh2ZXJzaW9uIGFuZCBvdGhlciB0eXBlcylcblxuLyoqXG4gKiBUcmFuc2xhdG9yIGZvciB0aGUgdmVyc2lvbiBudW1iZXIgb2YgQ2xpZW50Q29uZmlnIG9mIFYxLjRcbiAqL1xuZXhwb3J0IGNsYXNzIFZlcnNpb25Db250cmlidXRvciBpbXBsZW1lbnRzIENsaWVudENvbmZpZ0NvbnRyaWJ1dG9yIHtcbiAgY29udHJpYnV0ZSA9ICgpOiBDbGllbnRDb25maWcgPT4ge1xuICAgIHJldHVybiB7IHZlcnNpb246IENsaWVudENvbmZpZ1ZlcnNpb25PcHRpb24uVjFfNCB9O1xuICB9O1xufVxuXG4vKipcbiAqIFRyYW5zbGF0b3IgZm9yIHRoZSB2ZXJzaW9uIG51bWJlciBvZiBDbGllbnRDb25maWcgb2YgVjEuM1xuICovXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25hbWluZy1jb252ZW50aW9uXG5leHBvcnQgY2xhc3MgVmVyc2lvbkNvbnRyaWJ1dG9yVjFfMyBpbXBsZW1lbnRzIENsaWVudENvbmZpZ0NvbnRyaWJ1dG9yIHtcbiAgLyoqXG4gICAqIFJldHVybiB0aGUgdmVyc2lvbiBvZiB0aGUgc2NoZW1hIHR5cGVzIHRoYXQgdGhpcyBjb250cmlidXRvciB1c2VzXG4gICAqL1xuICBjb250cmlidXRlID0gKCk6IENsaWVudENvbmZpZyA9PiB7XG4gICAgcmV0dXJuIHsgdmVyc2lvbjogQ2xpZW50Q29uZmlnVmVyc2lvbk9wdGlvbi5WMV8zIH07XG4gIH07XG59XG5cbi8qKlxuICogVHJhbnNsYXRvciBmb3IgdGhlIHZlcnNpb24gbnVtYmVyIG9mIENsaWVudENvbmZpZyBvZiBWMS4yXG4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbmFtaW5nLWNvbnZlbnRpb25cbmV4cG9ydCBjbGFzcyBWZXJzaW9uQ29udHJpYnV0b3JWMV8yIGltcGxlbWVudHMgQ2xpZW50Q29uZmlnQ29udHJpYnV0b3Ige1xuICAvKipcbiAgICogUmV0dXJuIHRoZSB2ZXJzaW9uIG9mIHRoZSBzY2hlbWEgdHlwZXMgdGhhdCB0aGlzIGNvbnRyaWJ1dG9yIHVzZXNcbiAgICovXG4gIGNvbnRyaWJ1dGUgPSAoKTogQ2xpZW50Q29uZmlnID0+IHtcbiAgICByZXR1cm4geyB2ZXJzaW9uOiBDbGllbnRDb25maWdWZXJzaW9uT3B0aW9uLlYxXzIgfTtcbiAgfTtcbn1cblxuLyoqXG4gKiBUcmFuc2xhdG9yIGZvciB0aGUgdmVyc2lvbiBudW1iZXIgb2YgQ2xpZW50Q29uZmlnIG9mIFYxLjFcbiAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uYW1pbmctY29udmVudGlvblxuZXhwb3J0IGNsYXNzIFZlcnNpb25Db250cmlidXRvclYxXzEgaW1wbGVtZW50cyBDbGllbnRDb25maWdDb250cmlidXRvciB7XG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIHZlcnNpb24gb2YgdGhlIHNjaGVtYSB0eXBlcyB0aGF0IHRoaXMgY29udHJpYnV0b3IgdXNlc1xuICAgKi9cbiAgY29udHJpYnV0ZSA9ICgpOiBDbGllbnRDb25maWcgPT4ge1xuICAgIHJldHVybiB7IHZlcnNpb246IENsaWVudENvbmZpZ1ZlcnNpb25PcHRpb24uVjFfMSB9O1xuICB9O1xufVxuXG4vKipcbiAqIFRyYW5zbGF0b3IgZm9yIHRoZSB2ZXJzaW9uIG51bWJlciBvZiBDbGllbnRDb25maWcgb2YgVjEuMFxuICovXG5leHBvcnQgY2xhc3MgVmVyc2lvbkNvbnRyaWJ1dG9yVjEgaW1wbGVtZW50cyBDbGllbnRDb25maWdDb250cmlidXRvciB7XG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIHZlcnNpb24gb2YgdGhlIHNjaGVtYSB0eXBlcyB0aGF0IHRoaXMgY29udHJpYnV0b3IgdXNlc1xuICAgKi9cbiAgY29udHJpYnV0ZSA9ICgpOiBDbGllbnRDb25maWcgPT4ge1xuICAgIHJldHVybiB7IHZlcnNpb246IENsaWVudENvbmZpZ1ZlcnNpb25PcHRpb24uVjEgfTtcbiAgfTtcbn1cblxuLyoqXG4gKiBUcmFuc2xhdG9yIGZvciB0aGUgQXV0aCBwb3J0aW9uIG9mIENsaWVudENvbmZpZyBpbiBWMS4zXG4gKi9cbmV4cG9ydCBjbGFzcyBBdXRoQ2xpZW50Q29uZmlnQ29udHJpYnV0b3IgaW1wbGVtZW50cyBDbGllbnRDb25maWdDb250cmlidXRvciB7XG4gIC8qKlxuICAgKiBHaXZlbiBzb21lIEJhY2tlbmRPdXRwdXQsIGNvbnRyaWJ1dGUgdGhlIEF1dGggcG9ydGlvbiBvZiB0aGUgQ2xpZW50Q29uZmlnXG4gICAqL1xuICBjb250cmlidXRlID0gKHtcbiAgICBbYXV0aE91dHB1dEtleV06IGF1dGhPdXRwdXQsXG4gIH06IFVuaWZpZWRCYWNrZW5kT3V0cHV0KTogUGFydGlhbDxDbGllbnRDb25maWc+IHwgUmVjb3JkPHN0cmluZywgbmV2ZXI+ID0+IHtcbiAgICBpZiAoYXV0aE91dHB1dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgY29uc3QgcGFyc2VBbmRBc3NpZ25PYmplY3QgPSA8VD4oXG4gICAgICBvYmo6IFQsXG4gICAgICBrZXk6IGtleW9mIFQsXG4gICAgICB2YWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkLFxuICAgICkgPT4ge1xuICAgICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgb2JqW2tleV0gPSBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICB9O1xuXG4gICAgY29uc3QgYXV0aENsaWVudENvbmZpZzogUGFydGlhbDxjbGllbnRDb25maWdUeXBlc1YxXzMuQVdTQW1wbGlmeUJhY2tlbmRPdXRwdXRzPiA9XG4gICAgICB7fTtcblxuICAgIGF1dGhDbGllbnRDb25maWcuYXV0aCA9IHtcbiAgICAgIHVzZXJfcG9vbF9pZDogYXV0aE91dHB1dC5wYXlsb2FkLnVzZXJQb29sSWQsXG4gICAgICBhd3NfcmVnaW9uOiBhdXRoT3V0cHV0LnBheWxvYWQuYXV0aFJlZ2lvbixcbiAgICAgIHVzZXJfcG9vbF9jbGllbnRfaWQ6IGF1dGhPdXRwdXQucGF5bG9hZC53ZWJDbGllbnRJZCxcbiAgICB9O1xuXG4gICAgaWYgKGF1dGhPdXRwdXQucGF5bG9hZC5pZGVudGl0eVBvb2xJZCkge1xuICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLmlkZW50aXR5X3Bvb2xfaWQgPVxuICAgICAgICBhdXRoT3V0cHV0LnBheWxvYWQuaWRlbnRpdHlQb29sSWQ7XG4gICAgfVxuXG4gICAgcGFyc2VBbmRBc3NpZ25PYmplY3QoXG4gICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGgsXG4gICAgICAnbWZhX21ldGhvZHMnLFxuICAgICAgYXV0aE91dHB1dC5wYXlsb2FkLm1mYVR5cGVzLFxuICAgICk7XG5cbiAgICBwYXJzZUFuZEFzc2lnbk9iamVjdChcbiAgICAgIGF1dGhDbGllbnRDb25maWcuYXV0aCxcbiAgICAgICdzdGFuZGFyZF9yZXF1aXJlZF9hdHRyaWJ1dGVzJyxcbiAgICAgIGF1dGhPdXRwdXQucGF5bG9hZC5zaWdudXBBdHRyaWJ1dGVzLFxuICAgICk7XG5cbiAgICBwYXJzZUFuZEFzc2lnbk9iamVjdChcbiAgICAgIGF1dGhDbGllbnRDb25maWcuYXV0aCxcbiAgICAgICd1c2VybmFtZV9hdHRyaWJ1dGVzJyxcbiAgICAgIGF1dGhPdXRwdXQucGF5bG9hZC51c2VybmFtZUF0dHJpYnV0ZXMsXG4gICAgKTtcblxuICAgIHBhcnNlQW5kQXNzaWduT2JqZWN0KFxuICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLFxuICAgICAgJ3VzZXJfdmVyaWZpY2F0aW9uX3R5cGVzJyxcbiAgICAgIGF1dGhPdXRwdXQucGF5bG9hZC52ZXJpZmljYXRpb25NZWNoYW5pc21zLFxuICAgICk7XG5cbiAgICBwYXJzZUFuZEFzc2lnbk9iamVjdChcbiAgICAgIGF1dGhDbGllbnRDb25maWcuYXV0aCxcbiAgICAgICdncm91cHMnLFxuICAgICAgYXV0aE91dHB1dC5wYXlsb2FkLmdyb3VwcyxcbiAgICApO1xuXG4gICAgaWYgKGF1dGhPdXRwdXQucGF5bG9hZC5tZmFDb25maWd1cmF0aW9uKSB7XG4gICAgICBzd2l0Y2ggKGF1dGhPdXRwdXQucGF5bG9hZC5tZmFDb25maWd1cmF0aW9uKSB7XG4gICAgICAgIGNhc2UgJ09GRic6IHtcbiAgICAgICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGgubWZhX2NvbmZpZ3VyYXRpb24gPSAnTk9ORSc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnT1BUSU9OQUwnOiB7XG4gICAgICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLm1mYV9jb25maWd1cmF0aW9uID0gJ09QVElPTkFMJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdPTic6IHtcbiAgICAgICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGgubWZhX2NvbmZpZ3VyYXRpb24gPSAnUkVRVUlSRUQnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgYXV0aE91dHB1dC5wYXlsb2FkLnBhc3N3b3JkUG9saWN5TWluTGVuZ3RoIHx8XG4gICAgICBhdXRoT3V0cHV0LnBheWxvYWQucGFzc3dvcmRQb2xpY3lSZXF1aXJlbWVudHNcbiAgICApIHtcbiAgICAgIGF1dGhDbGllbnRDb25maWcuYXV0aC5wYXNzd29yZF9wb2xpY3kgPSB7XG4gICAgICAgIG1pbl9sZW5ndGg6IDgsIC8vIFRoaXMgaXMgdGhlIGRlZmF1bHQgdGhhdCBpcyBtYXRjaGluZyB3aGF0IGNvbnN0cnVjdCBkZWZpbmVzLlxuICAgICAgICAvLyBWYWx1ZXMgYmVsb3cgYXJlIHNldCB0byBmYWxzZSBpbnN0ZWFkIG9mIGJlaW5nIHVuZGVmaW5lZCBhcyBsaWJyYXJpZXMgZXhwZWN0IGRlZmluZWQgdmFsdWVzLlxuICAgICAgICAvLyBUaGV5IGFyZSBvdmVycmlkZGVuIGJlbG93IHdpdGggY29uc3RydWN0IG91dHB1dHMgKGRlZmF1bHQgb3Igbm90KSBpZiBhcHBsaWNhYmxlLlxuICAgICAgICByZXF1aXJlX2xvd2VyY2FzZTogZmFsc2UsXG4gICAgICAgIHJlcXVpcmVfbnVtYmVyczogZmFsc2UsXG4gICAgICAgIHJlcXVpcmVfc3ltYm9sczogZmFsc2UsXG4gICAgICAgIHJlcXVpcmVfdXBwZXJjYXNlOiBmYWxzZSxcbiAgICAgIH07XG4gICAgICBpZiAoYXV0aE91dHB1dC5wYXlsb2FkLnBhc3N3b3JkUG9saWN5TWluTGVuZ3RoKSB7XG4gICAgICAgIGF1dGhDbGllbnRDb25maWcuYXV0aC5wYXNzd29yZF9wb2xpY3kubWluX2xlbmd0aCA9IE51bWJlci5wYXJzZUludChcbiAgICAgICAgICBhdXRoT3V0cHV0LnBheWxvYWQucGFzc3dvcmRQb2xpY3lNaW5MZW5ndGgsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoYXV0aE91dHB1dC5wYXlsb2FkLnBhc3N3b3JkUG9saWN5UmVxdWlyZW1lbnRzKSB7XG4gICAgICAgIGNvbnN0IHJlcXVpcmVtZW50cyA9IEpTT04ucGFyc2UoXG4gICAgICAgICAgYXV0aE91dHB1dC5wYXlsb2FkLnBhc3N3b3JkUG9saWN5UmVxdWlyZW1lbnRzLFxuICAgICAgICApIGFzIHN0cmluZ1tdO1xuICAgICAgICBmb3IgKGNvbnN0IHJlcXVpcmVtZW50IG9mIHJlcXVpcmVtZW50cykge1xuICAgICAgICAgIHN3aXRjaCAocmVxdWlyZW1lbnQpIHtcbiAgICAgICAgICAgIGNhc2UgJ1JFUVVJUkVTX05VTUJFUlMnOlxuICAgICAgICAgICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGgucGFzc3dvcmRfcG9saWN5LnJlcXVpcmVfbnVtYmVycyA9IHRydWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnUkVRVUlSRVNfTE9XRVJDQVNFJzpcbiAgICAgICAgICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLnBhc3N3b3JkX3BvbGljeS5yZXF1aXJlX2xvd2VyY2FzZSA9IHRydWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnUkVRVUlSRVNfVVBQRVJDQVNFJzpcbiAgICAgICAgICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLnBhc3N3b3JkX3BvbGljeS5yZXF1aXJlX3VwcGVyY2FzZSA9IHRydWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnUkVRVUlSRVNfU1lNQk9MUyc6XG4gICAgICAgICAgICAgIGF1dGhDbGllbnRDb25maWcuYXV0aC5wYXNzd29yZF9wb2xpY3kucmVxdWlyZV9zeW1ib2xzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gT0F1dGggc2V0dGluZ3MgYXJlIHByZXNlbnQgaWYgYm90aCBvYXV0aFJlZGlyZWN0U2lnbkluIGFuZCBvYXV0aFJlZGlyZWN0U2lnbk91dCBhcmUuXG4gICAgaWYgKFxuICAgICAgYXV0aE91dHB1dC5wYXlsb2FkLm9hdXRoUmVkaXJlY3RTaWduSW4gJiZcbiAgICAgIGF1dGhPdXRwdXQucGF5bG9hZC5vYXV0aFJlZGlyZWN0U2lnbk91dFxuICAgICkge1xuICAgICAgbGV0IHNvY2lhbFByb3ZpZGVycyA9IGF1dGhPdXRwdXQucGF5bG9hZC5zb2NpYWxQcm92aWRlcnNcbiAgICAgICAgPyBKU09OLnBhcnNlKGF1dGhPdXRwdXQucGF5bG9hZC5zb2NpYWxQcm92aWRlcnMpXG4gICAgICAgIDogW107XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShzb2NpYWxQcm92aWRlcnMpKSB7XG4gICAgICAgIHNvY2lhbFByb3ZpZGVycyA9IHNvY2lhbFByb3ZpZGVycy5maWx0ZXIodGhpcy5pc1ZhbGlkSWRlbnRpdHlQcm92aWRlcik7XG4gICAgICB9XG4gICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGgub2F1dGggPSB7XG4gICAgICAgIGlkZW50aXR5X3Byb3ZpZGVyczogc29jaWFsUHJvdmlkZXJzLFxuICAgICAgICByZWRpcmVjdF9zaWduX2luX3VyaTogYXV0aE91dHB1dC5wYXlsb2FkLm9hdXRoUmVkaXJlY3RTaWduSW4uc3BsaXQoJywnKSxcbiAgICAgICAgcmVkaXJlY3Rfc2lnbl9vdXRfdXJpOlxuICAgICAgICAgIGF1dGhPdXRwdXQucGF5bG9hZC5vYXV0aFJlZGlyZWN0U2lnbk91dC5zcGxpdCgnLCcpLFxuICAgICAgICByZXNwb25zZV90eXBlOiBhdXRoT3V0cHV0LnBheWxvYWQub2F1dGhSZXNwb25zZVR5cGUgYXMgJ2NvZGUnIHwgJ3Rva2VuJyxcbiAgICAgICAgc2NvcGVzOiBhdXRoT3V0cHV0LnBheWxvYWQub2F1dGhTY29wZVxuICAgICAgICAgID8gSlNPTi5wYXJzZShhdXRoT3V0cHV0LnBheWxvYWQub2F1dGhTY29wZSlcbiAgICAgICAgICA6IFtdLFxuICAgICAgICBkb21haW46IGF1dGhPdXRwdXQucGF5bG9hZC5vYXV0aENvZ25pdG9Eb21haW4gPz8gJycsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChhdXRoT3V0cHV0LnBheWxvYWQuYWxsb3dVbmF1dGhlbnRpY2F0ZWRJZGVudGl0aWVzKSB7XG4gICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGgudW5hdXRoZW50aWNhdGVkX2lkZW50aXRpZXNfZW5hYmxlZCA9XG4gICAgICAgIGF1dGhPdXRwdXQucGF5bG9hZC5hbGxvd1VuYXV0aGVudGljYXRlZElkZW50aXRpZXMgPT09ICd0cnVlJztcbiAgICB9XG5cbiAgICByZXR1cm4gYXV0aENsaWVudENvbmZpZztcbiAgfTtcblxuICAvLyBEZWZpbmUgYSB0eXBlIGd1YXJkIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIGEgdmFsdWUgaXMgYSB2YWxpZCBJZGVudGl0eVByb3ZpZGVyXG4gIGlzVmFsaWRJZGVudGl0eVByb3ZpZGVyID0gKGlkZW50aXR5UHJvdmlkZXI6IHN0cmluZyk6IGJvb2xlYW4gPT4ge1xuICAgIHJldHVybiBbXG4gICAgICAnR09PR0xFJyxcbiAgICAgICdGQUNFQk9PSycsXG4gICAgICAnTE9HSU5fV0lUSF9BTUFaT04nLFxuICAgICAgJ1NJR05fSU5fV0lUSF9BUFBMRScsXG4gICAgXS5pbmNsdWRlcyhpZGVudGl0eVByb3ZpZGVyKTtcbiAgfTtcbn1cblxuLyoqXG4gKiBUcmFuc2xhdG9yIGZvciB0aGUgQXV0aCBwb3J0aW9uIG9mIENsaWVudENvbmZpZyBpbiBWMS4yXG4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbmFtaW5nLWNvbnZlbnRpb25cbmV4cG9ydCBjbGFzcyBBdXRoQ2xpZW50Q29uZmlnQ29udHJpYnV0b3JWMV8xXG4gIGltcGxlbWVudHMgQ2xpZW50Q29uZmlnQ29udHJpYnV0b3JcbntcbiAgLyoqXG4gICAqIEdpdmVuIHNvbWUgQmFja2VuZE91dHB1dCwgY29udHJpYnV0ZSB0aGUgQXV0aCBwb3J0aW9uIG9mIHRoZSBDbGllbnRDb25maWdcbiAgICovXG4gIGNvbnRyaWJ1dGUgPSAoe1xuICAgIFthdXRoT3V0cHV0S2V5XTogYXV0aE91dHB1dCxcbiAgfTogVW5pZmllZEJhY2tlbmRPdXRwdXQpOiBQYXJ0aWFsPENsaWVudENvbmZpZz4gfCBSZWNvcmQ8c3RyaW5nLCBuZXZlcj4gPT4ge1xuICAgIGlmIChhdXRoT3V0cHV0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG5cbiAgICBjb25zdCBwYXJzZUFuZEFzc2lnbk9iamVjdCA9IDxUPihcbiAgICAgIG9iajogVCxcbiAgICAgIGtleToga2V5b2YgVCxcbiAgICAgIHZhbHVlOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICAgKSA9PiB7XG4gICAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBvYmpba2V5XSA9IEpTT04ucGFyc2UodmFsdWUpO1xuICAgIH07XG5cbiAgICBjb25zdCBhdXRoQ2xpZW50Q29uZmlnOiBQYXJ0aWFsPGNsaWVudENvbmZpZ1R5cGVzVjFfMi5BV1NBbXBsaWZ5QmFja2VuZE91dHB1dHM+ID1cbiAgICAgIHt9O1xuXG4gICAgYXV0aENsaWVudENvbmZpZy5hdXRoID0ge1xuICAgICAgdXNlcl9wb29sX2lkOiBhdXRoT3V0cHV0LnBheWxvYWQudXNlclBvb2xJZCxcbiAgICAgIGF3c19yZWdpb246IGF1dGhPdXRwdXQucGF5bG9hZC5hdXRoUmVnaW9uLFxuICAgICAgdXNlcl9wb29sX2NsaWVudF9pZDogYXV0aE91dHB1dC5wYXlsb2FkLndlYkNsaWVudElkLFxuICAgIH07XG5cbiAgICBpZiAoYXV0aE91dHB1dC5wYXlsb2FkLmlkZW50aXR5UG9vbElkKSB7XG4gICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGguaWRlbnRpdHlfcG9vbF9pZCA9XG4gICAgICAgIGF1dGhPdXRwdXQucGF5bG9hZC5pZGVudGl0eVBvb2xJZDtcbiAgICB9XG5cbiAgICBwYXJzZUFuZEFzc2lnbk9iamVjdChcbiAgICAgIGF1dGhDbGllbnRDb25maWcuYXV0aCxcbiAgICAgICdtZmFfbWV0aG9kcycsXG4gICAgICBhdXRoT3V0cHV0LnBheWxvYWQubWZhVHlwZXMsXG4gICAgKTtcblxuICAgIHBhcnNlQW5kQXNzaWduT2JqZWN0KFxuICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLFxuICAgICAgJ3N0YW5kYXJkX3JlcXVpcmVkX2F0dHJpYnV0ZXMnLFxuICAgICAgYXV0aE91dHB1dC5wYXlsb2FkLnNpZ251cEF0dHJpYnV0ZXMsXG4gICAgKTtcblxuICAgIHBhcnNlQW5kQXNzaWduT2JqZWN0KFxuICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLFxuICAgICAgJ3VzZXJuYW1lX2F0dHJpYnV0ZXMnLFxuICAgICAgYXV0aE91dHB1dC5wYXlsb2FkLnVzZXJuYW1lQXR0cmlidXRlcyxcbiAgICApO1xuXG4gICAgcGFyc2VBbmRBc3NpZ25PYmplY3QoXG4gICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGgsXG4gICAgICAndXNlcl92ZXJpZmljYXRpb25fdHlwZXMnLFxuICAgICAgYXV0aE91dHB1dC5wYXlsb2FkLnZlcmlmaWNhdGlvbk1lY2hhbmlzbXMsXG4gICAgKTtcblxuICAgIGlmIChhdXRoT3V0cHV0LnBheWxvYWQubWZhQ29uZmlndXJhdGlvbikge1xuICAgICAgc3dpdGNoIChhdXRoT3V0cHV0LnBheWxvYWQubWZhQ29uZmlndXJhdGlvbikge1xuICAgICAgICBjYXNlICdPRkYnOiB7XG4gICAgICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLm1mYV9jb25maWd1cmF0aW9uID0gJ05PTkUnO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ09QVElPTkFMJzoge1xuICAgICAgICAgIGF1dGhDbGllbnRDb25maWcuYXV0aC5tZmFfY29uZmlndXJhdGlvbiA9ICdPUFRJT05BTCc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnT04nOiB7XG4gICAgICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLm1mYV9jb25maWd1cmF0aW9uID0gJ1JFUVVJUkVEJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGF1dGhPdXRwdXQucGF5bG9hZC5wYXNzd29yZFBvbGljeU1pbkxlbmd0aCB8fFxuICAgICAgYXV0aE91dHB1dC5wYXlsb2FkLnBhc3N3b3JkUG9saWN5UmVxdWlyZW1lbnRzXG4gICAgKSB7XG4gICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGgucGFzc3dvcmRfcG9saWN5ID0ge1xuICAgICAgICBtaW5fbGVuZ3RoOiA4LCAvLyBUaGlzIGlzIHRoZSBkZWZhdWx0IHRoYXQgaXMgbWF0Y2hpbmcgd2hhdCBjb25zdHJ1Y3QgZGVmaW5lcy5cbiAgICAgICAgLy8gVmFsdWVzIGJlbG93IGFyZSBzZXQgdG8gZmFsc2UgaW5zdGVhZCBvZiBiZWluZyB1bmRlZmluZWQgYXMgbGlicmFyaWVzIGV4cGVjdCBkZWZpbmVkIHZhbHVlcy5cbiAgICAgICAgLy8gVGhleSBhcmUgb3ZlcnJpZGRlbiBiZWxvdyB3aXRoIGNvbnN0cnVjdCBvdXRwdXRzIChkZWZhdWx0IG9yIG5vdCkgaWYgYXBwbGljYWJsZS5cbiAgICAgICAgcmVxdWlyZV9sb3dlcmNhc2U6IGZhbHNlLFxuICAgICAgICByZXF1aXJlX251bWJlcnM6IGZhbHNlLFxuICAgICAgICByZXF1aXJlX3N5bWJvbHM6IGZhbHNlLFxuICAgICAgICByZXF1aXJlX3VwcGVyY2FzZTogZmFsc2UsXG4gICAgICB9O1xuICAgICAgaWYgKGF1dGhPdXRwdXQucGF5bG9hZC5wYXNzd29yZFBvbGljeU1pbkxlbmd0aCkge1xuICAgICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGgucGFzc3dvcmRfcG9saWN5Lm1pbl9sZW5ndGggPSBOdW1iZXIucGFyc2VJbnQoXG4gICAgICAgICAgYXV0aE91dHB1dC5wYXlsb2FkLnBhc3N3b3JkUG9saWN5TWluTGVuZ3RoLFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKGF1dGhPdXRwdXQucGF5bG9hZC5wYXNzd29yZFBvbGljeVJlcXVpcmVtZW50cykge1xuICAgICAgICBjb25zdCByZXF1aXJlbWVudHMgPSBKU09OLnBhcnNlKFxuICAgICAgICAgIGF1dGhPdXRwdXQucGF5bG9hZC5wYXNzd29yZFBvbGljeVJlcXVpcmVtZW50cyxcbiAgICAgICAgKSBhcyBzdHJpbmdbXTtcbiAgICAgICAgZm9yIChjb25zdCByZXF1aXJlbWVudCBvZiByZXF1aXJlbWVudHMpIHtcbiAgICAgICAgICBzd2l0Y2ggKHJlcXVpcmVtZW50KSB7XG4gICAgICAgICAgICBjYXNlICdSRVFVSVJFU19OVU1CRVJTJzpcbiAgICAgICAgICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLnBhc3N3b3JkX3BvbGljeS5yZXF1aXJlX251bWJlcnMgPSB0cnVlO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ1JFUVVJUkVTX0xPV0VSQ0FTRSc6XG4gICAgICAgICAgICAgIGF1dGhDbGllbnRDb25maWcuYXV0aC5wYXNzd29yZF9wb2xpY3kucmVxdWlyZV9sb3dlcmNhc2UgPSB0cnVlO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ1JFUVVJUkVTX1VQUEVSQ0FTRSc6XG4gICAgICAgICAgICAgIGF1dGhDbGllbnRDb25maWcuYXV0aC5wYXNzd29yZF9wb2xpY3kucmVxdWlyZV91cHBlcmNhc2UgPSB0cnVlO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ1JFUVVJUkVTX1NZTUJPTFMnOlxuICAgICAgICAgICAgICBhdXRoQ2xpZW50Q29uZmlnLmF1dGgucGFzc3dvcmRfcG9saWN5LnJlcXVpcmVfc3ltYm9scyA9IHRydWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE9BdXRoIHNldHRpbmdzIGFyZSBwcmVzZW50IGlmIGJvdGggb2F1dGhSZWRpcmVjdFNpZ25JbiBhbmQgb2F1dGhSZWRpcmVjdFNpZ25PdXQgYXJlLlxuICAgIGlmIChcbiAgICAgIGF1dGhPdXRwdXQucGF5bG9hZC5vYXV0aFJlZGlyZWN0U2lnbkluICYmXG4gICAgICBhdXRoT3V0cHV0LnBheWxvYWQub2F1dGhSZWRpcmVjdFNpZ25PdXRcbiAgICApIHtcbiAgICAgIGxldCBzb2NpYWxQcm92aWRlcnMgPSBhdXRoT3V0cHV0LnBheWxvYWQuc29jaWFsUHJvdmlkZXJzXG4gICAgICAgID8gSlNPTi5wYXJzZShhdXRoT3V0cHV0LnBheWxvYWQuc29jaWFsUHJvdmlkZXJzKVxuICAgICAgICA6IFtdO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc29jaWFsUHJvdmlkZXJzKSkge1xuICAgICAgICBzb2NpYWxQcm92aWRlcnMgPSBzb2NpYWxQcm92aWRlcnMuZmlsdGVyKHRoaXMuaXNWYWxpZElkZW50aXR5UHJvdmlkZXIpO1xuICAgICAgfVxuICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLm9hdXRoID0ge1xuICAgICAgICBpZGVudGl0eV9wcm92aWRlcnM6IHNvY2lhbFByb3ZpZGVycyxcbiAgICAgICAgcmVkaXJlY3Rfc2lnbl9pbl91cmk6IGF1dGhPdXRwdXQucGF5bG9hZC5vYXV0aFJlZGlyZWN0U2lnbkluLnNwbGl0KCcsJyksXG4gICAgICAgIHJlZGlyZWN0X3NpZ25fb3V0X3VyaTpcbiAgICAgICAgICBhdXRoT3V0cHV0LnBheWxvYWQub2F1dGhSZWRpcmVjdFNpZ25PdXQuc3BsaXQoJywnKSxcbiAgICAgICAgcmVzcG9uc2VfdHlwZTogYXV0aE91dHB1dC5wYXlsb2FkLm9hdXRoUmVzcG9uc2VUeXBlIGFzICdjb2RlJyB8ICd0b2tlbicsXG4gICAgICAgIHNjb3BlczogYXV0aE91dHB1dC5wYXlsb2FkLm9hdXRoU2NvcGVcbiAgICAgICAgICA/IEpTT04ucGFyc2UoYXV0aE91dHB1dC5wYXlsb2FkLm9hdXRoU2NvcGUpXG4gICAgICAgICAgOiBbXSxcbiAgICAgICAgZG9tYWluOiBhdXRoT3V0cHV0LnBheWxvYWQub2F1dGhDb2duaXRvRG9tYWluID8/ICcnLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoYXV0aE91dHB1dC5wYXlsb2FkLmFsbG93VW5hdXRoZW50aWNhdGVkSWRlbnRpdGllcykge1xuICAgICAgYXV0aENsaWVudENvbmZpZy5hdXRoLnVuYXV0aGVudGljYXRlZF9pZGVudGl0aWVzX2VuYWJsZWQgPVxuICAgICAgICBhdXRoT3V0cHV0LnBheWxvYWQuYWxsb3dVbmF1dGhlbnRpY2F0ZWRJZGVudGl0aWVzID09PSAndHJ1ZSc7XG4gICAgfVxuXG4gICAgcmV0dXJuIGF1dGhDbGllbnRDb25maWc7XG4gIH07XG5cbiAgLy8gRGVmaW5lIGEgdHlwZSBndWFyZCBmdW5jdGlvbiB0byBjaGVjayBpZiBhIHZhbHVlIGlzIGEgdmFsaWQgSWRlbnRpdHlQcm92aWRlclxuICBpc1ZhbGlkSWRlbnRpdHlQcm92aWRlciA9IChpZGVudGl0eVByb3ZpZGVyOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICByZXR1cm4gW1xuICAgICAgJ0dPT0dMRScsXG4gICAgICAnRkFDRUJPT0snLFxuICAgICAgJ0xPR0lOX1dJVEhfQU1BWk9OJyxcbiAgICAgICdTSUdOX0lOX1dJVEhfQVBQTEUnLFxuICAgIF0uaW5jbHVkZXMoaWRlbnRpdHlQcm92aWRlcik7XG4gIH07XG59XG5cbi8qKlxuICogVHJhbnNsYXRvciBmb3IgdGhlIERhdGEgcG9ydGlvbiBvZiBDbGllbnRDb25maWdcbiAqL1xuZXhwb3J0IGNsYXNzIERhdGFDbGllbnRDb25maWdDb250cmlidXRvciBpbXBsZW1lbnRzIENsaWVudENvbmZpZ0NvbnRyaWJ1dG9yIHtcbiAgLyoqXG4gICAqIENvbnN0cnVjdG9yXG4gICAqIEBwYXJhbSBtb2RlbEludHJvc3BlY3Rpb25TY2hlbWFBZGFwdGVyIHRoZSBhZGFwdGVyIHRvIHByb3ZpZGUgdGhlIG1vZGVsIGludHJvc3BlY3Rpb24gc2NoZW1hIGZyb20gczMgdXJpXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IG1vZGVsSW50cm9zcGVjdGlvblNjaGVtYUFkYXB0ZXI6IE1vZGVsSW50cm9zcGVjdGlvblNjaGVtYUFkYXB0ZXIsXG4gICkge31cblxuICAvKipcbiAgICogR2l2ZW4gc29tZSBCYWNrZW5kT3V0cHV0LCBjb250cmlidXRlIHRoZSBHcmFwaHFsIEFQSSBwb3J0aW9uIG9mIHRoZSBjbGllbnQgY29uZmlnXG4gICAqL1xuICBjb250cmlidXRlID0gYXN5bmMgKHtcbiAgICBbZ3JhcGhxbE91dHB1dEtleV06IGdyYXBocWxPdXRwdXQsXG4gIH06IFVuaWZpZWRCYWNrZW5kT3V0cHV0KTogUHJvbWlzZTxcbiAgICBQYXJ0aWFsPENsaWVudENvbmZpZz4gfCBSZWNvcmQ8c3RyaW5nLCBuZXZlcj5cbiAgPiA9PiB7XG4gICAgaWYgKGdyYXBocWxPdXRwdXQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgICBjb25zdCBjb25maWc6IFBhcnRpYWw8Y2xpZW50Q29uZmlnVHlwZXNWMV8xLkFXU0FtcGxpZnlCYWNrZW5kT3V0cHV0cz4gPSB7fTtcblxuICAgIGNvbmZpZy5kYXRhID0ge1xuICAgICAgdXJsOiBncmFwaHFsT3V0cHV0LnBheWxvYWQuYXdzQXBwc3luY0FwaUVuZHBvaW50LFxuICAgICAgYXdzX3JlZ2lvbjogZ3JhcGhxbE91dHB1dC5wYXlsb2FkLmF3c0FwcHN5bmNSZWdpb24sXG4gICAgICBhcGlfa2V5OiBncmFwaHFsT3V0cHV0LnBheWxvYWQuYXdzQXBwc3luY0FwaUtleSxcbiAgICAgIGRlZmF1bHRfYXV0aG9yaXphdGlvbl90eXBlOlxuICAgICAgICBncmFwaHFsT3V0cHV0LnBheWxvYWQuYXdzQXBwc3luY0F1dGhlbnRpY2F0aW9uVHlwZSxcbiAgICAgIGF1dGhvcml6YXRpb25fdHlwZXM6XG4gICAgICAgIGdyYXBocWxPdXRwdXQucGF5bG9hZC5hd3NBcHBzeW5jQWRkaXRpb25hbEF1dGhlbnRpY2F0aW9uVHlwZXM/LnNwbGl0KFxuICAgICAgICAgICcsJyxcbiAgICAgICAgKSBhcyBBd3NBcHBzeW5jQXV0aG9yaXphdGlvblR5cGVbXSxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9kZWxJbnRyb3NwZWN0aW9uID1cbiAgICAgIGF3YWl0IHRoaXMubW9kZWxJbnRyb3NwZWN0aW9uU2NoZW1hQWRhcHRlci5nZXRNb2RlbEludHJvc3BlY3Rpb25TY2hlbWFGcm9tUzNVcmkoXG4gICAgICAgIGdyYXBocWxPdXRwdXQucGF5bG9hZC5hbXBsaWZ5QXBpTW9kZWxTY2hlbWFTM1VyaSxcbiAgICAgICk7XG5cbiAgICBpZiAobW9kZWxJbnRyb3NwZWN0aW9uKSB7XG4gICAgICBjb25maWcuZGF0YS5tb2RlbF9pbnRyb3NwZWN0aW9uID0gbW9kZWxJbnRyb3NwZWN0aW9uIGFzIHtcbiAgICAgICAgW2s6IHN0cmluZ106IHVua25vd247XG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBjb25maWc7XG4gIH07XG59XG5cbi8qKlxuICogVHJhbnNsYXRvciBmb3IgdGhlIFN0b3JhZ2UgcG9ydGlvbiBvZiBDbGllbnRDb25maWcgaW4gVjEuMlxuICovXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25hbWluZy1jb252ZW50aW9uXG5leHBvcnQgY2xhc3MgU3RvcmFnZUNsaWVudENvbmZpZ0NvbnRyaWJ1dG9yIGltcGxlbWVudHMgQ2xpZW50Q29uZmlnQ29udHJpYnV0b3Ige1xuICAvKipcbiAgICogR2l2ZW4gc29tZSBCYWNrZW5kT3V0cHV0LCBjb250cmlidXRlIHRoZSBTdG9yYWdlIHBvcnRpb24gb2YgdGhlIGNsaWVudCBjb25maWdcbiAgICovXG4gIGNvbnRyaWJ1dGUgPSAoe1xuICAgIFtzdG9yYWdlT3V0cHV0S2V5XTogc3RvcmFnZU91dHB1dCxcbiAgfTogVW5pZmllZEJhY2tlbmRPdXRwdXQpOiBQYXJ0aWFsPENsaWVudENvbmZpZz4gfCBSZWNvcmQ8c3RyaW5nLCBuZXZlcj4gPT4ge1xuICAgIGlmIChzdG9yYWdlT3V0cHV0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gICAgY29uc3QgY29uZmlnOiBQYXJ0aWFsPGNsaWVudENvbmZpZ1R5cGVzVjFfMi5BV1NBbXBsaWZ5QmFja2VuZE91dHB1dHM+ID0ge307XG4gICAgY29uc3QgYnVja2V0c1N0cmluZ0FycmF5ID0gSlNPTi5wYXJzZShcbiAgICAgIHN0b3JhZ2VPdXRwdXQucGF5bG9hZC5idWNrZXRzID8/ICdbXScsXG4gICAgKTtcbiAgICBjb25maWcuc3RvcmFnZSA9IHtcbiAgICAgIGF3c19yZWdpb246IHN0b3JhZ2VPdXRwdXQucGF5bG9hZC5zdG9yYWdlUmVnaW9uLFxuICAgICAgYnVja2V0X25hbWU6IHN0b3JhZ2VPdXRwdXQucGF5bG9hZC5idWNrZXROYW1lLFxuICAgICAgYnVja2V0czogYnVja2V0c1N0cmluZ0FycmF5XG4gICAgICAgIC5tYXAoKGI6IHN0cmluZykgPT4gSlNPTi5wYXJzZShiKSlcbiAgICAgICAgLm1hcChcbiAgICAgICAgICAoe1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGJ1Y2tldE5hbWUsXG4gICAgICAgICAgICBzdG9yYWdlUmVnaW9uLFxuICAgICAgICAgICAgcGF0aHMsXG4gICAgICAgICAgfToge1xuICAgICAgICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgICAgICAgYnVja2V0TmFtZTogc3RyaW5nO1xuICAgICAgICAgICAgc3RvcmFnZVJlZ2lvbjogc3RyaW5nO1xuICAgICAgICAgICAgcGF0aHM6IFJlY29yZDxzdHJpbmcsIEFtcGxpZnlTdG9yYWdlQWNjZXNzUnVsZT47XG4gICAgICAgICAgfSkgPT4gKHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBidWNrZXRfbmFtZTogYnVja2V0TmFtZSxcbiAgICAgICAgICAgIGF3c19yZWdpb246IHN0b3JhZ2VSZWdpb24sXG4gICAgICAgICAgICBwYXRocyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgKSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIGNvbmZpZztcbiAgfTtcbn1cblxuLyoqXG4gKiBUcmFuc2xhdG9yIGZvciB0aGUgU3RvcmFnZSBwb3J0aW9uIG9mIENsaWVudENvbmZpZyBpbiBWMS4xXG4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbmFtaW5nLWNvbnZlbnRpb25cbmV4cG9ydCBjbGFzcyBTdG9yYWdlQ2xpZW50Q29uZmlnQ29udHJpYnV0b3JWMV8xXG4gIGltcGxlbWVudHMgQ2xpZW50Q29uZmlnQ29udHJpYnV0b3JcbntcbiAgLyoqXG4gICAqIEdpdmVuIHNvbWUgQmFja2VuZE91dHB1dCwgY29udHJpYnV0ZSB0aGUgU3RvcmFnZSBwb3J0aW9uIG9mIHRoZSBjbGllbnQgY29uZmlnXG4gICAqL1xuICBjb250cmlidXRlID0gKHtcbiAgICBbc3RvcmFnZU91dHB1dEtleV06IHN0b3JhZ2VPdXRwdXQsXG4gIH06IFVuaWZpZWRCYWNrZW5kT3V0cHV0KTogUGFydGlhbDxDbGllbnRDb25maWc+IHwgUmVjb3JkPHN0cmluZywgbmV2ZXI+ID0+IHtcbiAgICBpZiAoc3RvcmFnZU91dHB1dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIGNvbnN0IGNvbmZpZzogUGFydGlhbDxjbGllbnRDb25maWdUeXBlc1YxXzEuQVdTQW1wbGlmeUJhY2tlbmRPdXRwdXRzPiA9IHt9O1xuICAgIGNvbnN0IGJ1Y2tldHNTdHJpbmdBcnJheSA9IEpTT04ucGFyc2UoXG4gICAgICBzdG9yYWdlT3V0cHV0LnBheWxvYWQuYnVja2V0cyA/PyAnW10nLFxuICAgICk7XG4gICAgY29uZmlnLnN0b3JhZ2UgPSB7XG4gICAgICBhd3NfcmVnaW9uOiBzdG9yYWdlT3V0cHV0LnBheWxvYWQuc3RvcmFnZVJlZ2lvbixcbiAgICAgIGJ1Y2tldF9uYW1lOiBzdG9yYWdlT3V0cHV0LnBheWxvYWQuYnVja2V0TmFtZSxcbiAgICAgIGJ1Y2tldHM6IGJ1Y2tldHNTdHJpbmdBcnJheVxuICAgICAgICAubWFwKChiOiBzdHJpbmcpID0+IEpTT04ucGFyc2UoYikpXG4gICAgICAgIC5tYXAoXG4gICAgICAgICAgKHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBidWNrZXROYW1lLFxuICAgICAgICAgICAgc3RvcmFnZVJlZ2lvbixcbiAgICAgICAgICB9OiB7XG4gICAgICAgICAgICBuYW1lOiBzdHJpbmc7XG4gICAgICAgICAgICBidWNrZXROYW1lOiBzdHJpbmc7XG4gICAgICAgICAgICBzdG9yYWdlUmVnaW9uOiBzdHJpbmc7XG4gICAgICAgICAgfSkgPT4gKHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBidWNrZXRfbmFtZTogYnVja2V0TmFtZSxcbiAgICAgICAgICAgIGF3c19yZWdpb246IHN0b3JhZ2VSZWdpb24sXG4gICAgICAgICAgfSksXG4gICAgICAgICksXG4gICAgfTtcblxuICAgIHJldHVybiBjb25maWc7XG4gIH07XG59XG5cbi8qKlxuICogVHJhbnNsYXRvciBmb3IgdGhlIFN0b3JhZ2UgcG9ydGlvbiBvZiBDbGllbnRDb25maWcgaW4gVjFcbiAqL1xuZXhwb3J0IGNsYXNzIFN0b3JhZ2VDbGllbnRDb25maWdDb250cmlidXRvclYxXG4gIGltcGxlbWVudHMgQ2xpZW50Q29uZmlnQ29udHJpYnV0b3JcbntcbiAgLyoqXG4gICAqIEdpdmVuIHNvbWUgQmFja2VuZE91dHB1dCwgY29udHJpYnV0ZSB0aGUgU3RvcmFnZSBwb3J0aW9uIG9mIHRoZSBjbGllbnQgY29uZmlnXG4gICAqL1xuICBjb250cmlidXRlID0gKHtcbiAgICBbc3RvcmFnZU91dHB1dEtleV06IHN0b3JhZ2VPdXRwdXQsXG4gIH06IFVuaWZpZWRCYWNrZW5kT3V0cHV0KTogUGFydGlhbDxDbGllbnRDb25maWc+IHwgUmVjb3JkPHN0cmluZywgbmV2ZXI+ID0+IHtcbiAgICBpZiAoc3RvcmFnZU91dHB1dCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIGNvbnN0IGNvbmZpZzogUGFydGlhbDxjbGllbnRDb25maWdUeXBlc1YxLkFXU0FtcGxpZnlCYWNrZW5kT3V0cHV0cz4gPSB7fTtcblxuICAgIGNvbmZpZy5zdG9yYWdlID0ge1xuICAgICAgYXdzX3JlZ2lvbjogc3RvcmFnZU91dHB1dC5wYXlsb2FkLnN0b3JhZ2VSZWdpb24sXG4gICAgICBidWNrZXRfbmFtZTogc3RvcmFnZU91dHB1dC5wYXlsb2FkLmJ1Y2tldE5hbWUsXG4gICAgfTtcblxuICAgIHJldHVybiBjb25maWc7XG4gIH07XG59XG5cbi8qKlxuICogVHJhbnNsYXRvciBmb3IgdGhlIEN1c3RvbSBwb3J0aW9uIG9mIENsaWVudENvbmZpZ1xuICovXG5leHBvcnQgY2xhc3MgQ3VzdG9tQ2xpZW50Q29uZmlnQ29udHJpYnV0b3IgaW1wbGVtZW50cyBDbGllbnRDb25maWdDb250cmlidXRvciB7XG4gIC8qKlxuICAgKiBHaXZlbiBzb21lIEJhY2tlbmRPdXRwdXQsIGNvbnRyaWJ1dGUgdGhlIEN1c3RvbSBwb3J0aW9uIG9mIHRoZSBDbGllbnRDb25maWdcbiAgICovXG4gIGNvbnRyaWJ1dGUgPSAoe1xuICAgIFtjdXN0b21PdXRwdXRLZXldOiBjdXN0b21PdXRwdXQsXG4gIH06IFVuaWZpZWRCYWNrZW5kT3V0cHV0KTogUGFydGlhbDxDbGllbnRDb25maWc+ID0+IHtcbiAgICBpZiAoY3VzdG9tT3V0cHV0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG5cbiAgICByZXR1cm4gSlNPTi5wYXJzZShjdXN0b21PdXRwdXQucGF5bG9hZC5jdXN0b21PdXRwdXRzKTtcbiAgfTtcbn1cbiJdfQ==