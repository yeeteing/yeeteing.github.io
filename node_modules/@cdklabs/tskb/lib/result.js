"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.liftUndefined = exports.liftResult = exports.locateFailure = exports.chain = exports.using = exports.tryCatch = exports.assertSuccess = exports.errorFrom = exports.errorMessage = exports.unpackOr = exports.unpack = exports.isSuccess = exports.isFailure = exports.failure = void 0;
// Ensures you must use `fail()` to construct an instance of type Failure
const errorSym = Symbol('error');
function mkLocate(prefix) {
    const ret = (error) => failure(`${prefix}: ${error}`);
    ret.in = (prefix2) => mkLocate(`${prefix}: ${prefix2}`);
    ret.locate = locateFailure(prefix);
    return ret;
}
function failure(error) {
    return { [errorSym]: error };
}
exports.failure = failure;
failure.in = (prefix) => mkLocate(prefix);
failure.locate = (x) => x;
function isFailure(x) {
    return !!x && typeof x === 'object' && x[errorSym];
}
exports.isFailure = isFailure;
function isSuccess(x) {
    return !isFailure(x);
}
exports.isSuccess = isSuccess;
function unpack(x) {
    if (isFailure(x)) {
        throw new Error(`unpack: ${x[errorSym]}`);
    }
    return x;
}
exports.unpack = unpack;
function unpackOr(x, def) {
    return (isFailure(x) ? def : x);
}
exports.unpackOr = unpackOr;
function errorMessage(x) {
    return x[errorSym];
}
exports.errorMessage = errorMessage;
function errorFrom(x) {
    return new Error(errorMessage(x));
}
exports.errorFrom = errorFrom;
function assertSuccess(x) {
    if (isFailure(x)) {
        throw errorFrom(x);
    }
}
exports.assertSuccess = assertSuccess;
function tryCatch(failOrBlock, maybeBlock) {
    const block = (maybeBlock !== null && maybeBlock !== void 0 ? maybeBlock : failOrBlock);
    const f = (maybeBlock ? failOrBlock : failure);
    try {
        return block();
    }
    catch (e) {
        return f(`Error: ${e.message}\n${e.stack}`);
    }
}
exports.tryCatch = tryCatch;
function using(value, block) {
    if (isFailure(value)) {
        return value;
    }
    return block(value);
}
exports.using = using;
function chain(value, ...fns) {
    for (const fn of fns) {
        if (isFailure(value)) {
            return value;
        }
        value = fn(value);
    }
    return value;
}
exports.chain = chain;
/* eslint-enable prettier/prettier */
/**
 * Make a function that will prepend a prefix to error messages
 *
 * This is one way to be specific about the location where errors originate, by prefixing
 * errors as the call stack unwinds.
 *
 * A different method is to pass in a modified failure function using `failure.in(...)`,
 * to build the error message as the call stack deepens.
 */
function locateFailure(prefix) {
    return (x) => (isFailure(x) ? failure(`${prefix}: ${x[errorSym]}`) : x);
}
exports.locateFailure = locateFailure;
function liftResult(xs) {
    const failures = Array.isArray(xs) ? xs.filter(isFailure) : Object.values(xs).filter(isFailure);
    if (failures.length > 0) {
        return failure(failures.map(errorMessage).join(', '));
    }
    return xs;
}
exports.liftResult = liftResult;
function liftUndefined(valueOrFunction) {
    if (typeof valueOrFunction === 'function') {
        return (...args) => {
            const value = valueOrFunction(...args);
            return value !== undefined ? value : failure('value is undefined');
        };
    }
    return valueOrFunction !== undefined ? valueOrFunction : failure('value is undefined');
}
exports.liftUndefined = liftUndefined;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdWx0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3Jlc3VsdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx5RUFBeUU7QUFDekUsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBYWpDLFNBQVMsUUFBUSxDQUFDLE1BQWM7SUFDOUIsTUFBTSxHQUFHLEdBQVMsQ0FBQyxLQUFhLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLE1BQU0sS0FBSyxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ3BFLEdBQUcsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxPQUFlLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxHQUFHLE1BQU0sS0FBSyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBQ2hFLEdBQUcsQ0FBQyxNQUFNLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ25DLE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQztBQUlELFNBQWdCLE9BQU8sQ0FBQyxLQUFhO0lBQ25DLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDO0FBQy9CLENBQUM7QUFGRCwwQkFFQztBQUNELE9BQU8sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxNQUFjLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNsRCxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUksQ0FBWSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFFeEMsU0FBZ0IsU0FBUyxDQUFJLENBQVk7SUFDdkMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLFFBQVEsSUFBSyxDQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDOUQsQ0FBQztBQUZELDhCQUVDO0FBRUQsU0FBZ0IsU0FBUyxDQUFJLENBQVk7SUFDdkMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN2QixDQUFD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LENBQUMsU0FBUyxDQUFDLENBQUM7SUFDaEcsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtRQUN2QixPQUFPLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0tBQ3ZEO0lBQ0QsT0FBTyxFQUFTLENBQUM7QUFDbkIsQ0FBQztBQVJELGdDQVFDO0FBT0QsU0FBZ0IsYUFBYSxDQUFDLGVBQW9CO0lBQ2hELElBQUksT0FBTyxlQUFlLEtBQUssVUFBVSxFQUFFO1FBQ3pDLE9BQU8sQ0FBQyxHQUFHLElBQVcsRUFBRSxFQUFFO1lBQ3hCLE1BQU0sS0FBSyxHQUFHLGVBQWUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1lBQ3ZDLE9BQU8sS0FBSyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUNyRSxDQUFDLENBQUM7S0FDSDtJQUNELE9BQU8sZUFBZSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUN6RixDQUFDO0FBUkQsc0NBUUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFbnN1cmVzIHlvdSBtdXN0IHVzZSBgZmFpbCgpYCB0byBjb25zdHJ1Y3QgYW4gaW5zdGFuY2Ugb2YgdHlwZSBGYWlsdXJlXG5jb25zdCBlcnJvclN5bSA9IFN5bWJvbCgnZXJyb3InKTtcblxuZXhwb3J0IHR5cGUgUmVzdWx0PEE+ID0gQSB8IEZhaWx1cmU7XG5leHBvcnQgaW50ZXJmYWNlIEZhaWx1cmUge1xuICByZWFkb25seSBbZXJyb3JTeW1dOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmFpbCB7XG4gIChlcnJvcjogc3RyaW5nKTogRmFpbHVyZTtcbiAgaW4ocHJlZml4OiBzdHJpbmcpOiBGYWlsO1xuICBsb2NhdGU8QT4oeDogUmVzdWx0PEE+KTogUmVzdWx0PEE+O1xufVxuXG5mdW5jdGlvbiBta0xvY2F0ZShwcmVmaXg6IHN0cmluZyk6IEZhaWwge1xuICBjb25zdCByZXQ6IEZhaWwgPSAoZXJyb3I6IHN0cmluZykgPT4gZmFpbHVyZShgJHtwcmVmaXh9OiAke2Vycm9yfWApO1xuICByZXQuaW4gPSAocHJlZml4Mjogc3RyaW5nKSA9PiBta0xvY2F0ZShgJHtwcmVmaXh9OiAke3ByZWZpeDJ9YCk7XG4gIHJldC5sb2NhdGUgPSBsb2NhdGVGYWlsdXJlKHByZWZpeCk7XG4gIHJldHVybiByZXQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgZmFpbHVyZSBleHRlbmRzIEZhaWwge31cblxuZXhwb3J0IGZ1bmN0aW9uIGZhaWx1cmUoZXJyb3I6IHN0cmluZyk6IEZhaWx1cmUge1xuICByZXR1cm4geyBbZXJyb3JTeW1dOiBlcnJvciB9O1xufVxuZmFpbHVyZS5pbiA9IChwcmVmaXg6IHN0cmluZykgPT4gbWtMb2NhdGUocHJlZml4KTtcbmZhaWx1cmUubG9jYXRlID0gPEE+KHg6IFJlc3VsdDxBPikgPT4geDtcblxuZXhwb3J0IGZ1bmN0aW9uIGlzRmFpbHVyZTxBPih4OiBSZXN1bHQ8QT4pOiB4IGlzIEZhaWx1cmUge1xuICByZXR1cm4gISF4ICYmIHR5cGVvZiB4ID09PSAnb2JqZWN0JyAmJiAoeCBhcyBhbnkpW2Vycm9yU3ltXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzU3VjY2VzczxBPih4OiBSZXN1bHQ8QT4pOiB4IGlzIEEge1xuICByZXR1cm4gIWlzRmFpbHVyZSh4KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVucGFjazxBPih4OiBSZXN1bHQ8QT4pOiBBIHtcbiAgaWYgKGlzRmFpbHVyZSh4KSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgdW5wYWNrOiAke3hbZXJyb3JTeW1dfWApO1xuICB9XG4gIHJldHVybiB4O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5wYWNrT3I8QSwgQj4oeDogUmVzdWx0PEE+LCBkZWY6IEIpOiBCIGV4dGVuZHMgQSA/IEEgOiBBIHwgQiB7XG4gIHJldHVybiAoaXNGYWlsdXJlKHgpID8gZGVmIDogeCkgYXMgYW55O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXJyb3JNZXNzYWdlKHg6IEZhaWx1cmUpOiBzdHJpbmcge1xuICByZXR1cm4geFtlcnJvclN5bV07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlcnJvckZyb20oeDogRmFpbHVyZSk6IEVycm9yIHtcbiAgcmV0dXJuIG5ldyBFcnJvcihlcnJvck1lc3NhZ2UoeCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXNzZXJ0U3VjY2VzczxBPih4OiBSZXN1bHQ8QT4pOiBhc3NlcnRzIHggaXMgQTtcbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnRTdWNjZXNzKHg6IEZhaWx1cmUpOiBuZXZlcjtcbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnRTdWNjZXNzKHg6IEZhaWx1cmUpOiB2b2lkIHtcbiAgaWYgKGlzRmFpbHVyZSh4KSkge1xuICAgIHRocm93IGVycm9yRnJvbSh4KTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdHJ5Q2F0Y2g8QT4oYmxvY2s6ICgpID0+IEEpOiBSZXN1bHQ8QT47XG5leHBvcnQgZnVuY3Rpb24gdHJ5Q2F0Y2g8QT4oZmFpbEZuOiBGYWlsLCBibG9jazogKCkgPT4gQSk6IFJlc3VsdDxBPjtcbmV4cG9ydCBmdW5jdGlvbiB0cnlDYXRjaDxBPihmYWlsT3JCbG9jazogRmFpbCB8ICgoKSA9PiBBKSwgbWF5YmVCbG9jaz86ICgpID0+IEEpOiBSZXN1bHQ8QT4ge1xuICBjb25zdCBibG9jazogKCkgPT4gQSA9IChtYXliZUJsb2NrID8/IGZhaWxPckJsb2NrKSBhcyBhbnk7XG4gIGNvbnN0IGY6IEZhaWwgPSAobWF5YmVCbG9jayA/IGZhaWxPckJsb2NrIDogZmFpbHVyZSkgYXMgYW55O1xuXG4gIHRyeSB7XG4gICAgcmV0dXJuIGJsb2NrKCk7XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIHJldHVybiBmKGBFcnJvcjogJHtlLm1lc3NhZ2V9XFxuJHtlLnN0YWNrfWApO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2luZzxBLCBCPih2YWx1ZTogUmVzdWx0PEE+LCBibG9jazogKHg6IEEpID0+IFJlc3VsdDxCPik6IFJlc3VsdDxCPiB7XG4gIGlmIChpc0ZhaWx1cmUodmFsdWUpKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIHJldHVybiBibG9jayh2YWx1ZSk7XG59XG5cbi8qKlxuICogTGlrZSAndXNpbmcnLCBidXQgY2FuIHRha2UgYW55IG51bWJlciBvZiBmdW5jdGlvbnNcbiAqL1xuLyogZXNsaW50LWRpc2FibGUgcHJldHRpZXIvcHJldHRpZXIgKi9cbmV4cG9ydCBmdW5jdGlvbiBjaGFpbjxBLCBCPih2YWx1ZTogUmVzdWx0PEE+LCBiMDogKHg6IEEpID0+IFJlc3VsdDxCPik6IFJlc3VsdDxCPjtcbmV4cG9ydCBmdW5jdGlvbiBjaGFpbjxBLCBCLCBDPih2YWx1ZTogUmVzdWx0PEE+LCBiMDogKHg6IEEpID0+IFJlc3VsdDxCPiwgYjE6ICh4OiBCKSA9PiBSZXN1bHQ8Qz4pOiBSZXN1bHQ8Qz47XG5leHBvcnQgZnVuY3Rpb24gY2hhaW48QSwgQiwgQywgRD4odmFsdWU6IFJlc3VsdDxBPiwgYjA6ICh4OiBBKSA9PiBSZXN1bHQ8Qj4sIGIxOiAoeDogQikgPT4gUmVzdWx0PEM+LCBiMjogKHg6IEMpID0+IFJlc3VsdDxEPik6IFJlc3VsdDxEPjtcbmV4cG9ydCBmdW5jdGlvbiBjaGFpbjxBLCBCLCBDLCBELCBFPih2YWx1ZTogUmVzdWx0PEE+LCBiMDogKHg6IEEpID0+IFJlc3VsdDxCPiwgYjE6ICh4OiBCKSA9PiBSZXN1bHQ8Qz4sIGIyOiAoeDogQykgPT4gUmVzdWx0PEQ+LCBiMzogKHg6IEQpID0+IFJlc3VsdDxFPik6IFJlc3VsdDxFPjtcbmV4cG9ydCBmdW5jdGlvbiBjaGFpbjxBLCBCLCBDLCBELCBFLCBGPih2YWx1ZTogUmVzdWx0PEE+LCBiMDogKHg6IEEpID0+IFJlc3VsdDxCPiwgYjE6ICh4OiBCKSA9PiBSZXN1bHQ8Qz4sIGIyOiAoeDogQykgPT4gUmVzdWx0PEQ+LCBiMzogKHg6IEQpID0+IFJlc3VsdDxFPiwgYjQ6ICh4OiBFKSA9PiBSZXN1bHQ8Rj4pOiBSZXN1bHQ8Rj47XG5leHBvcnQgZnVuY3Rpb24gY2hhaW48QSwgQiwgQywgRCwgRSwgRiwgRz4odmFsdWU6IFJlc3VsdDxBPiwgYjA6ICh4OiBBKSA9PiBSZXN1bHQ8Qj4sIGIxOiAoeDogQikgPT4gUmVzdWx0PEM+LCBiMjogKHg6IEMpID0+IFJlc3VsdDxEPiwgYjM6ICh4OiBEKSA9PiBSZXN1bHQ8RT4sIGI0OiAoeDogRSkgPT4gUmVzdWx0PEY+LCBiNTogKHg6IEYpID0+IFJlc3VsdDxHPik6IFJlc3VsdDxHPjtcbmV4cG9ydCBmdW5jdGlvbiBjaGFpbih2YWx1ZTogUmVzdWx0PGFueT4sIC4uLmZuczogQXJyYXk8KHg6IGFueSkgPT4gUmVzdWx0PGFueT4+KTogUmVzdWx0PGFueT4ge1xuICBmb3IgKGNvbnN0IGZuIG9mIGZucykge1xuICAgIGlmIChpc0ZhaWx1cmUodmFsdWUpKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIHZhbHVlID0gZm4odmFsdWUpO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn1cbi8qIGVzbGludC1lbmFibGUgcHJldHRpZXIvcHJldHRpZXIgKi9cblxuLyoqXG4gKiBNYWtlIGEgZnVuY3Rpb24gdGhhdCB3aWxsIHByZXBlbmQgYSBwcmVmaXggdG8gZXJyb3IgbWVzc2FnZXNcbiAqXG4gKiBUaGlzIGlzIG9uZSB3YXkgdG8gYmUgc3BlY2lmaWMgYWJvdXQgdGhlIGxvY2F0aW9uIHdoZXJlIGVycm9ycyBvcmlnaW5hdGUsIGJ5IHByZWZpeGluZ1xuICogZXJyb3JzIGFzIHRoZSBjYWxsIHN0YWNrIHVud2luZHMuXG4gKlxuICogQSBkaWZmZXJlbnQgbWV0aG9kIGlzIHRvIHBhc3MgaW4gYSBtb2RpZmllZCBmYWlsdXJlIGZ1bmN0aW9uIHVzaW5nIGBmYWlsdXJlLmluKC4uLilgLFxuICogdG8gYnVpbGQgdGhlIGVycm9yIG1lc3NhZ2UgYXMgdGhlIGNhbGwgc3RhY2sgZGVlcGVucy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvY2F0ZUZhaWx1cmUocHJlZml4OiBzdHJpbmcpIHtcbiAgcmV0dXJuIDxBPih4OiBSZXN1bHQ8QT4pOiBSZXN1bHQ8QT4gPT4gKGlzRmFpbHVyZSh4KSA/IGZhaWx1cmUoYCR7cHJlZml4fTogJHt4W2Vycm9yU3ltXX1gKSA6IHgpO1xufVxuXG5leHBvcnQgdHlwZSBGYWlsdXJlcyA9IEFycmF5PEZhaWx1cmU+O1xuXG5leHBvcnQgZnVuY3Rpb24gbGlmdFJlc3VsdDxBPih4czogUmVjb3JkPHN0cmluZywgUmVzdWx0PEE+Pik6IFJlc3VsdDxSZWNvcmQ8c3RyaW5nLCBBPj47XG5leHBvcnQgZnVuY3Rpb24gbGlmdFJlc3VsdDxBPih4czogQXJyYXk8UmVzdWx0PEE+Pik6IFJlc3VsdDxBcnJheTxBPj47XG5leHBvcnQgZnVuY3Rpb24gbGlmdFJlc3VsdDxBPihcbiAgeHM6IFJlY29yZDxzdHJpbmcsIFJlc3VsdDxBPj4gfCBBcnJheTxSZXN1bHQ8QT4+LFxuKTogUmVzdWx0PFJlY29yZDxzdHJpbmcsIEE+PiB8IFJlc3VsdDxBcnJheTxBPj4ge1xuICBjb25zdCBmYWlsdXJlcyA9IEFycmF5LmlzQXJyYXkoeHMpID8geHMuZmlsdGVyKGlzRmFpbHVyZSkgOiBPYmplY3QudmFsdWVzKHhzKS5maWx0ZXIoaXNGYWlsdXJlKTtcbiAgaWYgKGZhaWx1cmVzLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4gZmFpbHVyZShmYWlsdXJlcy5tYXAoZXJyb3JNZXNzYWdlKS5qb2luKCcsICcpKTtcbiAgfVxuICByZXR1cm4geHMgYXMgYW55O1xufVxuXG4vKipcbiAqIExpZnQgYSB2YWx1ZSB0aGF0IGNhbiBiZSAndW5kZWZpbmVkJyB0byBhIHJlc3VsdCwgb3IgYSBmdW5jdGlvbiB0aGF0IGNhbiByZXR1cm4gdW5kZWZpbmVkLlxuICovXG5leHBvcnQgZnVuY3Rpb24gbGlmdFVuZGVmaW5lZDxBPih2OiBBIHwgdW5kZWZpbmVkKTogUmVzdWx0PE5vbk51bGxhYmxlPEE+PjtcbmV4cG9ydCBmdW5jdGlvbiBsaWZ0VW5kZWZpbmVkPEEsIEYgZXh0ZW5kcyAoLi4uYXJnczogYW55W10pID0+IEE+KHY6IEYpOiAoeDogUGFyYW1ldGVyczxGPikgPT4gUmVzdWx0PE5vbk51bGxhYmxlPEE+PjtcbmV4cG9ydCBmdW5jdGlvbiBsaWZ0VW5kZWZpbmVkKHZhbHVlT3JGdW5jdGlvbjogYW55KTogYW55IHtcbiAgaWYgKHR5cGVvZiB2YWx1ZU9yRnVuY3Rpb24gPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gKC4uLmFyZ3M6IGFueVtdKSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHZhbHVlT3JGdW5jdGlvbiguLi5hcmdzKTtcbiAgICAgIHJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiBmYWlsdXJlKCd2YWx1ZSBpcyB1bmRlZmluZWQnKTtcbiAgICB9O1xuICB9XG4gIHJldHVybiB2YWx1ZU9yRnVuY3Rpb24gIT09IHVuZGVmaW5lZCA/IHZhbHVlT3JGdW5jdGlvbiA6IGZhaWx1cmUoJ3ZhbHVlIGlzIHVuZGVmaW5lZCcpO1xufVxuIl19