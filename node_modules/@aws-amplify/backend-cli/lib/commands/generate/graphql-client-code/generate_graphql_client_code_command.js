import { isAbsolute, resolve } from 'path';
import { GenerateApiCodeFormat, GenerateApiCodeModelTarget, GenerateApiCodeStatementTarget, GenerateApiCodeTypeTarget, } from '@aws-amplify/model-generator';
const DEFAULT_TYPE_TARGET_FOR_STATEMENT_TARGET = {
    [GenerateApiCodeStatementTarget.JAVASCRIPT]: undefined,
    [GenerateApiCodeStatementTarget.TYPESCRIPT]: GenerateApiCodeTypeTarget.TYPESCRIPT,
    [GenerateApiCodeStatementTarget.GRAPHQL]: undefined,
    [GenerateApiCodeStatementTarget.FLOW]: GenerateApiCodeTypeTarget.FLOW,
    [GenerateApiCodeStatementTarget.ANGULAR]: GenerateApiCodeTypeTarget.ANGULAR,
};
/**
 * Command that generates graphql client code.
 */
export class GenerateGraphqlClientCodeCommand {
    generateApiCodeAdapter;
    backendIdentifierResolver;
    /**
     * @inheritDoc
     */
    command;
    /**
     * @inheritDoc
     */
    describe;
    /**
     * Creates graphql client code generation command.
     */
    constructor(generateApiCodeAdapter, backendIdentifierResolver) {
        this.generateApiCodeAdapter = generateApiCodeAdapter;
        this.backendIdentifierResolver = backendIdentifierResolver;
        this.command = 'graphql-client-code';
        this.describe = 'Generates graphql API code';
    }
    /**
     * @inheritDoc
     */
    handler = async (args) => {
        const backendIdentifier = await this.backendIdentifierResolver.resolveDeployedBackendIdentifier(args);
        const out = this.getOutDir(args);
        const format = args.format ?? GenerateApiCodeFormat.GRAPHQL_CODEGEN;
        const formatParams = this.formatParamBuilders[format](args);
        const result = await this.generateApiCodeAdapter.invokeGenerateApiCode({
            ...backendIdentifier,
            ...formatParams,
        });
        await result.writeToDirectory(out);
    };
    /**
     * @inheritDoc
     */
    builder = (yargs) => {
        return yargs
            .option('stack', {
            conflicts: ['app-id', 'branch'],
            describe: 'A stack name that contains an Amplify backend',
            type: 'string',
            array: false,
            group: 'Stack identifier',
        })
            .option('app-id', {
            conflicts: ['stack'],
            describe: 'The Amplify App ID of the project',
            type: 'string',
            array: false,
            implies: 'branch',
            group: 'Project identifier',
        })
            .option('branch', {
            conflicts: ['stack'],
            describe: 'A git branch of the Amplify project',
            type: 'string',
            array: false,
            implies: 'app-id',
            group: 'Project identifier',
        })
            .option('out', {
            describe: 'A path to directory where config is written. If not provided defaults to current process working directory.',
            type: 'string',
            array: false,
        })
            .option('format', {
            describe: 'The format that the GraphQL client code should be generated in.',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeFormat),
        })
            .option('model-target', {
            describe: 'The modelgen export target. Only applies when the `--format` parameter is set to `modelgen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeModelTarget),
        })
            .option('statement-target', {
            describe: 'The graphql-codegen statement export target. Only applies when the `--format` parameter is set to `graphql-codegen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeStatementTarget),
        })
            .option('type-target', {
            describe: 'The optional graphql-codegen type export target. Only applies when the `--format` parameter is set to `graphql-codegen`',
            type: 'string',
            array: false,
            choices: Object.values(GenerateApiCodeTypeTarget),
        })
            .option('model-generate-index-rules', {
            description: 'Adds key/index details to iOS models',
            type: 'boolean',
            array: false,
        })
            .option('model-emit-auth-provider', {
            description: 'Adds auth provider details to iOS models',
            type: 'boolean',
            array: false,
        })
            .option('model-respect-primary-key-attributes-on-connection-field', {
            description: 'If enabled, Datastore queries will respect the primary + sort key fields, rather than a default id field',
            type: 'boolean',
            array: false,
        })
            .option('model-generate-models-for-lazy-load-and-custom-selection-set', {
            description: 'Generates lazy model type definitions, required or amplify-js v5+',
            type: 'boolean',
            array: false,
        })
            .option('model-add-timestamp-fields', {
            description: 'Add read-only timestamp fields in modelgen.',
            type: 'boolean',
            array: false,
        })
            .option('model-handle-list-nullability-transparently', {
            description: 'Configure the nullability of the List and List components in Datastore Models generation',
            type: 'boolean',
            array: false,
        })
            .option('statement-max-depth', {
            description: 'Determines how deeply nested to generate graphql statements.',
            type: 'number',
            array: false,
        })
            .option('statement-typename-introspection', {
            description: 'Determines whether to include default __typename for all generated statements',
            type: 'boolean',
            array: false,
        })
            .option('type-multiple-swift-files', {
            description: 'Determines whether or not to generate a single API.swift, or multiple per-model swift files.',
            type: 'boolean',
            array: false,
        });
    };
    /**
     * Produce the required input for graphql-codegen calls from the CLI input, applying sane defaults where applicable.
     * @param args CLI args provided by the customer
     * @returns the codegen options config
     */
    getGraphqlCodegenFormatParams = (args) => {
        const statementTarget = args['statement-target'] ?? GenerateApiCodeStatementTarget.TYPESCRIPT;
        const typeTarget = args['type-target'] ??
            DEFAULT_TYPE_TARGET_FOR_STATEMENT_TARGET[statementTarget];
        const maxDepth = args['statement-max-depth'];
        const typeNameIntrospection = args['statement-typename-introspection'];
        const multipleSwiftFiles = args['type-multiple-swift-files'];
        return {
            format: GenerateApiCodeFormat.GRAPHQL_CODEGEN,
            statementTarget,
            ...(typeTarget !== undefined ? { typeTarget } : {}),
            ...(maxDepth !== undefined ? { maxDepth } : {}),
            ...(typeNameIntrospection !== undefined ? { typeNameIntrospection } : {}),
            ...(multipleSwiftFiles !== undefined ? { multipleSwiftFiles } : {}),
        };
    };
    /**
     * Produce the required input for modelgen calls from the CLI input, applying sane defaults where applicable.
     * @param args CLI args provided by the customer
     * @returns the modelgen options config
     */
    getModelgenFormatParams = (args) => {
        const modelTarget = args['model-target'] ?? GenerateApiCodeModelTarget.TYPESCRIPT;
        const generateIndexRules = args['model-generate-index-rules'];
        const emitAuthProvider = args['model-emit-auth-provider'];
        const respectPrimaryKeyAttributesOnConnectionField = args['model-respect-primary-key-attributes-on-connection-field'];
        const generateModelsForLazyLoadAndCustomSelectionSet = args['model-generate-models-for-lazy-load-and-custom-selection-set'];
        const addTimestampFields = args['model-add-timestamp-fields'];
        const handleListNullabilityTransparently = args['model-handle-list-nullability-transparently'];
        return {
            format: GenerateApiCodeFormat.MODELGEN,
            modelTarget,
            ...(generateIndexRules !== undefined ? { generateIndexRules } : {}),
            ...(emitAuthProvider !== undefined ? { emitAuthProvider } : {}),
            ...(respectPrimaryKeyAttributesOnConnectionField !== undefined
                ? { respectPrimaryKeyAttributesOnConnectionField }
                : {}),
            ...(generateModelsForLazyLoadAndCustomSelectionSet !== undefined
                ? { generateModelsForLazyLoadAndCustomSelectionSet }
                : {}),
            ...(addTimestampFields !== undefined ? { addTimestampFields } : {}),
            ...(handleListNullabilityTransparently !== undefined
                ? { handleListNullabilityTransparently }
                : {}),
        };
    };
    /**
     * Produce the introspection schema config shape.
     * @returns the introspection options config
     */
    getIntrospectionFormatParams = () => ({
        format: GenerateApiCodeFormat.INTROSPECTION,
    });
    getOutDir = (args) => {
        const cwd = process.cwd();
        if (!args.out) {
            return cwd;
        }
        return isAbsolute(args.out) ? args.out : resolve(cwd, args.out);
    };
    // This property references other methods in the class so it must be defined at the end.
    // This is probably an indicator that some refactoring should happen here but right now I'm just trying to apply this lint rule to the codebase
    // eslint-disable-next-line @typescript-eslint/member-ordering
    formatParamBuilders = {
        [GenerateApiCodeFormat.MODELGEN]: this.getModelgenFormatParams,
        [GenerateApiCodeFormat.GRAPHQL_CODEGEN]: this.getGraphqlCodegenFormatParams,
        [GenerateApiCodeFormat.INTROSPECTION]: this.getIntrospectionFormatParams,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVfZ3JhcGhxbF9jbGllbnRfY29kZV9jb21tYW5kLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbW1hbmRzL2dlbmVyYXRlL2dyYXBocWwtY2xpZW50LWNvZGUvZ2VuZXJhdGVfZ3JhcGhxbF9jbGllbnRfY29kZV9jb21tYW5kLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBSzNDLE9BQU8sRUFDTCxxQkFBcUIsRUFDckIsMEJBQTBCLEVBQzFCLDhCQUE4QixFQUM5Qix5QkFBeUIsR0FJMUIsTUFBTSw4QkFBOEIsQ0FBQztBQStCdEMsTUFBTSx3Q0FBd0MsR0FHMUM7SUFDRixDQUFDLDhCQUE4QixDQUFDLFVBQVUsQ0FBQyxFQUFFLFNBQVM7SUFDdEQsQ0FBQyw4QkFBOEIsQ0FBQyxVQUFVLENBQUMsRUFDekMseUJBQXlCLENBQUMsVUFBVTtJQUN0QyxDQUFDLDhCQUE4QixDQUFDLE9BQU8sQ0FBQyxFQUFFLFNBQVM7SUFDbkQsQ0FBQyw4QkFBOEIsQ0FBQyxJQUFJLENBQUMsRUFBRSx5QkFBeUIsQ0FBQyxJQUFJO0lBQ3JFLENBQUMsOEJBQThCLENBQUMsT0FBTyxDQUFDLEVBQUUseUJBQXlCLENBQUMsT0FBTztDQUM1RSxDQUFDO0FBRUY7O0dBRUc7QUFDSCxNQUFNLE9BQU8sZ0NBQWdDO0lBaUJ4QjtJQUNBO0lBZm5COztPQUVHO0lBQ00sT0FBTyxDQUFTO0lBRXpCOztPQUVHO0lBQ00sUUFBUSxDQUFTO0lBRTFCOztPQUVHO0lBQ0gsWUFDbUIsc0JBQThDLEVBQzlDLHlCQUFvRDtRQURwRCwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBQzlDLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBMkI7UUFFckUsSUFBSSxDQUFDLE9BQU8sR0FBRyxxQkFBcUIsQ0FBQztRQUNyQyxJQUFJLENBQUMsUUFBUSxHQUFH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Q0FBQyxDQUFDLEVBQUUsQ0FBQztTQUNSLENBQUM7SUFDSixDQUFDLENBQUM7SUFFRjs7O09BR0c7SUFDSyw0QkFBNEIsR0FBRyxHQUFpQyxFQUFFLENBQUMsQ0FBQztRQUMxRSxNQUFNLEVBQUUscUJBQXFCLENBQUMsYUFBYTtLQUM1QyxDQUFDLENBQUM7SUFFSyxTQUFTLEdBQUcsQ0FBQyxJQUE2QyxFQUFFLEVBQUU7UUFDcEUsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDZCxPQUFPLEdBQUcsQ0FBQztRQUNiLENBQUM7UUFDRCxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2xFLENBQUMsQ0FBQztJQUVGLHdGQUF3RjtJQUN4RiwrSUFBK0k7SUFDL0ksOERBQThEO0lBQ3RELG1CQUFtQixHQUd2QjtRQUNGLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxDQUFDLHVCQUF1QjtRQUM5RCxDQUFDLHFCQUFxQixDQUFDLGVBQWUsQ0FBQyxFQUFFLElBQUksQ0FBQyw2QkFBNkI7UUFDM0UsQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLENBQUMsRUFBRSxJQUFJLENBQUMsNEJBQTRCO0tBQ3pFLENBQUM7Q0FDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFyZ3VtZW50c0NhbWVsQ2FzZSwgQXJndiwgQ29tbWFuZE1vZHVsZSB9IGZyb20gJ3lhcmdzJztcbmltcG9ydCB7IEJhY2tlbmRJZGVudGlmaWVyUmVzb2x2ZXIgfSBmcm9tICcuLi8uLi8uLi9iYWNrZW5kLWlkZW50aWZpZXIvYmFja2VuZF9pZGVudGlmaWVyX3Jlc29sdmVyLmpzJztcbmltcG9ydCB7IGlzQWJzb2x1dGUsIHJlc29sdmUgfSBmcm9tICdwYXRoJztcbmltcG9ydCB7XG4gIEdlbmVyYXRlQXBpQ29kZUFkYXB0ZXIsXG4gIEludm9rZUdlbmVyYXRlQXBpQ29kZVByb3BzLFxufSBmcm9tICcuL2dlbmVyYXRlX2FwaV9jb2RlX2FkYXB0ZXIuanMnO1xuaW1wb3J0IHtcbiAgR2VuZXJhdGVBcGlDb2RlRm9ybWF0LFxuICBHZW5lcmF0ZUFwaUNvZGVNb2RlbFRhcmdldCxcbiAgR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LFxuICBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0LFxuICBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuT3B0aW9ucyxcbiAgR2VuZXJhdGVJbnRyb3NwZWN0aW9uT3B0aW9ucyxcbiAgR2VuZXJhdGVNb2RlbHNPcHRpb25zLFxufSBmcm9tICdAYXdzLWFtcGxpZnkvbW9kZWwtZ2VuZXJhdG9yJztcbmltcG9ydCB7IEFyZ3VtZW50c0tlYmFiQ2FzZSB9IGZyb20gJy4uLy4uLy4uL2tlYmFiX2Nhc2UuanMnO1xuXG50eXBlIEdlbmVyYXRlT3B0aW9ucyA9XG4gIHwgR2VuZXJhdGVHcmFwaHFsQ29kZWdlbk9wdGlvbnNcbiAgfCBHZW5lcmF0ZU1vZGVsc09wdGlvbnNcbiAgfCBHZW5lcmF0ZUludHJvc3BlY3Rpb25PcHRpb25zO1xuXG5leHBvcnQgdHlwZSBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnMgPVxuICBBcmd1bWVudHNLZWJhYkNhc2U8R2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zQ2FtZWxDYXNlPjtcblxudHlwZSBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnNDYW1lbENhc2UgPSB7XG4gIHN0YWNrOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGFwcElkOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGJyYW5jaDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdCB8IHVuZGVmaW5lZDtcbiAgbW9kZWxUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0IHwgdW5kZWZpbmVkO1xuICBzdGF0ZW1lbnRUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldCB8IHVuZGVmaW5lZDtcbiAgdHlwZVRhcmdldDogR2VuZXJhdGVBcGlDb2RlVHlwZVRhcmdldCB8IHVuZGVmaW5lZDtcbiAgb3V0OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIG1vZGVsR2VuZXJhdGVJbmRleFJ1bGVzOiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICBtb2RlbEVtaXRBdXRoUHJvdmlkZXI6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIG1vZGVsUmVzcGVjdFByaW1hcnlLZXlBdHRyaWJ1dGVzT25Db25uZWN0aW9uRmllbGQ6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIG1vZGVsR2VuZXJhdGVNb2RlbHNGb3JMYXp5TG9hZEFuZEN1c3RvbVNlbGVjdGlvblNldDogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgbW9kZWxBZGRUaW1lc3RhbXBGaWVsZHM6IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIG1vZGVsSGFuZGxlTGlzdE51bGxhYmlsaXR5VHJhbnNwYXJlbnRseTogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgc3RhdGVtZW50TWF4RGVwdGg6IG51bWJlciB8IHVuZGVmaW5lZDtcbiAgc3RhdGVtZW50VHlwZW5hbWVJbnRyb3NwZWN0aW9uOiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICB0eXBlTXVsdGlwbGVTd2lmdEZpbGVzOiBib29sZWFuIHwgdW5kZWZpbmVkO1xufTtcblxuY29uc3QgREVGQVVMVF9UWVBFX1RBUkdFVF9GT1JfU1RBVEVNRU5UX1RBUkdFVDogUmVjb3JkPFxuICBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQsXG4gIEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQgfCB1bmRlZmluZWRcbj4gPSB7XG4gIFtHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQuSkFWQVNDUklQVF06IHVuZGVmaW5lZCxcbiAgW0dlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldC5UWVBFU0NSSVBUXTpcbiAgICBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0LlRZUEVTQ1JJUFQsXG4gIFtHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQuR1JBUEhRTF06IHVuZGVmaW5lZCxcbiAgW0dlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldC5GTE9XXTogR2VuZXJhdGVBcGlDb2RlVHlwZVRhcmdldC5GTE9XLFxuICBbR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0LkFOR1VMQVJdOiBHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0LkFOR1VMQVIsXG59O1xuXG4vKipcbiAqIENvbW1hbmQgdGhhdCBnZW5lcmF0ZXMgZ3JhcGhxbCBjbGllbnQgY29kZS5cbiAqL1xuZXhwb3J0IGNsYXNzIEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kXG4gIGltcGxlbWVudHMgQ29tbWFuZE1vZHVsZTxvYmplY3QsIEdlbmVyYXRlR3JhcGhxbENsaWVudENvZGVDb21tYW5kT3B0aW9ucz5cbntcbiAgLyoqXG4gICAqIEBpbmhlcml0RG9jXG4gICAqL1xuICByZWFkb25seSBjb21tYW5kOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0RG9jXG4gICAqL1xuICByZWFkb25seSBkZXNjcmliZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGdyYXBocWwgY2xpZW50IGNvZGUgZ2VuZXJhdGlvbiBjb21tYW5kLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBnZW5lcmF0ZUFwaUNvZGVBZGFwdGVyOiBHZW5lcmF0ZUFwaUNvZGVBZGFwdGVyLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgYmFja2VuZElkZW50aWZpZXJSZXNvbHZlcjogQmFja2VuZElkZW50aWZpZXJSZXNvbHZlcixcbiAgKSB7XG4gICAgdGhpcy5jb21tYW5kID0gJ2dyYXBocWwtY2xpZW50LWNvZGUnO1xuICAgIHRoaXMuZGVzY3JpYmUgPSAnR2VuZXJhdGVzIGdyYXBocWwgQVBJIGNvZGUnO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0RG9jXG4gICAqL1xuICBoYW5kbGVyID0gYXN5bmMgKFxuICAgIGFyZ3M6IEFyZ3VtZW50c0NhbWVsQ2FzZTxHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnM+LFxuICApOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICBjb25zdCBiYWNrZW5kSWRlbnRpZmllciA9XG4gICAgICBhd2FpdCB0aGlzLmJhY2tlbmRJZGVudGlmaWVyUmVzb2x2ZXIucmVzb2x2ZURlcGxveWVkQmFja2VuZElkZW50aWZpZXIoXG4gICAgICAgIGFyZ3MsXG4gICAgICApO1xuICAgIGNvbnN0IG91dCA9IHRoaXMuZ2V0T3V0RGlyKGFyZ3MpO1xuICAgIGNvbnN0IGZvcm1hdCA9IGFyZ3MuZm9ybWF0ID8/IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5HUkFQSFFMX0NPREVHRU47XG4gICAgY29uc3QgZm9ybWF0UGFyYW1zID0gdGhpcy5mb3JtYXRQYXJhbUJ1aWxkZXJzW2Zvcm1hdF0oYXJncyk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmdlbmVyYXRlQXBpQ29kZUFkYXB0ZXIuaW52b2tlR2VuZXJhdGVBcGlDb2RlKHtcbiAgICAgIC4uLmJhY2tlbmRJZGVudGlmaWVyLFxuICAgICAgLi4uZm9ybWF0UGFyYW1zLFxuICAgIH0gYXMgdW5rbm93biBhcyBJbnZva2VHZW5lcmF0ZUFwaUNvZGVQcm9wcyk7XG5cbiAgICBhd2FpdCByZXN1bHQud3JpdGVUb0RpcmVjdG9yeShvdXQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAaW5oZXJpdERvY1xuICAgKi9cbiAgYnVpbGRlciA9ICh5YXJnczogQXJndik6IEFyZ3Y8R2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zPiA9PiB7XG4gICAgcmV0dXJuIHlhcmdzXG4gICAgICAub3B0aW9uKCdzdGFjaycsIHtcbiAgICAgICAgY29uZmxpY3RzOiBbJ2FwcC1pZCcsICdicmFuY2gnXSxcbiAgICAgICAgZGVzY3JpYmU6ICdBIHN0YWNrIG5hbWUgdGhhdCBjb250YWlucyBhbiBBbXBsaWZ5IGJhY2tlbmQnLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBncm91cDogJ1N0YWNrIGlkZW50aWZpZXInLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ2FwcC1pZCcsIHtcbiAgICAgICAgY29uZmxpY3RzOiBbJ3N0YWNrJ10sXG4gICAgICAgIGRlc2NyaWJlOiAnVGhlIEFtcGxpZnkgQXBwIElEIG9mIHRoZSBwcm9qZWN0JyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgaW1wbGllczogJ2JyYW5jaCcsXG4gICAgICAgIGdyb3VwOiAnUHJvamVjdCBpZGVudGlmaWVyJyxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdicmFuY2gnLCB7XG4gICAgICAgIGNvbmZsaWN0czogWydzdGFjayddLFxuICAgICAgICBkZXNjcmliZTogJ0EgZ2l0IGJyYW5jaCBvZiB0aGUgQW1wbGlmeSBwcm9qZWN0JyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgaW1wbGllczogJ2FwcC1pZCcsXG4gICAgICAgIGdyb3VwOiAnUHJvamVjdCBpZGVudGlmaWVyJyxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdvdXQnLCB7XG4gICAgICAgIGRlc2NyaWJlOlxuICAgICAgICAgICdBIHBhdGggdG8gZGlyZWN0b3J5IHdoZXJlIGNvbmZpZyBpcyB3cml0dGVuLiBJZiBub3QgcHJvdmlkZWQgZGVmYXVsdHMgdG8gY3VycmVudCBwcm9jZXNzIHdvcmtpbmcgZGlyZWN0b3J5LicsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICB9KVxuICAgICAgLm9wdGlvbignZm9ybWF0Jywge1xuICAgICAgICBkZXNjcmliZTpcbiAgICAgICAgICAnVGhlIGZvcm1hdCB0aGF0IHRoZSBHcmFwaFFMIGNsaWVudCBjb2RlIHNob3VsZCBiZSBnZW5lcmF0ZWQgaW4uJyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgY2hvaWNlczogT2JqZWN0LnZhbHVlcyhHZW5lcmF0ZUFwaUNvZGVGb3JtYXQpLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ21vZGVsLXRhcmdldCcsIHtcbiAgICAgICAgZGVzY3JpYmU6XG4gICAgICAgICAgJ1RoZSBtb2RlbGdlbiBleHBvcnQgdGFyZ2V0LiBPbmx5IGFwcGxpZXMgd2hlbiB0aGUgYC0tZm9ybWF0YCBwYXJhbWV0ZXIgaXMgc2V0IHRvIGBtb2RlbGdlbmAnLFxuICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgICBjaG9pY2VzOiBPYmplY3QudmFsdWVzKEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0KSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdzdGF0ZW1lbnQtdGFyZ2V0Jywge1xuICAgICAgICBkZXNjcmliZTpcbiAgICAgICAgICAnVGhlIGdyYXBocWwtY29kZWdlbiBzdGF0ZW1lbnQgZXhwb3J0IHRhcmdldC4gT25seSBhcHBsaWVzIHdoZW4gdGhlIGAtLWZvcm1hdGAgcGFyYW1ldGVyIGlzIHNldCB0byBgZ3JhcGhxbC1jb2RlZ2VuYCcsXG4gICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICBhcnJheTogZmFsc2UsXG4gICAgICAgIGNob2ljZXM6IE9iamVjdC52YWx1ZXMoR2VuZXJhdGVBcGlDb2RlU3RhdGVtZW50VGFyZ2V0KSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCd0eXBlLXRhcmdldCcsIHtcbiAgICAgICAgZGVzY3JpYmU6XG4gICAgICAgICAgJ1RoZSBvcHRpb25hbCBncmFwaHFsLWNvZGVnZW4gdHlwZSBleHBvcnQgdGFyZ2V0LiBPbmx5IGFwcGxpZXMgd2hlbiB0aGUgYC0tZm9ybWF0YCBwYXJhbWV0ZXIgaXMgc2V0IHRvIGBncmFwaHFsLWNvZGVnZW5gJyxcbiAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgICAgY2hvaWNlczogT2JqZWN0LnZhbHVlcyhHZW5lcmF0ZUFwaUNvZGVUeXBlVGFyZ2V0KSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1nZW5lcmF0ZS1pbmRleC1ydWxlcycsIHtcbiAgICAgICAgZGVzY3JpcHRpb246ICdBZGRzIGtleS9pbmRleCBkZXRhaWxzIHRvIGlPUyBtb2RlbHMnLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1lbWl0LWF1dGgtcHJvdmlkZXInLCB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQWRkcyBhdXRoIHByb3ZpZGVyIGRldGFpbHMgdG8gaU9TIG1vZGVscycsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ21vZGVsLXJlc3BlY3QtcHJpbWFyeS1rZXktYXR0cmlidXRlcy1vbi1jb25uZWN0aW9uLWZpZWxkJywge1xuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAnSWYgZW5hYmxlZCwgRGF0YXN0b3JlIHF1ZXJpZXMgd2lsbCByZXNwZWN0IHRoZSBwcmltYXJ5ICsgc29ydCBrZXkgZmllbGRzLCByYXRoZXIgdGhhbiBhIGRlZmF1bHQgaWQgZmllbGQnLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1nZW5lcmF0ZS1tb2RlbHMtZm9yLWxhenktbG9hZC1hbmQtY3VzdG9tLXNlbGVjdGlvbi1zZXQnLCB7XG4gICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICdHZW5lcmF0ZXMgbGF6eSBtb2RlbCB0eXBlIGRlZmluaXRpb25zLCByZXF1aXJlZCBvciBhbXBsaWZ5LWpzIHY1KycsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ21vZGVsLWFkZC10aW1lc3RhbXAtZmllbGRzJywge1xuICAgICAgICBkZXNjcmlwdGlvbjogJ0FkZCByZWFkLW9ubHkgdGltZXN0YW1wIGZpZWxkcyBpbiBtb2RlbGdlbi4nLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCdtb2RlbC1oYW5kbGUtbGlzdC1udWxsYWJpbGl0eS10cmFuc3BhcmVudGx5Jywge1xuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAnQ29uZmlndXJlIHRoZSBudWxsYWJpbGl0eSBvZiB0aGUgTGlzdCBhbmQgTGlzdCBjb21wb25lbnRzIGluIERhdGFzdG9yZSBNb2RlbHMgZ2VuZXJhdGlvbicsXG4gICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ3N0YXRlbWVudC1tYXgtZGVwdGgnLCB7XG4gICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICdEZXRlcm1pbmVzIGhvdyBkZWVwbHkgbmVzdGVkIHRvIGdlbmVyYXRlIGdyYXBocWwgc3RhdGVtZW50cy4nLFxuICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgfSlcbiAgICAgIC5vcHRpb24oJ3N0YXRlbWVudC10eXBlbmFtZS1pbnRyb3NwZWN0aW9uJywge1xuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAnRGV0ZXJtaW5lcyB3aGV0aGVyIHRvIGluY2x1ZGUgZGVmYXVsdCBfX3R5cGVuYW1lIGZvciBhbGwgZ2VuZXJhdGVkIHN0YXRlbWVudHMnLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgIH0pXG4gICAgICAub3B0aW9uKCd0eXBlLW11bHRpcGxlLXN3aWZ0LWZpbGVzJywge1xuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICAnRGV0ZXJtaW5lcyB3aGV0aGVyIG9yIG5vdCB0byBnZW5lcmF0ZSBhIHNpbmdsZSBBUEkuc3dpZnQsIG9yIG11bHRpcGxlIHBlci1tb2RlbCBzd2lmdCBmaWxlcy4nLFxuICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgIGFycmF5OiBmYWxzZSxcbiAgICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBQcm9kdWNlIHRoZSByZXF1aXJlZCBpbnB1dCBmb3IgZ3JhcGhxbC1jb2RlZ2VuIGNhbGxzIGZyb20gdGhlIENMSSBpbnB1dCwgYXBwbHlpbmcgc2FuZSBkZWZhdWx0cyB3aGVyZSBhcHBsaWNhYmxlLlxuICAgKiBAcGFyYW0gYXJncyBDTEkgYXJncyBwcm92aWRlZCBieSB0aGUgY3VzdG9tZXJcbiAgICogQHJldHVybnMgdGhlIGNvZGVnZW4gb3B0aW9ucyBjb25maWdcbiAgICovXG4gIHByaXZhdGUgZ2V0R3JhcGhxbENvZGVnZW5Gb3JtYXRQYXJhbXMgPSAoXG4gICAgYXJnczogR2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zLFxuICApOiBHZW5lcmF0ZUdyYXBocWxDb2RlZ2VuT3B0aW9ucyA9PiB7XG4gICAgY29uc3Qgc3RhdGVtZW50VGFyZ2V0OiBHZW5lcmF0ZUFwaUNvZGVTdGF0ZW1lbnRUYXJnZXQgPVxuICAgICAgYXJnc1snc3RhdGVtZW50LXRhcmdldCddID8/IEdlbmVyYXRlQXBpQ29kZVN0YXRlbWVudFRhcmdldC5UWVBFU0NSSVBUO1xuICAgIGNvbnN0IHR5cGVUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZVR5cGVUYXJnZXQgfCB1bmRlZmluZWQgPVxuICAgICAgYXJnc1sndHlwZS10YXJnZXQnXSA/P1xuICAgICAgREVGQVVMVF9UWVBFX1RBUkdFVF9GT1JfU1RBVEVNRU5UX1RBUkdFVFtzdGF0ZW1lbnRUYXJnZXRdO1xuICAgIGNvbnN0IG1heERlcHRoOiBudW1iZXIgfCB1bmRlZmluZWQgPSBhcmdzWydzdGF0ZW1lbnQtbWF4LWRlcHRoJ107XG4gICAgY29uc3QgdHlwZU5hbWVJbnRyb3NwZWN0aW9uOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ3N0YXRlbWVudC10eXBlbmFtZS1pbnRyb3NwZWN0aW9uJ107XG4gICAgY29uc3QgbXVsdGlwbGVTd2lmdEZpbGVzOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ3R5cGUtbXVsdGlwbGUtc3dpZnQtZmlsZXMnXTtcblxuICAgIHJldHVybiB7XG4gICAgICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5HUkFQSFFMX0NPREVHRU4sXG4gICAgICBzdGF0ZW1lbnRUYXJnZXQsXG4gICAgICAuLi4odHlwZVRhcmdldCAhPT0gdW5kZWZpbmVkID8geyB0eXBlVGFyZ2V0IH0gOiB7fSksXG4gICAgICAuLi4obWF4RGVwdGggIT09IHVuZGVmaW5lZCA/IHsgbWF4RGVwdGggfSA6IHt9KSxcbiAgICAgIC4uLih0eXBlTmFtZUludHJvc3BlY3Rpb24gIT09IHVuZGVmaW5lZCA/IHsgdHlwZU5hbWVJbnRyb3NwZWN0aW9uIH0gOiB7fSksXG4gICAgICAuLi4obXVsdGlwbGVTd2lmdEZpbGVzICE9PSB1bmRlZmluZWQgPyB7IG11bHRpcGxlU3dpZnRGaWxlcyB9IDoge30pLFxuICAgIH07XG4gIH07XG5cbiAgLyoqXG4gICAqIFByb2R1Y2UgdGhlIHJlcXVpcmVkIGlucHV0IGZvciBtb2RlbGdlbiBjYWxscyBmcm9tIHRoZSBDTEkgaW5wdXQsIGFwcGx5aW5nIHNhbmUgZGVmYXVsdHMgd2hlcmUgYXBwbGljYWJsZS5cbiAgICogQHBhcmFtIGFyZ3MgQ0xJIGFyZ3MgcHJvdmlkZWQgYnkgdGhlIGN1c3RvbWVyXG4gICAqIEByZXR1cm5zIHRoZSBtb2RlbGdlbiBvcHRpb25zIGNvbmZpZ1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRNb2RlbGdlbkZvcm1hdFBhcmFtcyA9IChcbiAgICBhcmdzOiBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnMsXG4gICk6IEdlbmVyYXRlTW9kZWxzT3B0aW9ucyA9PiB7XG4gICAgY29uc3QgbW9kZWxUYXJnZXQ6IEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0ID1cbiAgICAgIGFyZ3NbJ21vZGVsLXRhcmdldCddID8/IEdlbmVyYXRlQXBpQ29kZU1vZGVsVGFyZ2V0LlRZUEVTQ1JJUFQ7XG4gICAgY29uc3QgZ2VuZXJhdGVJbmRleFJ1bGVzOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ21vZGVsLWdlbmVyYXRlLWluZGV4LXJ1bGVzJ107XG4gICAgY29uc3QgZW1pdEF1dGhQcm92aWRlcjogYm9vbGVhbiB8IHVuZGVmaW5lZCA9XG4gICAgICBhcmdzWydtb2RlbC1lbWl0LWF1dGgtcHJvdmlkZXInXTtcbiAgICBjb25zdCByZXNwZWN0UHJpbWFyeUtleUF0dHJpYnV0ZXNPbkNvbm5lY3Rpb25GaWVsZDogYm9vbGVhbiB8IHVuZGVmaW5lZCA9XG4gICAgICBhcmdzWydtb2RlbC1yZXNwZWN0LXByaW1hcnkta2V5LWF0dHJpYnV0ZXMtb24tY29ubmVjdGlvbi1maWVsZCddO1xuICAgIGNvbnN0IGdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQ6IGJvb2xlYW4gfCB1bmRlZmluZWQgPVxuICAgICAgYXJnc1snbW9kZWwtZ2VuZXJhdGUtbW9kZWxzLWZvci1sYXp5LWxvYWQtYW5kLWN1c3RvbS1zZWxlY3Rpb24tc2V0J107XG4gICAgY29uc3QgYWRkVGltZXN0YW1wRmllbGRzOiBib29sZWFuIHwgdW5kZWZpbmVkID1cbiAgICAgIGFyZ3NbJ21vZGVsLWFkZC10aW1lc3RhbXAtZmllbGRzJ107XG4gICAgY29uc3QgaGFuZGxlTGlzdE51bGxhYmlsaXR5VHJhbnNwYXJlbnRseTogYm9vbGVhbiB8IHVuZGVmaW5lZCA9XG4gICAgICBhcmdzWydtb2RlbC1oYW5kbGUtbGlzdC1udWxsYWJpbGl0eS10cmFuc3BhcmVudGx5J107XG5cbiAgICByZXR1cm4ge1xuICAgICAgZm9ybWF0OiBHZW5lcmF0ZUFwaUNvZGVGb3JtYXQuTU9ERUxHRU4sXG4gICAgICBtb2RlbFRhcmdldCxcbiAgICAgIC4uLihnZW5lcmF0ZUluZGV4UnVsZXMgIT09IHVuZGVmaW5lZCA/IHsgZ2VuZXJhdGVJbmRleFJ1bGVzIH0gOiB7fSksXG4gICAgICAuLi4oZW1pdEF1dGhQcm92aWRlciAhPT0gdW5kZWZpbmVkID8geyBlbWl0QXV0aFByb3ZpZGVyIH0gOiB7fSksXG4gICAgICAuLi4ocmVzcGVjdFByaW1hcnlLZXlBdHRyaWJ1dGVzT25Db25uZWN0aW9uRmllbGQgIT09IHVuZGVmaW5lZFxuICAgICAgICA/IHsgcmVzcGVjdFByaW1hcnlLZXlBdHRyaWJ1dGVzT25Db25uZWN0aW9uRmllbGQgfVxuICAgICAgICA6IHt9KSxcbiAgICAgIC4uLihnZW5lcmF0ZU1vZGVsc0ZvckxhenlMb2FkQW5kQ3VzdG9tU2VsZWN0aW9uU2V0ICE9PSB1bmRlZmluZWRcbiAgICAgICAgPyB7IGdlbmVyYXRlTW9kZWxzRm9yTGF6eUxvYWRBbmRDdXN0b21TZWxlY3Rpb25TZXQgfVxuICAgICAgICA6IHt9KSxcbiAgICAgIC4uLihhZGRUaW1lc3RhbXBGaWVsZHMgIT09IHVuZGVmaW5lZCA/IHsgYWRkVGltZXN0YW1wRmllbGRzIH0gOiB7fSksXG4gICAgICAuLi4oaGFuZGxlTGlzdE51bGxhYmlsaXR5VHJhbnNwYXJlbnRseSAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8geyBoYW5kbGVMaXN0TnVsbGFiaWxpdHlUcmFuc3BhcmVudGx5IH1cbiAgICAgICAgOiB7fSksXG4gICAgfTtcbiAgfTtcblxuICAvKipcbiAgICogUHJvZHVjZSB0aGUgaW50cm9zcGVjdGlvbiBzY2hlbWEgY29uZmlnIHNoYXBlLlxuICAgKiBAcmV0dXJucyB0aGUgaW50cm9zcGVjdGlvbiBvcHRpb25zIGNvbmZpZ1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRJbnRyb3NwZWN0aW9uRm9ybWF0UGFyYW1zID0gKCk6IEdlbmVyYXRlSW50cm9zcGVjdGlvbk9wdGlvbnMgPT4gKHtcbiAgICBmb3JtYXQ6IEdlbmVyYXRlQXBpQ29kZUZvcm1hdC5JTlRST1NQRUNUSU9OLFxuICB9KTtcblxuICBwcml2YXRlIGdldE91dERpciA9IChhcmdzOiBHZW5lcmF0ZUdyYXBocWxDbGllbnRDb2RlQ29tbWFuZE9wdGlvbnMpID0+IHtcbiAgICBjb25zdCBjd2QgPSBwcm9jZXNzLmN3ZCgpO1xuICAgIGlmICghYXJncy5vdXQpIHtcbiAgICAgIHJldHVybiBjd2Q7XG4gICAgfVxuICAgIHJldHVybiBpc0Fic29sdXRlKGFyZ3Mub3V0KSA/IGFyZ3Mub3V0IDogcmVzb2x2ZShjd2QsIGFyZ3Mub3V0KTtcbiAgfTtcblxuICAvLyBUaGlzIHByb3BlcnR5IHJlZmVyZW5jZXMgb3RoZXIgbWV0aG9kcyBpbiB0aGUgY2xhc3Mgc28gaXQgbXVzdCBiZSBkZWZpbmVkIGF0IHRoZSBlbmQuXG4gIC8vIFRoaXMgaXMgcHJvYmFibHkgYW4gaW5kaWNhdG9yIHRoYXQgc29tZSByZWZhY3RvcmluZyBzaG91bGQgaGFwcGVuIGhlcmUgYnV0IHJpZ2h0IG5vdyBJJ20ganVzdCB0cnlpbmcgdG8gYXBwbHkgdGhpcyBsaW50IHJ1bGUgdG8gdGhlIGNvZGViYXNlXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbWVtYmVyLW9yZGVyaW5nXG4gIHByaXZhdGUgZm9ybWF0UGFyYW1CdWlsZGVyczogUmVjb3JkPFxuICAgIEdlbmVyYXRlQXBpQ29kZUZvcm1hdCxcbiAgICAoYXJnczogR2VuZXJhdGVHcmFwaHFsQ2xpZW50Q29kZUNvbW1hbmRPcHRpb25zKSA9PiBHZW5lcmF0ZU9wdGlvbnNcbiAgPiA9IHtcbiAgICBbR2VuZXJhdGVBcGlDb2RlRm9ybWF0Lk1PREVMR0VOXTogdGhpcy5nZXRNb2RlbGdlbkZvcm1hdFBhcmFtcyxcbiAgICBbR2VuZXJhdGVBcGlDb2RlRm9ybWF0LkdSQVBIUUxfQ09ERUdFTl06IHRoaXMuZ2V0R3JhcGhxbENvZGVnZW5Gb3JtYXRQYXJhbXMsXG4gICAgW0dlbmVyYXRlQXBpQ29kZUZvcm1hdC5JTlRST1NQRUNUSU9OXTogdGhpcy5nZXRJbnRyb3NwZWN0aW9uRm9ybWF0UGFyYW1zLFxuICB9O1xufVxuIl19