"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.setSpanAttributes = void 0;
/**
 * Flatten object to dot notation and set span attributes for telemetry
 */
const setSpanAttributes = (span, obj, prefix = '') => {
    if (obj && typeof obj === 'object') {
        for (const [key, value] of Object.entries(obj)) {
            if (value === undefined || value === null) {
                continue;
            }
            const fullKey = prefix ? `${prefix}.${key}` : key;
            if (isAttributeValue(value)) {
                span.setAttribute(fullKey, value);
            }
            else if (typeof value === 'object') {
                (0, exports.setSpanAttributes)(span, value, fullKey);
            }
        }
    }
};
exports.setSpanAttributes = setSpanAttributes;
const isAttributeValue = (value) => {
    return (typeof value === 'string' ||
        typeof value === 'number' ||
        typeof value === 'boolean' ||
        (Array.isArray(value) &&
            value.every((val) => typeof val === 'string' ||
                typeof val === 'number' ||
                typeof val === 'boolean')));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0X3NwYW5fYXR0cmlidXRlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZWxlbWV0cnkvc2V0X3NwYW5fYXR0cmlidXRlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFJQTs7R0FFRztBQUNJLE1BQU0saUJBQWlCLEdBQUcsQ0FDL0IsSUFBVSxFQUNWLEdBQWlELEVBQ2pELFNBQWlCLEVBQUUsRUFDYixFQUFFO0lBQ1IsSUFBSSxHQUFHLElBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxFQUFFLENBQUM7UUFDbkMsS0FBSyxNQUFNLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUMvQyxJQUFJLEtBQUssS0FBSyxTQUFTLElBQUksS0FBSyxLQUFLLElBQUksRUFBRSxDQUFDO2dCQUMxQyxTQUFTO1lBQ1gsQ0FBQztZQUNELE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUVsRCxJQUFJLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3BDLENBQUM7aUJBQU0sSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUUsQ0FBQztnQkFDckMsSUFBQSx5QkFBaUIsRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzFDLENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztBQUNILENBQUMsQ0FBQztBQW5CVyxRQUFBLGlCQUFpQixxQkFtQjVCO0FBRUYsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLEtBQWMsRUFBMkIsRUFBRTtJQUNuRSxPQUFPLENBQ0wsT0FBTyxLQUFLLEtBQUssUUFBUTtRQUN6QixPQUFPLEtBQUssS0FBSyxRQUFRO1FBQ3pCLE9BQU8sS0FBSyxLQUFLLFNBQVM7UUFDMUIsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztZQUNuQixLQUFLLENBQUMsS0FBSyxDQUNULENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FDTixPQUFPLEdBQUcsS0FBSyxRQUFRO2dCQUN2QixPQUFPLEdBQUcsS0FBSyxRQUFRO2dCQUN2QixPQUFPLEdBQUcsS0FBSyxTQUFTLENBQzNCLENBQUMsQ0FDTCxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVlcFBhcnRpYWwgfSBmcm9tICdAYXdzLWFtcGxpZnkvcGx1Z2luLXR5cGVzJztcbmltcG9ydCB7IEF0dHJpYnV0ZVZhbHVlLCBTcGFuIH0gZnJvbSAnQG9wZW50ZWxlbWV0cnkvYXBpJztcbmltcG9ydCB7IEVycm9yRGV0YWlscywgVGVsZW1ldHJ5UGF5bG9hZCB9IGZyb20gJy4vdGVsZW1ldHJ5X3BheWxvYWQnO1xuXG4vKipcbiAqIEZsYXR0ZW4gb2JqZWN0IHRvIGRvdCBub3RhdGlvbiBhbmQgc2V0IHNwYW4gYXR0cmlidXRlcyBmb3IgdGVsZW1ldHJ5XG4gKi9cbmV4cG9ydCBjb25zdCBzZXRTcGFuQXR0cmlidXRlcyA9IChcbiAgc3BhbjogU3BhbixcbiAgb2JqOiBEZWVwUGFydGlhbDxUZWxlbWV0cnlQYXlsb2FkPiB8IEVycm9yRGV0YWlscyxcbiAgcHJlZml4OiBzdHJpbmcgPSAnJyxcbik6IHZvaWQgPT4ge1xuICBpZiAob2JqICYmIHR5cGVvZiBvYmogPT09ICdvYmplY3QnKSB7XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMob2JqKSkge1xuICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBmdWxsS2V5ID0gcHJlZml4ID8gYCR7cHJlZml4fS4ke2tleX1gIDoga2V5O1xuXG4gICAgICBpZiAoaXNBdHRyaWJ1dGVWYWx1ZSh2YWx1ZSkpIHtcbiAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGUoZnVsbEtleSwgdmFsdWUpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHNldFNwYW5BdHRyaWJ1dGVzKHNwYW4sIHZhbHVlLCBmdWxsS2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmNvbnN0IGlzQXR0cmlidXRlVmFsdWUgPSAodmFsdWU6IHVua25vd24pOiB2YWx1ZSBpcyBBdHRyaWJ1dGVWYWx1ZSA9PiB7XG4gIHJldHVybiAoXG4gICAgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyB8fFxuICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHxcbiAgICB0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJyB8fFxuICAgIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJlxuICAgICAgdmFsdWUuZXZlcnkoXG4gICAgICAgICh2YWwpID0+XG4gICAgICAgICAgdHlwZW9mIHZhbCA9PT0gJ3N0cmluZycgfHxcbiAgICAgICAgICB0eXBlb2YgdmFsID09PSAnbnVtYmVyJyB8fFxuICAgICAgICAgIHR5cGVvZiB2YWwgPT09ICdib29sZWFuJyxcbiAgICAgICkpXG4gICk7XG59O1xuIl19