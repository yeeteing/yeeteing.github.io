import { BackendOutputClientFactory, } from '@aws-amplify/deployed-backend-client';
import { graphqlOutputKey } from '@aws-amplify/backend-output-schemas';
import { AppsyncGraphqlGenerationResult } from './appsync_graphql_generation_result.js';
import { StackMetadataGraphqlModelsGenerator } from './graphql_models_generator.js';
import { S3StringObjectFetcher } from './s3_string_object_fetcher.js';
import { getBackendOutputWithErrorHandling } from './get_backend_output_with_error_handling.js';
/**
 * Factory function to compose a model generator.
 */
export const createGraphqlModelsGenerator = (params) => {
    if ('backendIdentifier' in params) {
        return createGraphqlModelsGeneratorFromBackendIdentifier(params);
    }
    return createGraphqlModelsFromS3UriGenerator(params);
};
/**
 * Factory function to compose a model generator from a backend identifier.
 */
const createGraphqlModelsGeneratorFromBackendIdentifier = ({ backendIdentifier, awsClientProvider, }) => {
    if (!backendIdentifier) {
        // eslint-disable-next-line @aws-amplify/amplify-backend-rules/prefer-amplify-errors
        throw new Error('`backendIdentifier` must be defined');
    }
    if (!awsClientProvider) {
        // eslint-disable-next-line @aws-amplify/amplify-backend-rules/prefer-amplify-errors
        throw new Error('`awsClientProvider` must be defined');
    }
    return new StackMetadataGraphqlModelsGenerator(() => getModelSchema(backendIdentifier, awsClientProvider), (fileMap) => new AppsyncGraphqlGenerationResult(fileMap));
};
/**
 * Factory function to compose a model generator from an s3 uri.
 */
export const createGraphqlModelsFromS3UriGenerator = ({ modelSchemaS3Uri, awsClientProvider, }) => {
    if (!modelSchemaS3Uri) {
        // eslint-disable-next-line @aws-amplify/amplify-backend-rules/prefer-amplify-errors
        throw new Error('`modelSchemaS3Uri` must be defined');
    }
    if (!awsClientProvider) {
        // eslint-disable-next-line @aws-amplify/amplify-backend-rules/prefer-amplify-errors
        throw new Error('`awsClientProvider` must be defined');
    }
    return new StackMetadataGraphqlModelsGenerator(() => getModelSchemaFromS3Uri(modelSchemaS3Uri, awsClientProvider), (fileMap) => new AppsyncGraphqlGenerationResult(fileMap));
};
const getModelSchema = async (backendIdentifier, awsClientProvider) => {
    const backendOutputClient = BackendOutputClientFactory.getInstance(awsClientProvider);
    const output = await getBackendOutputWithErrorHandling(backendOutputClient, backendIdentifier);
    const modelSchemaS3Uri = output[graphqlOutputKey]?.payload.amplifyApiModelSchemaS3Uri;
    if (!modelSchemaS3Uri) {
        // eslint-disable-next-line @aws-amplify/amplify-backend-rules/prefer-amplify-errors
        throw new Error(`Cannot find model schema at amplifyApiModelSchemaS3Uri`);
    }
    return await getModelSchemaFromS3Uri(modelSchemaS3Uri, awsClientProvider);
};
const getModelSchemaFromS3Uri = async (modelSchemaS3Uri, awsClientProvider) => {
    const schemaFetcher = new S3StringObjectFetcher(awsClientProvider.getS3Client());
    return await schemaFetcher.fetch(modelSchemaS3Uri);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlX2dyYXBocWxfbW9kZWxzX2dlbmVyYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9jcmVhdGVfZ3JhcGhxbF9tb2RlbHNfZ2VuZXJhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCwwQkFBMEIsR0FFM0IsTUFBTSxzQ0FBc0MsQ0FBQztBQUU5QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUN2RSxPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUN4RixPQUFPLEVBQUUsbUNBQW1DLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUVwRixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUt0RSxPQUFPLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQztBQW9CaEc7O0dBRUc7QUFDSCxNQUFNLENBQUMsTUFBTSw0QkFBNEIsR0FBRyxDQUMxQyxNQUEyQyxFQUNuQixFQUFFO0lBQzFCLElBQUksbUJBQW1CLElBQUksTUFBTSxFQUFFLENBQUM7UUFDbEMsT0FBTyxpREFBaUQsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNuRSxDQUFDO0lBQ0QsT0FBTyxxQ0FBcUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUN2RCxDQUFDLENBQUM7QUFXRjs7R0FFRztBQUNILE1BQU0saURBQWlELEdBQUcsQ0FBQyxFQUN6RCxpQkFBaUIsRUFDakIsaUJBQWlCLEdBQ3dCLEVBQTBCLEVBQUU7SUFDckUsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDdkIsb0ZBQW9GO1FBQ3BGLE1BQU0sSUFBSSxLQUFLLENBQUMscUNBQXFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBQ0QsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDdkIsb0ZBQW9GO1FBQ3BGLE1BQU0sSUFBSSxLQUFLLENBQUMscUNBQXFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBRUQsT0FBTyxJQUFJLG1DQUFtQyxDQUM1QyxHQUFHLEVBQUUsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLEVBQUUsaUJBQWlCLENBQUMsRUFDMUQsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLElBQUksOEJBQThCLENBQUMsT0FBTyxDQUFDLENBQ3pELENBQUM7QUFDSixDQUFDLENBQUM7QUFXRjs7R0FFRztBQUNILE1BQU0sQ0FBQyxNQUFNLHFDQUFxQyxHQUFHLENBQUMsRUFDcEQsZ0JBQWdCLEVBQ2hCLGlCQUFpQixHQUM0QixFQUEwQixFQUFFO0lBQ3pFLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3RCLG9GQUFvRjtRQUNwRixNQUFNLElBQUksS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUNELElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3ZCLG9GQUFvRjtRQUNwRixNQUFNLElBQUksS0FBSyxDQUFDLHFDQUFxQyxDQUFDLENBQUM7SUFDekQsQ0FBQztJQUNELE9BQU8sSUFBSSxtQ0FBbUMsQ0FDNUMsR0FBRyxFQUFFLENBQUMsdUJBQXVCLENBQUMsZ0JBQWdCLEVBQUUsaUJBQWlCLENBQUMsRUFDbEUsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLElBQUksOEJBQThCLENBQUMsT0FBTyxDQUFDLENBQ3pELENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixNQUFNLGNBQWMsR0FBRyxLQUFLLEVBQzFCLGlCQUE0QyxFQUM1QyxpQkFJRSxFQUNlLEVBQUU7SUFDbkIsTUFBTSxtQkFBbUIsR0FDdkIsMEJBQTBCLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDNUQsTUFBTSxNQUFNLEdBQUcsTUFBTSxpQ0FBaUMsQ0FDcEQsbUJBQW1CLEVBQ25CLGlCQUFpQixDQUNsQixDQUFDO0lBQ0YsTUFBTSxnQkFBZ0IsR0FDcEIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsT0FBTyxDQUFDLDBCQUEwQixDQUFDO0lBQy9ELElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3RCLG9GQUFvRjtRQUNwRixNQUFNLElBQUksS0FBSyxDQUFDLHdEQUF3RCxDQUFDLENBQUM7SUFDNUUsQ0FBQztJQUVELE9BQU8sTUFBTSx1QkFBdUIsQ0FBQyxnQkFBZ0IsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0FBQzVFLENBQUMsQ0FBQztBQUVGLE1BQU0sdUJBQXVCLEdBQUcsS0FBSyxFQUNuQyxnQkFBd0IsRUFDeEIsaUJBRUUsRUFDZSxFQUFFO0lBQ25CLE1BQU0sYUFBYSxHQUFHLElBQUkscUJBQXFCLENBQzdDLGlCQUFpQixDQUFDLFdBQVcsRUFBRSxDQUNoQyxDQUFDO0lBQ0YsT0FBTyxNQUFNLGFBQWEsQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUNyRCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBCYWNrZW5kT3V0cHV0Q2xpZW50RmFjdG9yeSxcbiAgRGVwbG95ZWRCYWNrZW5kSWRlbnRpZmllcixcbn0gZnJvbSAnQGF3cy1hbXBsaWZ5L2RlcGxveWVkLWJhY2tlbmQtY2xpZW50JztcblxuaW1wb3J0IHsgZ3JhcGhxbE91dHB1dEtleSB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9iYWNrZW5kLW91dHB1dC1zY2hlbWFzJztcbmltcG9ydCB7IEFwcHN5bmNHcmFwaHFsR2VuZXJhdGlvblJlc3VsdCB9IGZyb20gJy4vYXBwc3luY19ncmFwaHFsX2dlbmVyYXRpb25fcmVzdWx0LmpzJztcbmltcG9ydCB7IFN0YWNrTWV0YWRhdGFHcmFwaHFsTW9kZWxzR2VuZXJhdG9yIH0gZnJvbSAnLi9ncmFwaHFsX21vZGVsc19nZW5lcmF0b3IuanMnO1xuaW1wb3J0IHsgR3JhcGhxbE1vZGVsc0dlbmVyYXRvciB9IGZyb20gJy4vbW9kZWxfZ2VuZXJhdG9yLmpzJztcbmltcG9ydCB7IFMzU3RyaW5nT2JqZWN0RmV0Y2hlciB9IGZyb20gJy4vczNfc3RyaW5nX29iamVjdF9mZXRjaGVyLmpzJztcbmltcG9ydCB7IEFXU0NsaWVudFByb3ZpZGVyIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsdWdpbi10eXBlcyc7XG5pbXBvcnQgeyBTM0NsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XG5pbXBvcnQgeyBBbXBsaWZ5Q2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWFtcGxpZnknO1xuaW1wb3J0IHsgQ2xvdWRGb3JtYXRpb25DbGllbnQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtY2xvdWRmb3JtYXRpb24nO1xuaW1wb3J0IHsgZ2V0QmFja2VuZE91dHB1dFdpdGhFcnJvckhhbmRsaW5nIH0gZnJvbSAnLi9nZXRfYmFja2VuZF9vdXRwdXRfd2l0aF9lcnJvcl9oYW5kbGluZy5qcyc7XG5cbmV4cG9ydCB0eXBlIEdyYXBocWxNb2RlbHNHZW5lcmF0b3JGYWN0b3J5UGFyYW1zID1cbiAgfCB7XG4gICAgICBiYWNrZW5kSWRlbnRpZmllcjogRGVwbG95ZWRCYWNrZW5kSWRlbnRpZmllcjtcbiAgICAgIGF3c0NsaWVudFByb3ZpZGVyOiBBV1NDbGllbnRQcm92aWRlcjx7XG4gICAgICAgIGdldFMzQ2xpZW50OiBTM0NsaWVudDtcbiAgICAgICAgZ2V0QW1wbGlmeUNsaWVudDogQW1wbGlmeUNsaWVudDtcbiAgICAgICAgZ2V0Q2xvdWRGb3JtYXRpb25DbGllbnQ6IENsb3VkRm9ybWF0aW9uQ2xpZW50O1xuICAgICAgfT47XG4gICAgfVxuICB8IHtcbiAgICAgIG1vZGVsU2NoZW1hUzNVcmk6IHN0cmluZztcbiAgICAgIGF3c0NsaWVudFByb3ZpZGVyOiBBV1NDbGllbnRQcm92aWRlcjx7XG4gICAgICAgIGdldFMzQ2xpZW50OiBTM0NsaWVudDtcbiAgICAgICAgZ2V0QW1wbGlmeUNsaWVudDogQW1wbGlmeUNsaWVudDtcbiAgICAgICAgZ2V0Q2xvdWRGb3JtYXRpb25DbGllbnQ6IENsb3VkRm9ybWF0aW9uQ2xpZW50O1xuICAgICAgfT47XG4gICAgfTtcblxuLyoqXG4gKiBGYWN0b3J5IGZ1bmN0aW9uIHRvIGNvbXBvc2UgYSBtb2RlbCBnZW5lcmF0b3IuXG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVHcmFwaHFsTW9kZWxzR2VuZXJhdG9yID0gKFxuICBwYXJhbXM6IEdyYXBocWxNb2RlbHNHZW5lcmF0b3JGYWN0b3J5UGFyYW1zLFxuKTogR3JhcGhxbE1vZGVsc0dlbmVyYXRvciA9PiB7XG4gIGlmICgnYmFja2VuZElkZW50aWZpZXInIGluIHBhcmFtcykge1xuICAgIHJldHVybiBjcmVhdGVHcmFwaHFsTW9kZWxzR2VuZXJhdG9yRnJvbUJhY2tlbmRJZGVudGlmaWVyKHBhcmFtcyk7XG4gIH1cbiAgcmV0dXJuIGNyZWF0ZUdyYXBocWxNb2RlbHNGcm9tUzNVcmlHZW5lcmF0b3IocGFyYW1zKTtcbn07XG5cbmV4cG9ydCB0eXBlIEdyYXBocWxNb2RlbHNGcm9tQmFja2VuZElkZW50aWZpZXJQYXJhbXMgPSB7XG4gIGJhY2tlbmRJZGVudGlmaWVyOiBEZXBsb3llZEJhY2tlbmRJZGVudGlmaWVyO1xuICBhd3NDbGllbnRQcm92aWRlcjogQVdTQ2xpZW50UHJvdmlkZXI8e1xuICAgIGdldFMzQ2xpZW50OiBTM0NsaWVudDtcbiAgICBnZXRBbXBsaWZ5Q2xpZW50OiBBbXBsaWZ5Q2xpZW50O1xuICAgIGdldENsb3VkRm9ybWF0aW9uQ2xpZW50OiBDbG91ZEZvcm1hdGlvbkNsaWVudDtcbiAgfT47XG59O1xuXG4vKipcbiAqIEZhY3RvcnkgZnVuY3Rpb24gdG8gY29tcG9zZSBhIG1vZGVsIGdlbmVyYXRvciBmcm9tIGEgYmFja2VuZCBpZGVudGlmaWVyLlxuICovXG5jb25zdCBjcmVhdGVHcmFwaHFsTW9kZWxzR2VuZXJhdG9yRnJvbUJhY2tlbmRJZGVudGlmaWVyID0gKHtcbiAgYmFja2VuZElkZW50aWZpZXIsXG4gIGF3c0NsaWVudFByb3ZpZGVyLFxufTogR3JhcGhxbE1vZGVsc0Zyb21CYWNrZW5kSWRlbnRpZmllclBhcmFtcyk6IEdyYXBocWxNb2RlbHNHZW5lcmF0b3IgPT4ge1xuICBpZiAoIWJhY2tlbmRJZGVudGlmaWVyKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhd3MtYW1wbGlmeS9hbXBsaWZ5LWJhY2tlbmQtcnVsZXMvcHJlZmVyLWFtcGxpZnktZXJyb3JzXG4gICAgdGhyb3cgbmV3IEVycm9yKCdgYmFja2VuZElkZW50aWZpZXJgIG11c3QgYmUgZGVmaW5lZCcpO1xuICB9XG4gIGlmICghYXdzQ2xpZW50UHJvdmlkZXIpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGF3cy1hbXBsaWZ5L2FtcGxpZnktYmFja2VuZC1ydWxlcy9wcmVmZXItYW1wbGlmeS1lcnJvcnNcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2Bhd3NDbGllbnRQcm92aWRlcmAgbXVzdCBiZSBkZWZpbmVkJyk7XG4gIH1cblxuICByZXR1cm4gbmV3IFN0YWNrTWV0YWRhdGFHcmFwaHFsTW9kZWxzR2VuZXJhdG9yKFxuICAgICgpID0+IGdldE1vZGVsU2NoZW1hKGJhY2tlbmRJZGVudGlmaWVyLCBhd3NDbGllbnRQcm92aWRlciksXG4gICAgKGZpbGVNYXApID0+IG5ldyBBcHBzeW5jR3JhcGhxbEdlbmVyYXRpb25SZXN1bHQoZmlsZU1hcCksXG4gICk7XG59O1xuXG5leHBvcnQgdHlwZSBHcmFwaHFsTW9kZWxzRnJvbVMzVXJpR2VuZXJhdG9yRmFjdG9yeVBhcmFtcyA9IHtcbiAgbW9kZWxTY2hlbWFTM1VyaTogc3RyaW5nO1xuICBhd3NDbGllbnRQcm92aWRlcjogQVdTQ2xpZW50UHJvdmlkZXI8e1xuICAgIGdldFMzQ2xpZW50OiBTM0NsaWVudDtcbiAgICBnZXRBbXBsaWZ5Q2xpZW50OiBBbXBsaWZ5Q2xpZW50O1xuICAgIGdldENsb3VkRm9ybWF0aW9uQ2xpZW50OiBDbG91ZEZvcm1hdGlvbkNsaWVudDtcbiAgfT47XG59O1xuXG4vKipcbiAqIEZhY3RvcnkgZnVuY3Rpb24gdG8gY29tcG9zZSBhIG1vZGVsIGdlbmVyYXRvciBmcm9tIGFuIHMzIHVyaS5cbiAqL1xuZXhwb3J0IGNvbnN0IGNyZWF0ZUdyYXBocWxNb2RlbHNGcm9tUzNVcmlHZW5lcmF0b3IgPSAoe1xuICBtb2RlbFNjaGVtYVMzVXJpLFxuICBhd3NDbGllbnRQcm92aWRlcixcbn06IEdyYXBocWxNb2RlbHNGcm9tUzNVcmlHZW5lcmF0b3JGYWN0b3J5UGFyYW1zKTogR3JhcGhxbE1vZGVsc0dlbmVyYXRvciA9PiB7XG4gIGlmICghbW9kZWxTY2hlbWFTM1VyaSkge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYXdzLWFtcGxpZnkvYW1wbGlmeS1iYWNrZW5kLXJ1bGVzL3ByZWZlci1hbXBsaWZ5LWVycm9yc1xuICAgIHRocm93IG5ldyBFcnJvcignYG1vZGVsU2NoZW1hUzNVcmlgIG11c3QgYmUgZGVmaW5lZCcpO1xuICB9XG4gIGlmICghYXdzQ2xpZW50UHJvdmlkZXIpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGF3cy1hbXBsaWZ5L2FtcGxpZnktYmFja2VuZC1ydWxlcy9wcmVmZXItYW1wbGlmeS1lcnJvcnNcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2Bhd3NDbGllbnRQcm92aWRlcmAgbXVzdCBiZSBkZWZpbmVkJyk7XG4gIH1cbiAgcmV0dXJuIG5ldyBTdGFja01ldGFkYXRhR3JhcGhxbE1vZGVsc0dlbmVyYXRvcihcbiAgICAoKSA9PiBnZXRNb2RlbFNjaGVtYUZyb21TM1VyaShtb2RlbFNjaGVtYVMzVXJpLCBhd3NDbGllbnRQcm92aWRlciksXG4gICAgKGZpbGVNYXApID0+IG5ldyBBcHBzeW5jR3JhcGhxbEdlbmVyYXRpb25SZXN1bHQoZmlsZU1hcCksXG4gICk7XG59O1xuXG5jb25zdCBnZXRNb2RlbFNjaGVtYSA9IGFzeW5jIChcbiAgYmFja2VuZElkZW50aWZpZXI6IERlcGxveWVkQmFja2VuZElkZW50aWZpZXIsXG4gIGF3c0NsaWVudFByb3ZpZGVyOiBBV1NDbGllbnRQcm92aWRlcjx7XG4gICAgZ2V0UzNDbGllbnQ6IFMzQ2xpZW50O1xuICAgIGdldEFtcGxpZnlDbGllbnQ6IEFtcGxpZnlDbGllbnQ7XG4gICAgZ2V0Q2xvdWRGb3JtYXRpb25DbGllbnQ6IENsb3VkRm9ybWF0aW9uQ2xpZW50O1xuICB9Pixcbik6IFByb21pc2U8c3RyaW5nPiA9PiB7XG4gIGNvbnN0IGJhY2tlbmRPdXRwdXRDbGllbnQgPVxuICAgIEJhY2tlbmRPdXRwdXRDbGllbnRGYWN0b3J5LmdldEluc3RhbmNlKGF3c0NsaWVudFByb3ZpZGVyKTtcbiAgY29uc3Qgb3V0cHV0ID0gYXdhaXQgZ2V0QmFja2VuZE91dHB1dFdpdGhFcnJvckhhbmRsaW5nKFxuICAgIGJhY2tlbmRPdXRwdXRDbGllbnQsXG4gICAgYmFja2VuZElkZW50aWZpZXIsXG4gICk7XG4gIGNvbnN0IG1vZGVsU2NoZW1hUzNVcmkgPVxuICAgIG91dHB1dFtncmFwaHFsT3V0cHV0S2V5XT8ucGF5bG9hZC5hbXBsaWZ5QXBpTW9kZWxTY2hlbWFTM1VyaTtcbiAgaWYgKCFtb2RlbFNjaGVtYVMzVXJpKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhd3MtYW1wbGlmeS9hbXBsaWZ5LWJhY2tlbmQtcnVsZXMvcHJlZmVyLWFtcGxpZnktZXJyb3JzXG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZmluZCBtb2RlbCBzY2hlbWEgYXQgYW1wbGlmeUFwaU1vZGVsU2NoZW1hUzNVcmlgKTtcbiAgfVxuXG4gIHJldHVybiBhd2FpdCBnZXRNb2RlbFNjaGVtYUZyb21TM1VyaShtb2RlbFNjaGVtYVMzVXJpLCBhd3NDbGllbnRQcm92aWRlcik7XG59O1xuXG5jb25zdCBnZXRNb2RlbFNjaGVtYUZyb21TM1VyaSA9IGFzeW5jIChcbiAgbW9kZWxTY2hlbWFTM1VyaTogc3RyaW5nLFxuICBhd3NDbGllbnRQcm92aWRlcjogQVdTQ2xpZW50UHJvdmlkZXI8e1xuICAgIGdldFMzQ2xpZW50OiBTM0NsaWVudDtcbiAgfT4sXG4pOiBQcm9taXNlPHN0cmluZz4gPT4ge1xuICBjb25zdCBzY2hlbWFGZXRjaGVyID0gbmV3IFMzU3RyaW5nT2JqZWN0RmV0Y2hlcihcbiAgICBhd3NDbGllbnRQcm92aWRlci5nZXRTM0NsaWVudCgpLFxuICApO1xuICByZXR1cm4gYXdhaXQgc2NoZW1hRmV0Y2hlci5mZXRjaChtb2RlbFNjaGVtYVMzVXJpKTtcbn07XG4iXX0=