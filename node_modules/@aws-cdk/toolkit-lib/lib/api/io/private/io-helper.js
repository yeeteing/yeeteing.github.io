"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.IoHelper = void 0;
exports.asIoHelper = asIoHelper;
const io_default_messages_1 = require("./io-default-messages");
const span_1 = require("./span");
/**
 * A class containing helper tools to interact with IoHost
 */
class IoHelper {
    static fromIoHost(ioHost, action) {
        return new IoHelper({
            notify: (msg) => ioHost.notify({
                ...msg,
                action: action,
            }),
            requestResponse: (msg) => ioHost.requestResponse({
                ...msg,
                action: action,
            }),
        });
    }
    static fromActionAwareIoHost(ioHost) {
        return new IoHelper(ioHost);
    }
    /**
     * Simplified access to emit default messages.
     */
    defaults;
    ioHost;
    constructor(ioHost) {
        this.ioHost = ioHost;
        this.defaults = new io_default_messages_1.IoDefaultMessages(this);
    }
    /**
     * Forward a message to the IoHost, while injection the current action
     */
    notify(msg) {
        return this.ioHost.notify(msg);
    }
    /**
     * Forward a request to the IoHost, while injection the current action
     */
    requestResponse(msg) {
        return this.ioHost.requestResponse(msg);
    }
    /**
     * Create a new marker from a given registry entry
     */
    span(definition) {
        return new span_1.SpanMaker(this, definition, (ioHost) => IoHelper.fromActionAwareIoHost(ioHost));
    }
}
exports.IoHelper = IoHelper;
/**
 * Wraps an IoHost and creates an IoHelper from it
 */
function asIoHelper(ioHost, action) {
    return IoHelper.fromIoHost(ioHost, action);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW8taGVscGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaW8taGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQW9FQSxnQ0FFQztBQW5FRCwrREFBMEQ7QUFFMUQsaUNBQW1DO0FBS25DOztHQUVHO0FBQ0gsTUFBYSxRQUFRO0lBQ1osTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFlLEVBQUUsTUFBcUI7UUFDN0QsT0FBTyxJQUFJLFFBQVEsQ0FBQztZQUNsQixNQUFNLEVBQUUsQ0FBQyxHQUF1QixFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO2dCQUNqRCxHQUFHLEdBQUc7Z0JBQ04sTUFBTSxFQUFFLE1BQU07YUFDZixDQUFDO1lBQ0YsZUFBZSxFQUFFLENBQUksR0FBMEIsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQztnQkFDekUsR0FBRyxHQUFHO2dCQUNOLE1BQU0sRUFBRSxNQUFNO2FBQ2YsQ0FBQztTQUNILENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTSxNQUFNLENBQUMscUJBQXFCLENBQUMsTUFBMEI7UUFDNUQsT0FBTyxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQ7O09BRUc7SUFDYSxRQUFRLENBQW9CO0lBRTNCLE1BQU0sQ0FBcUI7SUFFNUMsWUFBb0IsTUFBMEI7UUFDNUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLHVDQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU0sQ0FBQyxHQUErQjtRQUMzQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRDs7T0FFRztJQUNJLGVBQWUsQ0FBSSxHQUFrQztRQUMxRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFRDs7T0FFRztJQUNJLElBQUksQ0FBc0MsVUFBZ0M7UUFDL0UsT0FBTyxJQUFJLGdCQUFTLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDN0YsQ0FBQztDQUNGO0FBbERELDRCQWtEQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsVUFBVSxDQUFDLE1BQWUsRUFBRSxNQUFxQjtJQUMvRCxPQUFPLFFBQVEsQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQzdDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IElBY3Rpb25Bd2FyZUlvSG9zdCwgSUlvSG9zdCB9IGZyb20gJy4uL2lvLWhvc3QnO1xuaW1wb3J0IHR5cGUgeyBJb01lc3NhZ2UsIElvUmVxdWVzdCB9IGZyb20gJy4uL2lvLW1lc3NhZ2UnO1xuaW1wb3J0IHR5cGUgeyBUb29sa2l0QWN0aW9uIH0gZnJvbSAnLi4vdG9vbGtpdC1hY3Rpb24nO1xuaW1wb3J0IHsgSW9EZWZhdWx0TWVzc2FnZXMgfSBmcm9tICcuL2lvLWRlZmF1bHQtbWVzc2FnZXMnO1xuaW1wb3J0IHR5cGUgeyBTcGFuRW5kLCBTcGFuRGVmaW5pdGlvbiB9IGZyb20gJy4vc3Bhbic7XG5pbXBvcnQgeyBTcGFuTWFrZXIgfSBmcm9tICcuL3NwYW4nO1xuXG5leHBvcnQgdHlwZSBBY3Rpb25MZXNzTWVzc2FnZTxUPiA9IE9taXQ8SW9NZXNzYWdlPFQ+LCAnYWN0aW9uJz47XG5leHBvcnQgdHlwZSBBY3Rpb25MZXNzUmVxdWVzdDxULCBVPiA9IE9taXQ8SW9SZXF1ZXN0PFQsIFU+LCAnYWN0aW9uJz47XG5cbi8qKlxuICogQSBjbGFzcyBjb250YWluaW5nIGhlbHBlciB0b29scyB0byBpbnRlcmFjdCB3aXRoIElvSG9zdFxuICovXG5leHBvcnQgY2xhc3MgSW9IZWxwZXIgaW1wbGVtZW50cyBJSW9Ib3N0LCBJQWN0aW9uQXdhcmVJb0hvc3Qge1xuICBwdWJsaWMgc3RhdGljIGZyb21Jb0hvc3QoaW9Ib3N0OiBJSW9Ib3N0LCBhY3Rpb246IFRvb2xraXRBY3Rpb24pIHtcbiAgICByZXR1cm4gbmV3IElvSGVscGVyKHtcbiAgICAgIG5vdGlmeTogKG1zZzogSW9NZXNzYWdlPHVua25vd24+KSA9PiBpb0hvc3Qubm90aWZ5KHtcbiAgICAgICAgLi4ubXNnLFxuICAgICAgICBhY3Rpb246IGFjdGlvbixcbiAgICAgIH0pLFxuICAgICAgcmVxdWVzdFJlc3BvbnNlOiA8VD4obXNnOiBJb1JlcXVlc3Q8dW5rbm93biwgVD4pID0+IGlvSG9zdC5yZXF1ZXN0UmVzcG9uc2Uoe1xuICAgICAgICAuLi5tc2csXG4gICAgICAgIGFjdGlvbjogYWN0aW9uLFxuICAgICAgfSksXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGZyb21BY3Rpb25Bd2FyZUlvSG9zdChpb0hvc3Q6IElBY3Rpb25Bd2FyZUlvSG9zdCkge1xuICAgIHJldHVybiBuZXcgSW9IZWxwZXIoaW9Ib3N0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaW1wbGlmaWVkIGFjY2VzcyB0byBlbWl0IGRlZmF1bHQgbWVzc2FnZXMuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGVmYXVsdHM6IElvRGVmYXVsdE1lc3NhZ2VzO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgaW9Ib3N0OiBJQWN0aW9uQXdhcmVJb0hvc3Q7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3Rvcihpb0hvc3Q6IElBY3Rpb25Bd2FyZUlvSG9zdCkge1xuICAgIHRoaXMuaW9Ib3N0ID0gaW9Ib3N0O1xuICAgIHRoaXMuZGVmYXVsdHMgPSBuZXcgSW9EZWZhdWx0TWVzc2FnZXModGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogRm9yd2FyZCBhIG1lc3NhZ2UgdG8gdGhlIElvSG9zdCwgd2hpbGUgaW5qZWN0aW9uIHRoZSBjdXJyZW50IGFjdGlvblxuICAgKi9cbiAgcHVibGljIG5vdGlmeShtc2c6IEFjdGlvbkxlc3NNZXNzYWdlPHVua25vd24+KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuaW9Ib3N0Lm5vdGlmeShtc2cpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcndhcmQgYSByZXF1ZXN0IHRvIHRoZSBJb0hvc3QsIHdoaWxlIGluamVjdGlvbiB0aGUgY3VycmVudCBhY3Rpb25cbiAgICovXG4gIHB1YmxpYyByZXF1ZXN0UmVzcG9uc2U8VD4obXNnOiBBY3Rpb25MZXNzUmVxdWVzdDx1bmtub3duLCBUPik6IFByb21pc2U8VD4ge1xuICAgIHJldHVybiB0aGlzLmlvSG9zdC5yZXF1ZXN0UmVzcG9uc2UobXNnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgbWFya2VyIGZyb20gYSBnaXZlbiByZWdpc3RyeSBlbnRyeVxuICAgKi9cbiAgcHVibGljIHNwYW48UyBleHRlbmRzIG9iamVjdCwgRSBleHRlbmRzIFNwYW5FbmQ+KGRlZmluaXRpb246IFNwYW5EZWZpbml0aW9uPFMsIEU+KSB7XG4gICAgcmV0dXJuIG5ldyBTcGFuTWFrZXIodGhpcywgZGVmaW5pdGlvbiwgKGlvSG9zdCkgPT4gSW9IZWxwZXIuZnJvbUFjdGlvbkF3YXJlSW9Ib3N0KGlvSG9zdCkpO1xuICB9XG59XG5cbi8qKlxuICogV3JhcHMgYW4gSW9Ib3N0IGFuZCBjcmVhdGVzIGFuIElvSGVscGVyIGZyb20gaXRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFzSW9IZWxwZXIoaW9Ib3N0OiBJSW9Ib3N0LCBhY3Rpb246IFRvb2xraXRBY3Rpb24pOiBJb0hlbHBlciB7XG4gIHJldHVybiBJb0hlbHBlci5mcm9tSW9Ib3N0KGlvSG9zdCwgYWN0aW9uKTtcbn1cbiJdfQ==