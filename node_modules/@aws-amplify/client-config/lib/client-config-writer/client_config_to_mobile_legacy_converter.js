/**
 * Converts client config to a different shapes needed by mobile libraries for Gen1 format.
 */
export class ClientConfigMobileConverter {
    packageName;
    packageVersion;
    /**
     * Creates client config converter
     */
    constructor(packageName, packageVersion) {
        this.packageName = packageName;
        this.packageVersion = packageVersion;
    }
    /**
     * Converts client config to a shape consumable by mobile libraries.
     */
    convertToMobileConfig = (clientConfig) => {
        const userAgent = `${this.packageName}/${this.packageVersion}`;
        const mobileConfig = {
            UserAgent: userAgent,
            Version: '1.0',
        };
        if (clientConfig.aws_user_pools_id) {
            const authConfig = {
                plugins: {
                    awsCognitoAuthPlugin: {
                        UserAgent: userAgent,
                        Version: '1.0',
                        CognitoUserPool: {
                            Default: {
                                PoolId: clientConfig.aws_user_pools_id,
                                AppClientId: clientConfig.aws_user_pools_web_client_id,
                                Region: clientConfig.aws_cognito_region,
                            },
                        },
                        CredentialsProvider: {
                            CognitoIdentity: {
                                Default: {
                                    PoolId: clientConfig.aws_cognito_identity_pool_id,
                                    Region: clientConfig.aws_cognito_region,
                                },
                            },
                        },
                        Auth: {
                            Default: {
                                authenticationFlowType: 'USER_SRP_AUTH',
                                mfaConfiguration: clientConfig.aws_cognito_mfa_configuration,
                                mfaTypes: clientConfig.aws_cognito_mfa_types,
                                passwordProtectionSettings: {
                                    passwordPolicyMinLength: clientConfig.aws_cognito_password_protection_settings
                                        ?.passwordPolicyMinLength,
                                    passwordPolicyCharacters: clientConfig.aws_cognito_password_protection_settings
                                        ?.passwordPolicyCharacters ?? [],
                                },
                                signupAttributes: clientConfig.aws_cognito_signup_attributes ?? [],
                                usernameAttributes: clientConfig.aws_cognito_username_attributes ?? [],
                                verificationMechanisms: clientConfig.aws_cognito_verification_mechanisms ?? [],
                                socialProviders: clientConfig.aws_cognito_social_providers ?? [],
                            },
                        },
                    },
                },
            };
            if (clientConfig.oauth) {
                authConfig.plugins.awsCognitoAuthPlugin.Auth.Default.OAuth = {
                    WebDomain: clientConfig.oauth.domain,
                    Scopes: clientConfig.oauth.scope,
                    SignInRedirectURI: clientConfig.oauth.redirectSignIn,
                    SignOutRedirectURI: clientConfig.oauth.redirectSignOut,
                    AppClientId: clientConfig.oauth.clientId ||
                        clientConfig.aws_user_pools_web_client_id,
                };
            }
            mobileConfig.auth = authConfig;
        }
        if (clientConfig.aws_appsync_graphqlEndpoint) {
            const apiConfig = {
                plugins: {
                    awsAPIPlugin: {
                        data: {
                            endpointType: 'GraphQL',
                            endpoint: clientConfig.aws_appsync_graphqlEndpoint,
                            region: clientConfig.aws_appsync_region,
                            authorizationType: clientConfig.aws_appsync_authenticationType,
                            apiKey: clientConfig.aws_appsync_apiKey,
                        },
                    },
                },
            };
            mobileConfig.api = apiConfig;
            if (mobileConfig.auth) {
                let defaultClientDatabasePrefix = undefined;
                if (clientConfig.aws_appsync_authenticationType) {
                    defaultClientDatabasePrefix = `data_${clientConfig.aws_appsync_authenticationType}`;
                }
                mobileConfig.auth.plugins.awsCognitoAuthPlugin.AppSync = {
                    Default: {
                        ApiUrl: clientConfig.aws_appsync_graphqlEndpoint,
                        Region: clientConfig.aws_appsync_region,
                        AuthMode: clientConfig.aws_appsync_authenticationType,
                        ApiKey: clientConfig.aws_appsync_apiKey,
                        ClientDatabasePrefix: defaultClientDatabasePrefix,
                    },
                };
                if (clientConfig.aws_appsync_additionalAuthenticationTypes) {
                    for (const additionalAuthenticationType of clientConfig.aws_appsync_additionalAuthenticationTypes.split(',')) {
                        mobileConfig.auth.plugins.awsCognitoAuthPlugin.AppSync[`data_${additionalAuthenticationType}`] = {
                            ApiUrl: clientConfig.aws_appsync_graphqlEndpoint,
                            Region: clientConfig.aws_appsync_region,
                            AuthMode: additionalAuthenticationType,
                            ApiKey: clientConfig.aws_appsync_apiKey,
                            ClientDatabasePrefix: `data_${additionalAuthenticationType}`,
                        };
                    }
                }
            }
        }
        if (clientConfig.geo) {
            const geoConfig = {
                plugins: {
                    awsLocationGeoPlugin: {
                        region: clientConfig.geo.amazon_location_service.region,
                    },
                },
            };
            const maps = clientConfig.geo.amazon_location_service.maps;
            if (maps) {
                geoConfig.plugins.awsLocationGeoPlugin.maps = maps;
            }
            const searchIndices = clientConfig.geo.amazon_location_service.search_indices;
            if (searchIndices) {
                geoConfig.plugins.awsLocationGeoPlugin.searchIndices = searchIndices;
            }
            mobileConfig.geo = geoConfig;
        }
        if (clientConfig.Analytics) {
            mobileConfig.analytics = {
                plugins: {
                    awsPinpointAnalyticsPlugin: {
                        pinpointAnalytics: {
                            region: clientConfig.Analytics.Pinpoint.region,
                            appId: clientConfig.Analytics.Pinpoint.appId,
                        },
                        pinpointTargeting: {
                            region: clientConfig.Analytics.Pinpoint.region,
                        },
                    },
                },
            };
        }
        if (clientConfig.Notifications) {
            mobileConfig.notifications = {
                plugins: {},
            };
            if (clientConfig.Notifications.SMS) {
                mobileConfig.notifications.plugins.awsPinpointSmsNotificationsPlugin =
                    clientConfig.Notifications.SMS.AWSPinpoint;
            }
            if (clientConfig.Notifications.EMAIL) {
                mobileConfig.notifications.plugins.awsPinpointEmailNotificationsPlugin =
                    clientConfig.Notifications.EMAIL.AWSPinpoint;
            }
            if (clientConfig.Notifications.InAppMessaging) {
                mobileConfig.notifications.plugins.awsPinpointInAppMessagingNotificationsPlugin =
                    clientConfig.Notifications.InAppMessaging.AWSPinpoint;
            }
            if (clientConfig.Notifications.Push) {
                mobileConfig.notifications.plugins.awsPinpointPushNotificationsPlugin =
                    clientConfig.Notifications.Push.AWSPinpoint;
            }
        }
        if (clientConfig.aws_user_files_s3_bucket) {
            mobileConfig.storage = {
                plugins: {
                    awsS3StoragePlugin: {
                        bucket: clientConfig.aws_user_files_s3_bucket,
                        region: clientConfig.aws_user_files_s3_bucket_region,
                    },
                },
            };
        }
        return mobileConfig;
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpZW50X2NvbmZpZ190b19tb2JpbGVfbGVnYWN5X2NvbnZlcnRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGllbnQtY29uZmlnLXdyaXRlci9jbGllbnRfY29uZmlnX3RvX21vYmlsZV9sZWdhY3lfY29udmVydGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVFBOztHQUVHO0FBQ0gsTUFBTSxPQUFPLDJCQUEyQjtJQUtuQjtJQUNBO0lBTG5COztPQUVHO0lBQ0gsWUFDbUIsV0FBbUIsRUFDbkIsY0FBc0I7UUFEdEIsZ0JBQVcsR0FBWCxXQUFXLENBQVE7UUFDbkIsbUJBQWMsR0FBZCxjQUFjLENBQVE7SUFDdEMsQ0FBQztJQUNKOztPQUVHO0lBQ0gscUJBQXFCLEdBQUcsQ0FDdEIsWUFBZ0MsRUFDWixFQUFFO1FBQ3RCLE1BQU0sU0FBUyxHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFL0QsTUFBTSxZQUFZLEdBQXVCO1lBQ3ZDLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLE9BQU8sRUFBRSxLQUFLO1NBQ2YsQ0FBQztRQUNGLElBQUksWUFBWSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDbkMsTUFBTSxVQUFVLEdBQTJCO2dCQUN6QyxPQUFPLEVBQUU7b0JBQ1Asb0JBQW9CLEVBQUU7d0JBQ3BCLFNBQVMsRUFBRSxTQUFTO3dCQUNwQixPQUFPLEVBQUUsS0FBSzt3QkFDZCxlQUFlLEVBQUU7NEJBQ2YsT0FBTyxFQUFFO2dDQUNQLE1BQU0sRUFBRSxZQUFZLENBQUMsaUJBQWlCO2dDQUN0QyxXQUFXLEVBQUUsWUFBWSxDQUFDLDRCQUE0QjtnQ0FDdEQsTUFBTSxFQUFFLFlBQVksQ0FBQyxrQkFBa0I7NkJBQ3hDO3lCQUNGO3dCQUNELG1CQUFtQixFQUFFOzRCQUNuQixlQUFlLEVBQUU7Z0NBQ2YsT0FBTyxFQUFFO29DQUNQLE1BQU0sRUFBRSxZQUFZLENBQUMs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QyxhQUFhLENBQUMsT0FBTyxDQUFDLGtDQUFrQztvQkFDbkUsWUFBWSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1lBQ2hELENBQUM7UUFDSCxDQUFDO1FBRUQsSUFBSSxZQUFZLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztZQUMxQyxZQUFZLENBQUMsT0FBTyxHQUFHO2dCQUNyQixPQUFPLEVBQUU7b0JBQ1Asa0JBQWtCLEVBQUU7d0JBQ2xCLE1BQU0sRUFBRSxZQUFZLENBQUMsd0JBQXdCO3dCQUM3QyxNQUFNLEVBQUUsWUFBWSxDQUFDLCtCQUErQjtxQkFDckQ7aUJBQ0Y7YUFDRixDQUFDO1FBQ0osQ0FBQztRQUVELE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUMsQ0FBQztDQUNIIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xpZW50Q29uZmlnTGVnYWN5IH0gZnJvbSAnLi4vY2xpZW50LWNvbmZpZy10eXBlcy9jbGllbnRfY29uZmlnLmpzJztcbmltcG9ydCB7XG4gIENsaWVudENvbmZpZ01vYmlsZSxcbiAgQ2xpZW50Q29uZmlnTW9iaWxlQXBpLFxuICBDbGllbnRDb25maWdNb2JpbGVBdXRoLFxuICBDbGllbnRDb25maWdNb2JpbGVHZW8sXG59IGZyb20gJy4uL2NsaWVudC1jb25maWctdHlwZXMvbW9iaWxlL2NsaWVudF9jb25maWdfbW9iaWxlX3R5cGVzLmpzJztcblxuLyoqXG4gKiBDb252ZXJ0cyBjbGllbnQgY29uZmlnIHRvIGEgZGlmZmVyZW50IHNoYXBlcyBuZWVkZWQgYnkgbW9iaWxlIGxpYnJhcmllcyBmb3IgR2VuMSBmb3JtYXQuXG4gKi9cbmV4cG9ydCBjbGFzcyBDbGllbnRDb25maWdNb2JpbGVDb252ZXJ0ZXIge1xuICAvKipcbiAgICogQ3JlYXRlcyBjbGllbnQgY29uZmlnIGNvbnZlcnRlclxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBwYWNrYWdlTmFtZTogc3RyaW5nLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcGFja2FnZVZlcnNpb246IHN0cmluZyxcbiAgKSB7fVxuICAvKipcbiAgICogQ29udmVydHMgY2xpZW50IGNvbmZpZyB0byBhIHNoYXBlIGNvbnN1bWFibGUgYnkgbW9iaWxlIGxpYnJhcmllcy5cbiAgICovXG4gIGNvbnZlcnRUb01vYmlsZUNvbmZpZyA9IChcbiAgICBjbGllbnRDb25maWc6IENsaWVudENvbmZpZ0xlZ2FjeSxcbiAgKTogQ2xpZW50Q29uZmlnTW9iaWxlID0+IHtcbiAgICBjb25zdCB1c2VyQWdlbnQgPSBgJHt0aGlzLnBhY2thZ2VOYW1lfS8ke3RoaXMucGFja2FnZVZlcnNpb259YDtcblxuICAgIGNvbnN0IG1vYmlsZUNvbmZpZzogQ2xpZW50Q29uZmlnTW9iaWxlID0ge1xuICAgICAgVXNlckFnZW50OiB1c2VyQWdlbnQsXG4gICAgICBWZXJzaW9uOiAnMS4wJyxcbiAgICB9O1xuICAgIGlmIChjbGllbnRDb25maWcuYXdzX3VzZXJfcG9vbHNfaWQpIHtcbiAgICAgIGNvbnN0IGF1dGhDb25maWc6IENsaWVudENvbmZpZ01vYmlsZUF1dGggPSB7XG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICBhd3NDb2duaXRvQXV0aFBsdWdpbjoge1xuICAgICAgICAgICAgVXNlckFnZW50OiB1c2VyQWdlbnQsXG4gICAgICAgICAgICBWZXJzaW9uOiAnMS4wJyxcbiAgICAgICAgICAgIENvZ25pdG9Vc2VyUG9vbDoge1xuICAgICAgICAgICAgICBEZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgUG9vbElkOiBjbGllbnRDb25maWcuYXdzX3VzZXJfcG9vbHNfaWQsXG4gICAgICAgICAgICAgICAgQXBwQ2xpZW50SWQ6IGNsaWVudENvbmZpZy5hd3NfdXNlcl9wb29sc193ZWJfY2xpZW50X2lkLFxuICAgICAgICAgICAgICAgIFJlZ2lvbjogY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX3JlZ2lvbixcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBDcmVkZW50aWFsc1Byb3ZpZGVyOiB7XG4gICAgICAgICAgICAgIENvZ25pdG9JZGVudGl0eToge1xuICAgICAgICAgICAgICAgIERlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICAgIFBvb2xJZDogY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX2lkZW50aXR5X3Bvb2xfaWQsXG4gICAgICAgICAgICAgICAgICBSZWdpb246IGNsaWVudENvbmZpZy5hd3NfY29nbml0b19yZWdpb24sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBBdXRoOiB7XG4gICAgICAgICAgICAgIERlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICBhdXRoZW50aWNhdGlvbkZsb3dUeXBlOiAnVVNFUl9TUlBfQVVUSCcsXG4gICAgICAgICAgICAgICAgbWZhQ29uZmlndXJhdGlvbjogY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX21mYV9jb25maWd1cmF0aW9uLFxuICAgICAgICAgICAgICAgIG1mYVR5cGVzOiBjbGllbnRDb25maWcuYXdzX2NvZ25pdG9fbWZhX3R5cGVzLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkUHJvdGVjdGlvblNldHRpbmdzOiB7XG4gICAgICAgICAgICAgICAgICBwYXNzd29yZFBvbGljeU1pbkxlbmd0aDpcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX3Bhc3N3b3JkX3Byb3RlY3Rpb25fc2V0dGluZ3NcbiAgICAgICAgICAgICAgICAgICAgICA/LnBhc3N3b3JkUG9saWN5TWluTGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgcGFzc3dvcmRQb2xpY3lDaGFyYWN0ZXJzOlxuICAgICAgICAgICAgICAgICAgICBjbGllbnRDb25maWcuYXdzX2NvZ25pdG9fcGFzc3dvcmRfcHJvdGVjdGlvbl9zZXR0aW5nc1xuICAgICAgICAgICAgICAgICAgICAgID8ucGFzc3dvcmRQb2xpY3lDaGFyYWN0ZXJzID8/IFtdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2lnbnVwQXR0cmlidXRlczpcbiAgICAgICAgICAgICAgICAgIGNsaWVudENvbmZpZy5hd3NfY29nbml0b19zaWdudXBfYXR0cmlidXRlcyA/PyBbXSxcbiAgICAgICAgICAgICAgICB1c2VybmFtZUF0dHJpYnV0ZXM6XG4gICAgICAgICAgICAgICAgICBjbGllbnRDb25maWcuYXdzX2NvZ25pdG9fdXNlcm5hbWVfYXR0cmlidXRlcyA/PyBbXSxcbiAgICAgICAgICAgICAgICB2ZXJpZmljYXRpb25NZWNoYW5pc21zOlxuICAgICAgICAgICAgICAgICAgY2xpZW50Q29uZmlnLmF3c19jb2duaXRvX3ZlcmlmaWNhdGlvbl9tZWNoYW5pc21zID8/IFtdLFxuICAgICAgICAgICAgICAgIHNvY2lhbFByb3ZpZGVyczpcbiAgICAgICAgICAgICAgICAgIGNsaWVudENvbmZpZy5hd3NfY29nbml0b19zb2NpYWxfcHJvdmlkZXJzID8/IFtdLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIGlmIChjbGllbnRDb25maWcub2F1dGgpIHtcbiAgICAgICAgYXV0aENvbmZpZy5wbHVnaW5zLmF3c0NvZ25pdG9BdXRoUGx1Z2luLkF1dGguRGVmYXVsdC5PQXV0aCA9IHtcbiAgICAgICAgICBXZWJEb21haW46IGNsaWVudENvbmZpZy5vYXV0aC5kb21haW4sXG4gICAgICAgICAgU2NvcGVzOiBjbGllbnRDb25maWcub2F1dGguc2NvcGUsXG4gICAgICAgICAgU2lnbkluUmVkaXJlY3RVUkk6IGNsaWVudENvbmZpZy5vYXV0aC5yZWRpcmVjdFNpZ25JbixcbiAgICAgICAgICBTaWduT3V0UmVkaXJlY3RVUkk6IGNsaWVudENvbmZpZy5vYXV0aC5yZWRpcmVjdFNpZ25PdXQsXG4gICAgICAgICAgQXBwQ2xpZW50SWQ6XG4gICAgICAgICAgICBjbGllbnRDb25maWcub2F1dGguY2xpZW50SWQgfHxcbiAgICAgICAgICAgIGNsaWVudENvbmZpZy5hd3NfdXNlcl9wb29sc193ZWJfY2xpZW50X2lkLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgbW9iaWxlQ29uZmlnLmF1dGggPSBhdXRoQ29uZmlnO1xuICAgIH1cblxuICAgIGlmIChjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfZ3JhcGhxbEVuZHBvaW50KSB7XG4gICAgICBjb25zdCBhcGlDb25maWc6IENsaWVudENvbmZpZ01vYmlsZUFwaSA9IHtcbiAgICAgICAgcGx1Z2luczoge1xuICAgICAgICAgIGF3c0FQSVBsdWdpbjoge1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBlbmRwb2ludFR5cGU6ICdHcmFwaFFMJyxcbiAgICAgICAgICAgICAgZW5kcG9pbnQ6IGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19ncmFwaHFsRW5kcG9pbnQsXG4gICAgICAgICAgICAgIHJlZ2lvbjogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX3JlZ2lvbixcbiAgICAgICAgICAgICAgYXV0aG9yaXphdGlvblR5cGU6IGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19hdXRoZW50aWNhdGlvblR5cGUsXG4gICAgICAgICAgICAgIGFwaUtleTogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2FwaUtleSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBtb2JpbGVDb25maWcuYXBpID0gYXBpQ29uZmlnO1xuXG4gICAgICBpZiAobW9iaWxlQ29uZmlnLmF1dGgpIHtcbiAgICAgICAgbGV0IGRlZmF1bHRDbGllbnREYXRhYmFzZVByZWZpeCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19hdXRoZW50aWNhdGlvblR5cGUpIHtcbiAgICAgICAgICBkZWZhdWx0Q2xpZW50RGF0YWJhc2VQcmVmaXggPSBgZGF0YV8ke2NsaWVudENvbmZpZy5hd3NfYXBwc3luY19hdXRoZW50aWNhdGlvblR5cGV9YDtcbiAgICAgICAgfVxuICAgICAgICBtb2JpbGVDb25maWcuYXV0aC5wbHVnaW5zLmF3c0NvZ25pdG9BdXRoUGx1Z2luLkFwcFN5bmMgPSB7XG4gICAgICAgICAgRGVmYXVsdDoge1xuICAgICAgICAgICAgQXBpVXJsOiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfZ3JhcGhxbEVuZHBvaW50LFxuICAgICAgICAgICAgUmVnaW9uOiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfcmVnaW9uLFxuICAgICAgICAgICAgQXV0aE1vZGU6IGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19hdXRoZW50aWNhdGlvblR5cGUsXG4gICAgICAgICAgICBBcGlLZXk6IGNsaWVudENvbmZpZy5hd3NfYXBwc3luY19hcGlLZXksXG4gICAgICAgICAgICBDbGllbnREYXRhYmFzZVByZWZpeDogZGVmYXVsdENsaWVudERhdGFiYXNlUHJlZml4LFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICAgIGlmIChjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfYWRkaXRpb25hbEF1dGhlbnRpY2F0aW9uVHlwZXMpIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGFkZGl0aW9uYWxBdXRoZW50aWNhdGlvblR5cGUgb2YgY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2FkZGl0aW9uYWxBdXRoZW50aWNhdGlvblR5cGVzLnNwbGl0KFxuICAgICAgICAgICAgJywnLFxuICAgICAgICAgICkpIHtcbiAgICAgICAgICAgIG1vYmlsZUNvbmZpZy5hdXRoLnBsdWdpbnMuYXdzQ29nbml0b0F1dGhQbHVnaW4uQXBwU3luY1tcbiAgICAgICAgICAgICAgYGRhdGFfJHthZGRpdGlvbmFsQXV0aGVudGljYXRpb25UeXBlfWBcbiAgICAgICAgICAgIF0gPSB7XG4gICAgICAgICAgICAgIEFwaVVybDogY2xpZW50Q29uZmlnLmF3c19hcHBzeW5jX2dyYXBocWxFbmRwb2ludCxcbiAgICAgICAgICAgICAgUmVnaW9uOiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfcmVnaW9uLFxuICAgICAgICAgICAgICBBdXRoTW9kZTogYWRkaXRpb25hbEF1dGhlbnRpY2F0aW9uVHlwZSxcbiAgICAgICAgICAgICAgQXBpS2V5OiBjbGllbnRDb25maWcuYXdzX2FwcHN5bmNfYXBpS2V5LFxuICAgICAgICAgICAgICBDbGllbnREYXRhYmFzZVByZWZpeDogYGRhdGFfJHthZGRpdGlvbmFsQXV0aGVudGljYXRpb25UeXBlfWAsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjbGllbnRDb25maWcuZ2VvKSB7XG4gICAgICBjb25zdCBnZW9Db25maWc6IENsaWVudENvbmZpZ01vYmlsZUdlbyA9IHtcbiAgICAgICAgcGx1Z2luczoge1xuICAgICAgICAgIGF3c0xvY2F0aW9uR2VvUGx1Z2luOiB7XG4gICAgICAgICAgICByZWdpb246IGNsaWVudENvbmZpZy5nZW8uYW1hem9uX2xvY2F0aW9uX3NlcnZpY2UucmVnaW9uLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtYXBzID0gY2xpZW50Q29uZmlnLmdlby5hbWF6b25fbG9jYXRpb25fc2VydmljZS5tYXBzO1xuICAgICAgaWYgKG1hcHMpIHtcbiAgICAgICAgZ2VvQ29uZmlnLnBsdWdpbnMuYXdzTG9jYXRpb25HZW9QbHVnaW4ubWFwcyA9IG1hcHM7XG4gICAgICB9XG4gICAgICBjb25zdCBzZWFyY2hJbmRpY2VzID1cbiAgICAgICAgY2xpZW50Q29uZmlnLmdlby5hbWF6b25fbG9jYXRpb25fc2VydmljZS5zZWFyY2hfaW5kaWNlcztcbiAgICAgIGlmIChzZWFyY2hJbmRpY2VzKSB7XG4gICAgICAgIGdlb0NvbmZpZy5wbHVnaW5zLmF3c0xvY2F0aW9uR2VvUGx1Z2luLnNlYXJjaEluZGljZXMgPSBzZWFyY2hJbmRpY2VzO1xuICAgICAgfVxuXG4gICAgICBtb2JpbGVDb25maWcuZ2VvID0gZ2VvQ29uZmlnO1xuICAgIH1cblxuICAgIGlmIChjbGllbnRDb25maWcuQW5hbHl0aWNzKSB7XG4gICAgICBtb2JpbGVDb25maWcuYW5hbHl0aWNzID0ge1xuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgYXdzUGlucG9pbnRBbmFseXRpY3NQbHVnaW46IHtcbiAgICAgICAgICAgIHBpbnBvaW50QW5hbHl0aWNzOiB7XG4gICAgICAgICAgICAgIHJlZ2lvbjogY2xpZW50Q29uZmlnLkFuYWx5dGljcy5QaW5wb2ludC5yZWdpb24sXG4gICAgICAgICAgICAgIGFwcElkOiBjbGllbnRDb25maWcuQW5hbHl0aWNzLlBpbnBvaW50LmFwcElkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBpbnBvaW50VGFyZ2V0aW5nOiB7XG4gICAgICAgICAgICAgIHJlZ2lvbjogY2xpZW50Q29uZmlnLkFuYWx5dGljcy5QaW5wb2ludC5yZWdpb24sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucykge1xuICAgICAgbW9iaWxlQ29uZmlnLm5vdGlmaWNhdGlvbnMgPSB7XG4gICAgICAgIHBsdWdpbnM6IHt9LFxuICAgICAgfTtcbiAgICAgIGlmIChjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5TTVMpIHtcbiAgICAgICAgbW9iaWxlQ29uZmlnLm5vdGlmaWNhdGlvbnMucGx1Z2lucy5hd3NQaW5wb2ludFNtc05vdGlmaWNhdGlvbnNQbHVnaW4gPVxuICAgICAgICAgIGNsaWVudENvbmZpZy5Ob3RpZmljYXRpb25zLlNNUy5BV1NQaW5wb2ludDtcbiAgICAgIH1cbiAgICAgIGlmIChjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5FTUFJTCkge1xuICAgICAgICBtb2JpbGVDb25maWcubm90aWZpY2F0aW9ucy5wbHVnaW5zLmF3c1BpbnBvaW50RW1haWxOb3RpZmljYXRpb25zUGx1Z2luID1cbiAgICAgICAgICBjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5FTUFJTC5BV1NQaW5wb2ludDtcbiAgICAgIH1cbiAgICAgIGlmIChjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5JbkFwcE1lc3NhZ2luZykge1xuICAgICAgICBtb2JpbGVDb25maWcubm90aWZpY2F0aW9ucy5wbHVnaW5zLmF3c1BpbnBvaW50SW5BcHBNZXNzYWdpbmdOb3RpZmljYXRpb25zUGx1Z2luID1cbiAgICAgICAgICBjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5JbkFwcE1lc3NhZ2luZy5BV1NQaW5wb2ludDtcbiAgICAgIH1cbiAgICAgIGlmIChjbGllbnRDb25maWcuTm90aWZpY2F0aW9ucy5QdXNoKSB7XG4gICAgICAgIG1vYmlsZUNvbmZpZy5ub3RpZmljYXRpb25zLnBsdWdpbnMuYXdzUGlucG9pbnRQdXNoTm90aWZpY2F0aW9uc1BsdWdpbiA9XG4gICAgICAgICAgY2xpZW50Q29uZmlnLk5vdGlmaWNhdGlvbnMuUHVzaC5BV1NQaW5wb2ludDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY2xpZW50Q29uZmlnLmF3c191c2VyX2ZpbGVzX3MzX2J1Y2tldCkge1xuICAgICAgbW9iaWxlQ29uZmlnLnN0b3JhZ2UgPSB7XG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICBhd3NTM1N0b3JhZ2VQbHVnaW46IHtcbiAgICAgICAgICAgIGJ1Y2tldDogY2xpZW50Q29uZmlnLmF3c191c2VyX2ZpbGVzX3MzX2J1Y2tldCxcbiAgICAgICAgICAgIHJlZ2lvbjogY2xpZW50Q29uZmlnLmF3c191c2VyX2ZpbGVzX3MzX2J1Y2tldF9yZWdpb24sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIG1vYmlsZUNvbmZpZztcbiAgfTtcbn1cbiJdfQ==